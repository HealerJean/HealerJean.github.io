

 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta name="baidu-site-verification" content="0r55fUD7QR" />
  <meta charset="UTF-8">
    
    
    
    
    <title>mysql项目相关sql大全_终身受用 | HealeJean的梦想博客</title>


    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="HealerJean">
    

    
    <!--<%- open_graph({twitter_id: theme.author.twitter, google_plus: theme.author.google_plus}) %>-->

    <meta name="description" content="page.description">
    
    <meta property="og:type" content="article">
    
    <meta property="og:title" content="mysql项目相关sql大全_终身受用">
    <meta property="og:url" content="/database/2018/12/17/35_Mysql%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3sql%E5%A4%A7%E5%85%A8/">
    <meta property="og:site_name" content="HealeJean的梦想博客">
    <meta property="og:description" content="Mysql项目相关sql大全_终身受用">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="mysql项目相关sql大全_终身受用">
    <meta name="twitter:description" content="page.description">
    <meta name="twitter:creator" content="@mxzdhealer">
    <link rel="publisher" href="">

    
    <link rel="alternative" href="/atom.xml" title="HealeJean的梦想博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/assets/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/assets/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/assets/img/jacman.jpg">
    

    <link rel="stylesheet" href="/assets/css/style.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/highlight.css" type="text/css">
    
    
  <!-- 百度统计 -->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?19549885065170e0019f01e9975dfc1d";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <!-- 百度联盟 -->
    <meta name="baidu_union_verify" content="c2f387067cf0849991ea870f73c055f2">
  
</head>

  <body>
    <header>
        <div>
		    
			<div id="imglogo">
				<a href="/"><img src="/assets/img/logo.png" alt="HealeJean的梦想博客" title="HealeJean的梦想博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="HealeJean的梦想博客">HealeJean的梦想博客</a></h1>
				<h2 class="blog-motto">一个高级软件开发工程师的成长之路</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/categories">技术</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/categories/#Job">生活日记</a></li>
					
						<li><a href="/about">个人简历</a></li>
					
						<li><a href="/friends">友情链接</a></li>
					
					<li>
 					
					<form class="search" action="/search" method="get" accept-charset="utf-8">
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
			</nav>
</div>

    </header>
    <div id="container">
      



<div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
	<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/database/2018/12/17/35_Mysql%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3sql%E5%A4%A7%E5%85%A8/" title="mysql项目相关sql大全_终身受用" itemprop="url">mysql项目相关sql大全_终身受用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="HealerJean" target="_blank" itemprop="author">HealerJean</a>
		
  <p class="article-time">
    <time datetime="2018-12-17 11:33:00 +0800" itemprop="datePublished"> 发表于 2018-12-17</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article toc-content" style="display: none;">
		
			<!--<%- toc(item.content) %>-->
		
		</div>
		
		<!-- image url 
https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages
　　首行缩进
<font color="red">  </font>

<font  color="red" size="4">   </font>


<font size="4">   </font>
-->

<h2 id="1map类型的数据进行inset插入">1、Map类型的数据进行inset插入</h2>

<p>有时候需要简单地把一个Map中所有的key和value获取出来，拼到sql语句中。MyBatis提供的一种方法是遍历Map中的entrySet，然后把key扔进index里面，value扔进item中。具体的一个使用的例子如下：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;insert</span><span class="err"> </span><span class="na">id=</span><span class="s">"operationName"</span><span class="err"> </span><span class="na">parameterType=</span><span class="s">"map"</span><span class="nt">&gt;</span>  
	    INSERT INTO table_name(hot_word, cnt)  
	    VALUES  
	    <span class="nt">&lt;foreach</span><span class="err"> </span><span class="na">item=</span><span class="s">"value"</span><span class="err"> </span><span class="na">index=</span><span class="s">"key"</span><span class="err"> </span><span class="na">collection=</span><span class="s">"mapData.entrySet()"</span><span class="err"> </span><span class="na">open=</span><span class="s">"("</span><span class="err"> </span><span class="na">separator=</span><span class="s">"),("</span><span class="err"> </span><span class="na">close=</span><span class="s">")"</span><span class="nt">&gt;</span>  
	        #{key}, #{value}  
	    <span class="nt">&lt;/foreach&gt;</span>  
	    ON DUPLICATE KEY UPDATE  
	    cnt=VALUES(cnt)  
<span class="nt">&lt;/insert&gt;</span>
</code></pre></div></div>

<h2 id="2获取数据结果为listmapstringobject">2、获取数据结果为<code class="highlighter-rouge">list&lt;map&lt;String,Object&gt;&gt;</code></h2>

<h3 id="1mapper">1、mapper</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HealerJeanMapper</span> <span class="o">{</span>

     <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">sqlMap</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="2mapperxml">2、mapper.xml</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"sqlMap"</span> <span class="na">resultType=</span><span class="s">"java.util.HashMap"</span><span class="nt">&gt;</span>
  SELECT h.id as id ,h.subject as subject FROM  healerjean  h;
<span class="nt">&lt;/select&gt;</span>

</code></pre></div></div>

<h3 id="3解释">3、解释：</h3>

<p>1、返回类型必须是java.util.HashMap
2、map中的value 必须是Objecrt</p>

<h3 id="4controller测试">4、controller测试</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"sqlMap"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">sqlMap</span><span class="o">(){</span>
    <span class="k">return</span> <span class="n">healerJeanMapper</span><span class="o">.</span><span class="na">sqlMap</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/WEFASDFUMM.png" alt="" /></p>

<h2 id="3mybatis-自定义参数返回类型map">3、mybatis 自定义参数、返回类型map</h2>

<p>1、参数</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"getUserCount"</span> <span class="na">parameterMap=</span><span class="s">"getUserCountMap"</span> <span class="na">statementType=</span><span class="s">"CALLABLE"</span><span class="na">resultType=</span><span class="s">"java.util.HashMap
&gt;
        CALL ges_user_count(?,?)
 &lt;/select&gt;     

&lt;parameterMap type="</span><span class="err">java.util.Map"</span> <span class="na">id=</span><span class="s">"getUserCountMap"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">"sexid"</span> <span class="na">mode=</span><span class="s">"IN"</span> <span class="na">jdbcType=</span><span class="s">"INTEGER"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;parameter</span> <span class="na">property=</span><span class="s">"userCount"</span> <span class="na">mode=</span><span class="s">"OUT"</span> <span class="na">jdbcType=</span><span class="s">"INTEGER"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/parameterMap&gt;</span>

</code></pre></div></div>

<p>2、结果，返回字段一一匹配，想想之前@Results和@Result</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">"BaseResultMap"</span> <span class="na">type=</span><span class="s">"com.taotao.pojo.TbUser"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">"id"</span> <span class="na">property=</span><span class="s">"id"</span> <span class="na">jdbcType=</span><span class="s">"BIGINT"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"username"</span> <span class="na">property=</span><span class="s">"username"</span> <span class="na">jdbcType=</span><span class="s">"VARCHAR"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"password"</span> <span class="na">property=</span><span class="s">"password"</span> <span class="na">jdbcType=</span><span class="s">"VARCHAR"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"phone"</span> <span class="na">property=</span><span class="s">"phone"</span> <span class="na">jdbcType=</span><span class="s">"VARCHAR"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"email"</span> <span class="na">property=</span><span class="s">"email"</span> <span class="na">jdbcType=</span><span class="s">"VARCHAR"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"created"</span> <span class="na">property=</span><span class="s">"created"</span> <span class="na">jdbcType=</span><span class="s">"TIMESTAMP"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">column=</span><span class="s">"updated"</span> <span class="na">property=</span><span class="s">"updated"</span> <span class="na">jdbcType=</span><span class="s">"TIMESTAMP"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/resultMap&gt;</span>


</code></pre></div></div>
<p>3、解释
<code class="highlighter-rouge">property</code>和<code class="highlighter-rouge">column</code>分别指定实体类属性和数据表的列名。</p>

<h2 id="4if的使用">4、If的使用</h2>

<h3 id="1mapper接口">1、mapper接口</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CustomerMapper</span> <span class="o">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="nf">findCustomerList</span><span class="o">(</span> <span class="nd">@Param</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span>
                                     <span class="nd">@Param</span><span class="o">(</span><span class="s">"status"</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">status</span><span class="o">,</span>
                                     <span class="nd">@Param</span><span class="o">(</span><span class="s">"offset"</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">offset</span><span class="o">,</span>
                                     <span class="nd">@Param</span><span class="o">(</span><span class="s">"limit"</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">limit</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="2mapperxml-sql语句">2、mapper.xml sql’语句</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">"com.duodian.admore.dao.mybatis.customer.CustomerMapper"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findCustomerList"</span> <span class="na">resultType=</span><span class="s">"com.duodian.admore.entity.db.customer.Customer"</span><span class="nt">&gt;</span>
        SELECT t.* from crm_customer t
        WHERE t.isVisiblisVisiblee = 1
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"name != null and name != ''"</span><span class="nt">&gt;</span>
            and t.name like CONCAT('%','${name}','%' )
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status != null"</span><span class="nt">&gt;</span>
            and t.status = #{status}
        <span class="nt">&lt;/if&gt;</span>
        order by t.id DESC
        limit #{offset}, #{limit}
    <span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"countCustomerList"</span> <span class="na">resultType=</span><span class="s">"java.lang.Long"</span><span class="nt">&gt;</span>
        select count(*) from crm_customer t
        WHERE t.isVisible = 1
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"name != null and name != ''"</span><span class="nt">&gt;</span>
            and t.name like CONCAT('%','${name}','%' )
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status != null"</span><span class="nt">&gt;</span>
            and t.status = #{status}
        <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>

</code></pre></div></div>

<h2 id="5where--include的使用-自动加where">5、where  include的使用<font color="red"> 自动加where</font></h2>

<h3 id="51不会去除第一个and会自动加上where">5.1、不会去除第一个and，会自动加上where</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">&lt;</span><span class="n">select</span> <span class="n">id</span><span class="o">=</span><span class="s">"findUserAppsSpreadEffectList"</span> <span class="n">resultType</span><span class="o">=</span><span class="s">"com.duodian.admore.entity.db.apps.AppsSpreadEffectReport"</span><span class="o">&gt;</span>
    <span class="n">SELECT</span> <span class="n">t</span><span class="o">.*,</span><span class="n">b</span><span class="o">.</span><span class="na">trackName</span><span class="o">,</span><span class="n">b</span><span class="o">.</span><span class="na">smallIcon</span> <span class="n">FROM</span> <span class="n">apps_spread_effect_report</span> <span class="n">t</span>
    <span class="n">LEFT</span> <span class="n">JOIN</span> <span class="n">apps_user_app</span> <span class="n">a</span> <span class="n">ON</span> <span class="n">a</span><span class="o">.</span><span class="na">trackId</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">trackId</span>
    <span class="n">LEFT</span> <span class="n">JOIN</span> <span class="n">apps_app</span> <span class="n">b</span> <span class="n">ON</span> <span class="n">b</span><span class="o">.</span><span class="na">trackId</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">trackId</span>
    <span class="o">&lt;</span><span class="n">where</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="k">if</span> <span class="n">test</span><span class="o">=</span><span class="s">"userId != null"</span><span class="o">&gt;</span>
            <span class="n">a</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="err">#</span><span class="o">{</span><span class="n">userId</span><span class="o">}</span>
        <span class="o">&lt;/</span><span class="k">if</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="k">if</span> <span class="n">test</span><span class="o">=</span><span class="s">"startDate != null "</span><span class="o">&gt;</span>
            <span class="o">&lt;![</span><span class="n">CDATA</span><span class="o">[</span> <span class="n">and</span> <span class="n">t</span><span class="o">.</span><span class="na">spreadDate</span> <span class="o">&gt;=</span>  <span class="err">#</span><span class="o">{</span><span class="n">startDate</span><span class="o">}</span> <span class="o">]]&gt;</span>
        <span class="o">&lt;/</span><span class="k">if</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="k">if</span> <span class="n">test</span><span class="o">=</span><span class="s">"endDate != null "</span><span class="o">&gt;</span>
            <span class="o">&lt;![</span><span class="n">CDATA</span><span class="o">[</span> <span class="n">and</span> <span class="n">t</span><span class="o">.</span><span class="na">spreadDate</span> <span class="o">&lt;=</span>  <span class="err">#</span><span class="o">{</span><span class="n">endDate</span><span class="o">}</span> <span class="o">]]&gt;</span>
        <span class="o">&lt;/</span><span class="k">if</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">where</span><span class="o">&gt;</span>
    <span class="n">order</span> <span class="n">by</span> <span class="n">a</span><span class="o">.</span><span class="na">id</span> <span class="n">desc</span>
<span class="o">&lt;/</span><span class="n">select</span><span class="o">&gt;</span>


</code></pre></div></div>

<h2 id="6foreach-list结合作为参数在mapper中的查询tasktypelist-为list">6、、foreach list结合作为参数在mapper中的查询（taskTypeList 为List<Integer>）</Integer></h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;if test="taskTypeList != null and taskTypeList.size() &gt; 0"&gt; and t.taskType IN
      &lt;foreach collection="taskTypeList" index="index" item="at" open="(" separator="," close=")"&gt;
            #{at}
       &lt;/foreach&gt;
&lt;/if&gt;

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">"findVerifySignetWhere"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"startDate != null"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[ and t.cdate &gt;= #{startDate} ]]&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"endDate != null"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[ and t.cdate &lt;= #{endDate} ]]&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"userParam != null and userParam != '' and userParam!= 'undefined'"</span><span class="nt">&gt;</span>
        AND (t.userId = #{userParam} OR d.nickName LIKE CONCAT('%',#{userParam},'%' ) OR e.realName LIKE
        CONCAT('%',#{userParam},'%' ) OR f.realName LIKE CONCAT('%',#{userParam},'%' ) OR g.email LIKE
        CONCAT('%',#{userParam},'%' ))
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"taskType != null"</span><span class="nt">&gt;</span>
        and t.taskType = #{taskType}
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"taskTypeList != null and taskTypeList.size() &gt; 0"</span><span class="nt">&gt;</span> and t.taskType IN
      <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">"taskTypeList"</span> <span class="na">index=</span><span class="s">"index"</span> <span class="na">item=</span><span class="s">"at"</span> <span class="na">open=</span><span class="s">"("</span> <span class="na">separator=</span><span class="s">","</span> <span class="na">close=</span><span class="s">")"</span><span class="nt">&gt;</span>
            #{at}
       <span class="nt">&lt;/foreach&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"signetType != null"</span><span class="nt">&gt;</span>
        and t.type = #{signetType}
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status != null"</span><span class="nt">&gt;</span>
        and t.status = #{status}
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"currAdmId4Auth != null "</span><span class="nt">&gt;</span>
        <span class="cp">&lt;![CDATA[ and (h.admId = #{currAdmId4Auth} OR w.cc &gt; 0) ]]&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
<span class="nt">&lt;/sql&gt;</span>



</code></pre></div></div>

<h2 id="7choose-when-相当于if-else">7、choose when (相当于if else)</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;choose&gt;</span>
        <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"flag == 1"</span><span class="nt">&gt;</span>
            and t.status = 0
        <span class="nt">&lt;/when&gt;</span>
        <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"flag == 2"</span><span class="nt">&gt;</span>
            and t.status = 1
        <span class="nt">&lt;/when&gt;</span>
        <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"flag == 3"</span><span class="nt">&gt;</span>
            and t.expressStatus = 1
        <span class="nt">&lt;/when&gt;</span>
        <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"flag == 4"</span><span class="nt">&gt;</span>
            and t.status = -2
        <span class="nt">&lt;/when&gt;</span>
        <span class="nt">&lt;otherwise&gt;</span>
        <span class="nt">&lt;y</span><span class="err">/otherwise</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/choose&gt;</span>

</code></pre></div></div>

<h2 id="8ifnull-如果不是空返回第一个否则返回第二个">8、ifnull （如果不是空返回第一个，否则返回第二个）</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ifnull(b.realName,c.realName) authName,

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findRedStartSpread"</span> <span class="na">parameterType=</span><span class="s">"com.duodian.admore.dao.db.redstart.query.RedStartSpreadQuery"</span> <span class="na">resultType=</span><span class="s">"com.duodian.admore.dao.db.redstart.bean.RedStartHistoryBean"</span><span class="nt">&gt;</span>
    SELECT
    k.trackId,
    e.smallIcon,
    e.formattedPrice,
    e.price,
    e.fileSizeBytes,
    e.trackName,
    f.name admName,
    a.nickName userName,
    ifnull(b.realName,c.realName) authName,
    DATE_FORMAT(k.spreadDateStart, '%Y-%m-%d') AS ymd,
    k.userId
    FROM
    redstart_spread k


</code></pre></div></div>

<h2 id="9制作参数为map值进行传入opt项目skinscontroller">9。制作参数为map值进行传入（opt项目SkinsController）</h2>

<h3 id="1controller接收参数">1、controller接收参数</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"data"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">ResponseBean</span> <span class="nf">data</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span>
					  <span class="n">Integer</span> <span class="n">type</span><span class="o">,</span>
					  <span class="n">Integer</span> <span class="n">status</span><span class="o">,</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"page"</span><span class="o">,</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">page</span><span class="o">){</span>
  
        <span class="kt">int</span> <span class="n">pageSize</span> <span class="o">=</span> <span class="mi">15</span><span class="o">;</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">page</span><span class="o">,</span><span class="n">pageSize</span><span class="o">);</span>
        <span class="n">Page</span><span class="o">&lt;</span><span class="n">SkinAppInfoData</span><span class="o">&gt;</span> <span class="n">dataPage</span> <span class="o">=</span> <span class="n">skinsService</span><span class="o">.</span><span class="na">findSkinAppInfoList</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span><span class="s">"name"</span><span class="o">,</span><span class="n">name</span><span class="o">,</span><span class="s">"type"</span><span class="o">,</span><span class="n">type</span><span class="o">,</span><span class="s">"status"</span><span class="o">,</span><span class="n">status</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ResponseBean</span><span class="o">.</span><span class="na">buildSuccess</span><span class="o">(</span><span class="n">dataPage</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="2service-制作map参数下面的功能是模糊查询分页">2、service 制作map参数（下面的功能是模糊查询🏠分页）</h3>

<p>1、service接口</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">SkinAppInfoData</span><span class="o">&gt;</span> <span class="nf">findSkinAppInfoList</span><span class="o">(</span><span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">param</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AppException</span><span class="o">;</span>
</code></pre></div></div>

<p>2、service开始实现 （pageable 主要是利用里面的参数制作limit参数的）</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">SkinAppInfoData</span><span class="o">&gt;</span> <span class="nf">findSkinAppInfoList</span><span class="o">(</span><span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">param</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AppException</span> <span class="o">{</span>
    <span class="n">Map</span> <span class="n">data</span> <span class="o">=</span> <span class="n">MyBatisHelper</span><span class="o">.</span><span class="na">mergeParameterMap</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span><span class="n">param</span><span class="o">);</span>

<span class="k">if</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"startDate"</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
    <span class="n">Date</span> <span class="n">startDate</span> <span class="o">=</span> <span class="o">(</span><span class="n">Date</span><span class="o">)</span> <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"startDate"</span><span class="o">);</span>
    <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"startDate"</span><span class="o">,</span> <span class="n">com</span><span class="o">.</span><span class="na">duodian</span><span class="o">.</span><span class="na">admore</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">helper</span><span class="o">.</span><span class="na">DateHelper</span><span class="o">.</span><span class="na">getDateFirstTime</span><span class="o">(</span><span class="n">startDate</span><span class="o">));</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"endDate"</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
    <span class="n">Date</span> <span class="n">endDate</span> <span class="o">=</span> <span class="o">(</span><span class="n">Date</span><span class="o">)</span> <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"endDate"</span><span class="o">);</span>
    <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"endDate"</span><span class="o">,</span> <span class="n">com</span><span class="o">.</span><span class="na">duodian</span><span class="o">.</span><span class="na">admore</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">helper</span><span class="o">.</span><span class="na">DateHelper</span><span class="o">.</span><span class="na">getDateLastTime</span><span class="o">(</span><span class="n">endDate</span><span class="o">));</span>
<span class="o">}</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">SkinAppInfoData</span><span class="o">&gt;</span> <span class="n">dataList</span> <span class="o">=</span> <span class="n">skinsMapper</span><span class="o">.</span><span class="na">findSkinList</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

    <span class="k">for</span><span class="o">(</span><span class="n">SkinAppInfoData</span> <span class="n">skinAppInfoData</span> <span class="o">:</span><span class="n">dataList</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ChannelJson</span><span class="o">&gt;</span> <span class="n">channelJsonList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">skinAppInfoData</span><span class="o">.</span><span class="na">getChannelJson</span><span class="o">()!=</span><span class="kc">null</span><span class="o">&amp;&amp;!</span><span class="s">""</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">skinAppInfoData</span><span class="o">.</span><span class="na">getChannelJson</span><span class="o">()))</span> <span class="o">{</span>
            <span class="n">JSONArray</span> <span class="n">jsonArray</span> <span class="o">=</span> <span class="n">JSONArray</span><span class="o">.</span><span class="na">fromObject</span><span class="o">(</span><span class="n">skinAppInfoData</span><span class="o">.</span><span class="na">getChannelJson</span><span class="o">());</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">jsonArray</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">ChannelJson</span> <span class="n">channelJson</span> <span class="o">=</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">jsonArray</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">toString</span><span class="o">(),</span> <span class="n">ChannelJson</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                    <span class="n">channelJsonList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">channelJson</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">skinAppInfoData</span><span class="o">.</span><span class="na">setChannelJsonList</span><span class="o">(</span><span class="n">channelJsonList</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="n">Long</span> <span class="n">count</span> <span class="o">=</span> <span class="n">skinsMapper</span><span class="o">.</span><span class="na">countSkinList</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PageImpl</span><span class="o">&lt;</span><span class="n">SkinAppInfoData</span><span class="o">&gt;(</span><span class="n">dataList</span><span class="o">,</span><span class="n">pageable</span><span class="o">,</span><span class="n">count</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="3mybatishelper工具栏">3、MyBatisHelper工具栏</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBatisHelper</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PARAM_OFFSET</span> <span class="o">=</span> <span class="s">"offset"</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PARAM_LIMIT</span> <span class="o">=</span> <span class="s">"limit"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MyBatisHelper</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">mergeParameterMap</span><span class="o">(</span><span class="n">Object</span><span class="o">...</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">length</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"parameter须为key-value对应参数"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">parameter</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">parameter</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">toString</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]);</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">mergeParameterMap</span><span class="o">(</span><span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">length</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"parameter须为key-value对应参数"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">();</span>
            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"offset"</span><span class="o">,</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getOffset</span><span class="o">());</span>
            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"limit"</span><span class="o">,</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getPageSize</span><span class="o">());</span>

            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">parameter</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">parameter</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">toString</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]);</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="4mapperjava-下面这两个其实就是专门用来做制作page分页的">4、mapper.java （下面这两个其实就是专门用来做制作page分页的）</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SkinsMapper</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">SkinAppInfoData</span><span class="o">&gt;</span> <span class="nf">findSkinList</span><span class="o">(</span><span class="n">Map</span> <span class="n">param</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">countSkinList</span><span class="o">(</span><span class="n">Map</span> <span class="n">param</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">"com.duodian.admore.dao.db.skins.SkinsMapper"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findSkinList"</span> <span class="na">resultType=</span><span class="s">"com.duodian.admore.data.skins.SkinAppInfoData"</span><span class="nt">&gt;</span>
        SELECT
            A1.`appid`,
            A1.`appSecret`,
            A1.`icon`,
            A1.`makerMemo`,
            A1.`haveBackstage`,
            A1.`channelJson`,
            A1.`filePath`
        FROM  `skin_app_info_check`  a1
        where A1.status not in (9)
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"name != null and name != ''"</span><span class="nt">&gt;</span>
            AND (A1.trackId = #{name}
            OR A1.name LIKE CONCAT('%',#{name},'%' )
            OR A1.appid LIKE CONCAT('%',#{name},'%' )
            OR A1.appSecret LIKE CONCAT('%',#{name},'%' )
            )
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"type != null and type != '' "</span><span class="nt">&gt;</span>
            and A1.type = #{type}
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status != null and status != '' "</span><span class="nt">&gt;</span>
            and  A1.status = #{status}
        <span class="nt">&lt;/if&gt;</span>
        order by A1.cdate desc
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"offset != null and limit != null"</span><span class="nt">&gt;</span>
            limit #{offset}, #{limit}
        <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"countSkinList"</span> <span class="na">resultType=</span><span class="s">"java.lang.Long"</span><span class="nt">&gt;</span>
        SELECT
              count(*)
            FROM   `skin_app_info_check`      A1
            where A1.status != 9
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"name != null and name != ''"</span><span class="nt">&gt;</span>
                AND (A1.trackId = #{trackId} OR A1.name LIKE CONCAT('%',#{name},'%' ))
            <span class="nt">&lt;/if&gt;</span>
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"type != null"</span><span class="nt">&gt;</span>
                and A1.type = #{type}
            <span class="nt">&lt;/if&gt;</span>
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status != null"</span><span class="nt">&gt;</span>
                and A1.status = #{status}
            <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>

</code></pre></div></div>

<h3 id="5有分组的">5、有分组的</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findCouponTaoKeDataByParam"</span> <span class="na">resultType=</span><span class="s">"com.duodian.youhui.data.coupon.CouponTaoKeItemGoodSummaryData"</span><span class="nt">&gt;</span>
        SELECT c.itemTitle,
        COUNT(c.itemId) as orderSize,
        sum(c.estimateAmount) AS sumEstimateAmount ,
        sum(c.payAmount) AS transAmount,
        c.adzoneName,
        c.adzonePid,
        c.createTime,
        date_format(c.createTime,'%Y-%m-%d') as everyDate,
        c.itemId  FROM  coupon_taoke_data c

        <span class="nt">&lt;where&gt;</span>
            c.dataType = 1 and c.orderStatus not in ('订单失效') and c.status = 1
            <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">"findCouponTaoKeDataByParamSQL"</span><span class="nt">&gt;&lt;/include&gt;</span>
        <span class="nt">&lt;/where&gt;</span>

        <span class="nt">&lt;choose&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"isLinkCome==1"</span><span class="nt">&gt;</span>
                GROUP by c.itemId, date_format(c.createTime,'%Y-%m-%d'), c.adzonePid
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;otherwise&gt;</span>
                GROUP by c.itemId,c.adzonePid
            <span class="nt">&lt;/otherwise&gt;</span>
        <span class="nt">&lt;/choose&gt;</span>

        <span class="nt">&lt;choose&gt;</span>
            <span class="nt">&lt;when</span>  <span class="na">test=</span><span class="s">"order != null"</span><span class="nt">&gt;</span>
                     order by  ${order}
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;otherwise&gt;</span>
                <span class="nt">&lt;choose&gt;</span>
                    <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"isLinkCome==1"</span><span class="nt">&gt;</span>
                        order by date_format(c.createTime,'%Y-%m-%d') DESC
                    <span class="nt">&lt;/when&gt;</span>
                <span class="nt">&lt;/choose&gt;</span>
            <span class="nt">&lt;/otherwise&gt;</span>
        <span class="nt">&lt;/choose&gt;</span>



        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"offset != null and limit != ''"</span><span class="nt">&gt;</span>
            limit #{offset}, #{limit}
        <span class="nt">&lt;/if&gt;</span>

    <span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"countFindCouponTaoKeDataByParam"</span> <span class="na">resultType=</span><span class="s">"java.lang.Long"</span><span class="nt">&gt;</span>
        select count(*) from (
        SELECT c.itemTitle FROM  coupon_taoke_data c
        <span class="nt">&lt;where&gt;</span>
            c.dataType = 1 and c.orderStatus not in ('订单失效') and c.status = 1
            <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">"findCouponTaoKeDataByParamSQL"</span><span class="nt">&gt;&lt;/include&gt;</span>
        <span class="nt">&lt;/where&gt;</span>
        <span class="nt">&lt;choose&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"isLinkCome==1"</span><span class="nt">&gt;</span>
                GROUP by c.itemId, date_format(c.createTime,'%Y-%m-%d'), c.adzonePid
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;otherwise&gt;</span>
                GROUP by c.itemId,c.adzonePid
            <span class="nt">&lt;/otherwise&gt;</span>
        <span class="nt">&lt;/choose&gt;</span>
        ) as a
    <span class="nt">&lt;/select&gt;</span>



</code></pre></div></div>

<h2 id="10模糊查询对象作为参数传入类似于9中的map">10、模糊查询，对象作为参数传入，类似于9中的map</h2>

<h3 id="1query对象-查询参数">1、query对象 (查询参数)</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SysUserQuery</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4564423981924197001L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">offset</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">limit</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">startDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">endDate</span> <span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userid</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userParam</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">status</span><span class="o">;</span>


<span class="o">}</span>


</code></pre></div></div>

<h3 id="2controller层">2、controller层</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"data"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">ResponseBean</span> <span class="nf">data</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span><span class="n">Integer</span> <span class="n">page</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"15"</span><span class="o">)</span><span class="n">Integer</span> <span class="n">pageSize</span><span class="o">,</span> <span class="n">SysUserQuery</span> <span class="n">query</span><span class="o">){</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="n">page</span><span class="o">,</span><span class="n">pageSize</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ResponseBean</span><span class="o">.</span><span class="na">buildSuccess</span><span class="o">(</span><span class="n">sysDingUserService</span><span class="o">.</span><span class="na">getDingUserData</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span><span class="n">query</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">AppException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ResponseBean</span><span class="o">.</span><span class="na">buildFailure</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span><span class="n">e</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ResponseBean</span><span class="o">.</span><span class="na">buildFailure</span><span class="o">(</span><span class="n">ErrorCodeEnum</span><span class="o">.</span><span class="err">系统错误</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="3service层将pageable分页对象放入">3、service层，将pageable分页对象放入</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">SysDingUser</span><span class="o">&gt;</span> <span class="nf">getDingUserData</span><span class="o">(</span><span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">SysUserQuery</span> <span class="n">query</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">query</span><span class="o">.</span><span class="na">setOffset</span><span class="o">(</span><span class="n">pageable</span><span class="o">.</span><span class="na">getOffset</span><span class="o">());</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setLimit</span><span class="o">(</span><span class="n">pageable</span><span class="o">.</span><span class="na">getPageSize</span><span class="o">());</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">SysDingUser</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">sysMapper</span><span class="o">.</span><span class="na">findSysDingUserList</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

        <span class="n">Long</span> <span class="n">count</span> <span class="o">=</span> <span class="n">sysMapper</span><span class="o">.</span><span class="na">countSysDingUser</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">PageImpl</span><span class="o">&lt;&gt;(</span><span class="n">list</span><span class="o">,</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="4mybatis查询语句">4、mybatis查询语句</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findSysDingUserList"</span> <span class="na">resultType=</span><span class="s">"com.duodian.admore.entity.db.admin.SysDingUser"</span><span class="nt">&gt;</span>
    SELECT t.*, a.admId,b.name admName FROM sys_ding_user t
    LEFT JOIN sys_admin_user_ding a ON a.userid = t.userid
    LEFT JOIN sys_admin_user b ON b.id = a.admId
    <span class="nt">&lt;where&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"userParam != null and userParam != ''"</span><span class="nt">&gt;</span>
            and (t.userid = #{userParam} OR t.name LIKE CONCAT('%',#{userParam},'%' ) OR t.email LIKE CONCAT('%',#{userParam},'%' )
            OR t.orgEmail LIKE CONCAT('%',#{userParam},'%' ) OR t.mobile LIKE CONCAT('%',#{userParam},'%' ) OR t.position LIKE CONCAT('%',#{userParam},'%' ))
        <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
    ORDER BY t.id ASC
    limit #{offset}, #{limit}
<span class="nt">&lt;/select&gt;</span>


</code></pre></div></div>

<h2 id="11sql取出制作dto对象">11、sql取出制作DTO对象</h2>

<h3 id="1对于数据库字段匹配的可以直接选择">1、对于数据库字段匹配的，可以直接选择</h3>
<h3 id="2对于不匹配的使用-as--转化">2、对于不匹配的使用 as  转化</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findRedStartSpread"</span> <span class="na">parameterType=</span><span class="s">"com.duodian.admore.dao.db.redstart.query.RedStartSpreadQuery"</span> <span class="na">resultType=</span><span class="s">"com.duodian.admore.dao.db.redstart.bean.RedStartHistoryBean"</span><span class="nt">&gt;</span>
    SELECT
    k.trackId,
    e.smallIcon,
    e.formattedPrice,
    e.price,
    e.fileSizeBytes,
    e.trackName,
    f.name admName,
    a.nickName userName,

    DATE_FORMAT(k.spreadDateStart, '%Y-%m-%d') AS ymd,
    k.userId
    FROM
    redstart_spread k
</code></pre></div></div>

<h3 id="111redstarthistorybean">11.1、RedStartHistoryBean</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedStartHistoryBean</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">ymd</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">trackId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">smallIcon</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">bundleId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">formattedPrice</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">BigDecimal</span> <span class="n">price</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">fileSizeBytes</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">trackName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">fileSizeDesc</span><span class="o">;</span>   <span class="c1">//文件大小描述</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">authName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">admName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

</code></pre></div></div>

<h3 id="112redstartspreadquery">11.2、RedStartSpreadQuery</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedStartSpreadQuery</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">trackId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">trackName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">startDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">endDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">status</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">offset</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">limit</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">point</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">userParam</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">appParam</span><span class="o">;</span>
</code></pre></div></div>

<h2 id="12只有一个参数传入的时候不使用注解param不能直接写参数名字了-而是使用下面的_parameter">12、只有一个参数传入的时候，不使用注解@Param,不能直接写参数名字了 而是使用下面的_parameter</h2>

<h3 id="1mapeprjava">1、mapepr.java</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">List</span><span class="o">&lt;</span><span class="n">CustomerChance</span><span class="o">&gt;</span> <span class="nf">getCustomerList</span><span class="o">(</span><span class="n">Long</span> <span class="n">adminId</span><span class="o">);</span>

</code></pre></div></div>

<h3 id="2mapperxml-1">2、mapper.xml</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"getCustomerList"</span> <span class="na">resultType=</span><span class="s">"com.duodian.admore.entity.db.customer.CustomerChance"</span><span class="nt">&gt;</span>
    SELECT *
    FROM `crm_customer_chance`  c
    where c.isVisible = 1
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"_parameter != null"</span><span class="nt">&gt;</span>
        and c.adminId = #{_parameter}
    <span class="nt">&lt;/if&gt;</span>
<span class="nt">&lt;/select&gt;</span>

</code></pre></div></div>

<h2 id="13加入原生符号">13、加入原生符号</h2>

<p>t.cdate &gt;= #{startDate}</p>

<p>&lt;![CDATA[]]&gt;和转义字符
被&lt;![CDATA[]]&gt;这个标记所包含的内容将表示为纯文本，比如&lt;![CDATA[&lt;]]&gt;表示文本内容“&lt;”。 
　　此标记用于xml文档中，我们先来看看使用转义符的情况。我们知道，在xml中，”&lt;”、”&gt;”、”&amp;”等字符是不能直接存入的，否则xml语法检查时会报错，如果想在xml中使用这些符号，必须将其转义为实体，如”&lt;”、”&gt;”、”&amp;”，这样才能保存进xml文档。 
　</p>

<h3 id="131举例说明">13.1、举例说明</h3>

<font color="red" size="4">但是在mybaits执行的时候，我们没有使用 &lt;![CDATA[&gt;]]&gt;  直接 &gt;=也没有提示报错
  </font>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">"pageSuffix"</span><span class="nt">&gt;</span>
    ) a where rownum <span class="cp">&lt;![CDATA[&lt;=]]&gt;</span> #{end,jdbcType=INTEGER} ) b where b.rn <span class="cp">&lt;![CDATA[&gt;]]&gt;</span> #{start,jdbcType=INTEGER}
  <span class="nt">&lt;/sql&gt;</span>
</code></pre></div></div>

<h2 id="14一个条件匹配多个字段">14、一个条件匹配多个字段</h2>

<hr />
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"userParam != null and userParam != ''"</span><span class="nt">&gt;</span>
    AND (t.userId = #{userParam}
          OR a.nickName LIKE CONCAT('%',#{userParam},'%' )
          OR b.realName LIKE CONCAT('%',#{userParam},'%' )
          OR c.realName LIKE CONCAT('%',#{userParam},'%' )
          OR t.customerId LIKE CONCAT('%',#{userParam},'%' )
          OR t.customerName LIKE CONCAT('%',#{userParam},'%'))
<span class="nt">&lt;/if&gt;</span>


</code></pre></div></div>

<h2 id="15count详解">15、count详解</h2>

<h3 id="1这样输出结果只有一行因为count本来代表的就是一个数字本身就是一行">1、这样输出结果只有一行，因为count（*）本来代表的就是一个数字，本身就是一行</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>  <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="nv">"count"</span><span class="p">,</span><span class="n">idfa</span> <span class="k">from</span> <span class="n">apps_click_record</span> <span class="n">a</span><span class="p">;</span> <span class="o">#</span> <span class="k">WHERE</span>  <span class="n">a</span><span class="p">.</span><span class="n">keywordId</span> <span class="o">=</span> <span class="s1">'169995'</span> <span class="k">GROUP</span>  <span class="k">by</span> <span class="n">idfa</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">DESC</span> <span class="p">;</span>

</code></pre></div></div>

<h3 id="2使用group分组-下面二者是一样的-其实这里就表示分组之后每组的个数">2、使用group分组 （下面二者是一样的） 其实这里就表示分组之后每组的个数</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>  <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="nv">"count"</span><span class="p">,</span><span class="n">idfa</span> <span class="k">from</span> <span class="n">apps_click_record</span> <span class="n">a</span> <span class="k">WHERE</span>  <span class="n">a</span><span class="p">.</span><span class="n">keywordId</span> <span class="o">=</span> <span class="s1">'169995'</span> <span class="k">GROUP</span>  <span class="k">by</span> <span class="n">idfa</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">DESC</span> <span class="p">;</span>
    
<span class="k">SELECT</span>  <span class="k">count</span><span class="p">(</span><span class="n">idfa</span><span class="p">)</span> <span class="k">as</span> <span class="nv">"count"</span><span class="p">,</span><span class="n">idfa</span> <span class="k">from</span> <span class="n">apps_click_record</span> <span class="n">a</span> <span class="k">WHERE</span>  <span class="n">a</span><span class="p">.</span><span class="n">keywordId</span> <span class="o">=</span> <span class="s1">'169995'</span> <span class="k">GROUP</span>  <span class="k">by</span> <span class="n">idfa</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">DESC</span> <span class="p">;</span>

</code></pre></div></div>

<h3 id="3count-和--的查询-是错误的">3、count（*） 和 * 的查询 是错误的</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">下面是错误的</span>

<span class="k">SELECT</span>  <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="nv">"count"</span><span class="p">,</span><span class="o">*</span> <span class="k">from</span> <span class="n">apps_click_record</span> <span class="n">a</span><span class="p">;</span> 

</code></pre></div></div>

<h3 id="4查找数group-by分组后的个数使用嵌套">4、查找数group by分组后的个数，使用嵌套</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> 
<span class="p">(</span>
    <span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">from</span> <span class="n">B</span> <span class="n">b</span> <span class="k">group</span> <span class="k">by</span> <span class="n">b</span><span class="p">.</span><span class="k">type</span>
<span class="p">)</span> <span class="n">m</span>

</code></pre></div></div>

<h2 id="18delete删除表中数据">18、delete删除表中数据</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1,delete from user as u where u.userid=6; 错误
2,delete from user u where u.userid=6; 错误
3,delete from user where userid=6;  正确
4,delete u.* from user u where u.userid=6; 正确
5,delete u from user u where u.userid=6; 正确 
</code></pre></div></div>

<h2 id="19请求分页参数">19、请求分页参数</h2>

<h3 id="191congtroller">19.1、congtroller</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"getOriginData"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">Wrapper</span><span class="o">&lt;?&gt;</span> <span class="n">getOriginData</span><span class="o">(</span><span class="n">String</span> <span class="n">phone</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">bankId</span><span class="o">,</span> <span class="n">PageQuery</span> <span class="n">pageQuery</span><span class="o">){</span>

</code></pre></div></div>

<h3 id="192doto">19.2、DOTO</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Setter</span>
<span class="nd">@ApiModel</span><span class="o">(</span><span class="s">"分页对象"</span><span class="o">)</span>
<span class="nd">@Accessors</span><span class="o">(</span><span class="n">chain</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageQuery</span> <span class="o">{</span>

    <span class="nd">@ApiModelProperty</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"开始页数，从1开始"</span><span class="o">,</span><span class="n">example</span> <span class="o">=</span> <span class="s">"1"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span><span class="n">dataType</span> <span class="o">=</span> <span class="s">"java.lang.Integer"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pageNum</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="nd">@ApiModelProperty</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"每页数量"</span><span class="o">,</span><span class="n">example</span> <span class="o">=</span> <span class="s">"20"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span><span class="n">dataType</span> <span class="o">=</span> <span class="s">"java.lang.Integer"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pageSize</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
   

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getPageSize</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pageSize</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="mi">20</span> <span class="o">:</span> <span class="n">pageSize</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getPageNum</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">pageNum</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">pageNum</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<h2 id="20timestamp-多个日期如果可能为空则建议使用datetime">20、timestamp 多个日期，如果可能为空，则建议使用datetime</h2>

<p>重点：2、@Temporal(TemporalType.DATE)插入数据库中的日期会自动变成 00.00.00，应该使用TIMESTAMP，sql中是datetime
<br /></p>

<p>普通字段不要设置为timestamp，timestamp列必须有默认值，默认值可以为“0000-00-00 00:00:00”，但不能为null。如果我们在save实体的时候，没有给相关timestamp设置值，那么他就会自动由mysql将当前时间设置进去， cdate和udate，都是在java基础上控制的</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">正确数据</span>

<span class="n">createTime</span> <span class="n">datetime</span> <span class="k">default</span> <span class="kc">null</span> <span class="o">,</span>
<span class="n">clickTime</span> <span class="n">datetime</span> <span class="k">default</span> <span class="kc">null</span><span class="o">,</span>

<span class="nd">@Temporal</span><span class="o">(</span><span class="n">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
<span class="nd">@ApiModelProperty</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"创建时间"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">Date</span> <span class="n">createTime</span><span class="o">;</span>

<span class="nd">@Temporal</span><span class="o">(</span><span class="n">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
<span class="nd">@ApiModelProperty</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"点击时间"</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">Date</span> <span class="n">clickTime</span><span class="o">;</span>



</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">下面这个不可能为空，所以也是正确的</span>
<span class="n">cdate</span> <span class="n">timestamp</span> <span class="n">NOT</span> <span class="n">NULL</span> <span class="n">DEFAULT</span> <span class="n">CURRENT_TIMESTAMP</span><span class="o">,</span>
<span class="n">udate</span> <span class="n">timestamp</span> <span class="n">NOT</span> <span class="n">NULL</span> <span class="n">DEFAULT</span> <span class="n">CURRENT_TIMESTAMP</span> <span class="n">ON</span> <span class="n">UPDATE</span> <span class="n">CURRENT_TIMESTAMP</span><span class="o">,</span>



<span class="nd">@Temporal</span><span class="o">(</span><span class="n">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
<span class="nd">@Column</span><span class="o">(</span><span class="n">columnDefinition</span><span class="o">=</span><span class="s">"TIMESTAMP DEFAULT CURRENT_TIMESTAMP"</span><span class="o">,</span><span class="n">insertable</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="nd">@ApiModelProperty</span><span class="o">(</span><span class="n">hidden</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">Date</span> <span class="n">cdate</span><span class="o">;</span>

<span class="nd">@UpdateTimestamp</span>
<span class="nd">@Temporal</span><span class="o">(</span><span class="n">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
<span class="nd">@ApiModelProperty</span><span class="o">(</span><span class="n">hidden</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">Date</span> <span class="n">udate</span><span class="o">;</span>

</code></pre></div></div>

<h3 id="201mybatis日期报错">20.1、mybatis日期报错</h3>

<h4 id="异常invalid-comparison-javautildate-and-javalangstring">异常：<code class="highlighter-rouge">invalid comparison: java.util.Date and java.lang.String。</code></h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"date!= null and date !=''"</span><span class="nt">&gt;</span>
date为Date类型，不能和‘’比较，只判断是不是null就行啦:

<span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"date!= null"</span><span class="nt">&gt;</span>

</code></pre></div></div>

<h2 id="21多条件排序">21、多条件排序</h2>

<p>举例：订单降序 1，订单升序 2 ，成交额降序 3，成交额升序 4，</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findCouponTaoKeDataByParam"</span> <span class="na">resultType=</span><span class="s">"com.duodian.youhui.data.coupon.CouponTaoKeItemGoodSummaryData"</span><span class="nt">&gt;</span>
  SELECT c.itemTitle,COUNT(c.itemId) as orderSize,sum(c.estimateAmount) AS sumEstimateAmount ,c.adzoneName,c.adzonePid,c.createTime,c.itemId  FROM  coupon_taoke_data c
    <span class="nt">&lt;where&gt;</span>
        c.dataType = 1 and  c.status = 1
        <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">"findCouponTaoKeDataByParamSQL"</span><span class="nt">&gt;&lt;/include&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
    GROUP by c.itemId,c.adzonePid

    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"order != null"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;choose&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"order == 1"</span><span class="nt">&gt;</span>
                order by    orderSize DESC
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"order == 2"</span><span class="nt">&gt;</span>
                order by    orderSize asc
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"order == 3"</span><span class="nt">&gt;</span>
                order by   sumEstimateAmount DESC
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">"order == 4"</span><span class="nt">&gt;</span>
                order by   sumEstimateAmount asc
            <span class="nt">&lt;/when&gt;</span>
        <span class="nt">&lt;/choose&gt;</span>
    <span class="nt">&lt;/if&gt;</span>

    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"offset != null and limit != ''"</span><span class="nt">&gt;</span>
        limit #{offset}, #{limit}
    <span class="nt">&lt;/if&gt;</span>

<span class="nt">&lt;/select&gt;</span>

</code></pre></div></div>

<h3 id="2给排序添加非空条件">2、给排序添加非空条件</h3>

<p>使用order byorderid desc实现降序时<br />
orderid 为null数据的会排在数据的最后面；<br /><br /></p>

<p>但是，order by orderid升序时<br />
orderid 为null的数据则会排在最前面<br /><br /></p>

<p>如果想要将orderid为null的数据排在最后，就需要加上is null。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">b_programme</span> <span class="n">u</span> <span class="k">order</span> <span class="k">by</span> <span class="n">u</span><span class="p">.</span><span class="n">orderid</span> <span class="k">is</span> <span class="k">null</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">orderid</span>

</code></pre></div></div>

<h3 id="3正确的多条件排序排序字段由前端进行传入order">3、正确的多条件排序，排序字段由前端进行传入<code class="highlighter-rouge">${order}</code></h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    
        <span class="o">&lt;</span><span class="n">choose</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="k">when</span>  <span class="n">test</span><span class="o">=</span><span class="nv">"order != null"</span><span class="o">&gt;</span>
                     <span class="k">order</span> <span class="k">by</span>  <span class="err">${</span><span class="k">order</span><span class="err">}</span>
            <span class="o">&lt;/</span><span class="k">when</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">otherwise</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">choose</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="k">when</span> <span class="n">test</span><span class="o">=</span><span class="nv">"isLinkCome==1"</span><span class="o">&gt;</span>
                        <span class="k">order</span> <span class="k">by</span> <span class="n">date_format</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">createTime</span><span class="p">,</span><span class="s1">'%Y-%m-%d'</span><span class="p">)</span> <span class="k">DESC</span>
                    <span class="o">&lt;/</span><span class="k">when</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">choose</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">otherwise</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">choose</span><span class="o">&gt;</span>


</code></pre></div></div>

<h2 id="23参数传入为0判断null的时候">23、参数传入为0，判断null的时候</h2>

<font color="red">

### 23.1、第一种解决方法，不建议

id传值为0时(前提是id对应的类型为long 或者 Integer，String型无此问题)，发现并没有执行if里的sql，因为在mybatis中会自动把0当成‘’空字符串，所以建议以后传入这种类型的数据，最好还是不要传入0，可以将0改变为其他的数字，比如5等  

</font>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">&lt;</span><span class="n">if</span> <span class="n">test</span><span class="o">=</span><span class="nv">"status == 5"</span><span class="o">&gt;</span>
        <span class="k">and</span> <span class="k">c</span><span class="p">.</span><span class="n">connectStatus</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">and</span> <span class="k">c</span><span class="p">.</span><span class="n">createAdminId</span> <span class="k">is</span> <span class="k">not</span> <span class="k">NULL</span>
    <span class="o">&lt;/</span><span class="n">if</span><span class="o">&gt;</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">List</span><span class="o">&lt;</span><span class="n">CouponItemGood</span><span class="o">&gt;</span> <span class="nf">dataByParam</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"status"</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">status</span><span class="o">,</span>


</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status !=null and status !=''"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status == 5"</span><span class="nt">&gt;</span>
        and c.connectStatus = 0 and c.createAdminId is not NULL
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status == 1"</span><span class="nt">&gt;</span>
        and c.connectStatus = 1 and c.status = 1 and c.createAdminId is not NULL
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status == 2"</span><span class="nt">&gt;</span>
        and c.connectStatus = 1 and c.status = 0 and c.createAdminId is not NULL
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status == 3"</span><span class="nt">&gt;</span>
        and c.status = 2  and c.createAdminId is not NULL
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status == 4"</span><span class="nt">&gt;</span>
        and c.createAdminId  is NULL
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status == 6 "</span><span class="nt">&gt;</span>
        and c.status  not in (0)  and c.zhiboStatus=1
    <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status == 7 "</span><span class="nt">&gt;</span>
        and c.scheduleDealStatus = 0 and c.createAdminId is not NULL
    <span class="nt">&lt;/if&gt;</span>
<span class="nt">&lt;/if&gt;</span>
</code></pre></div></div>

<h3 id="232第二种解决方法">23.2、第二种解决方法</h3>

<p>使用时增加多一个or status == 0判断</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"status != null and status !=  '' or status == 0"</span><span class="nt">&gt;</span>

</code></pre></div></div>

<h2 id="24查询随机数优化">24、查询随机数优化</h2>

<h4 id="241-性能比较差的一个">24.1 、性能比较差的一个</h4>

<p>RAND()  函数返回的是一个小于1的随机数　　</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">BY</span> <span class="n">RAND</span><span class="p">()</span> <span class="k">LIMIT</span> <span class="mi">1</span>

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--失效之后，从选品库中随便找一个 --&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"wechatSuiJiItemGoodImageUrl"</span> <span class="na">resultType=</span><span class="s">"java.lang.String"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;![CDATA[
        SELECT c.erWeiMaInfoUrl FROM coupon_item_good c WHERE
          TIMESTAMPDIFF(DAY ,cdate,now())  &lt; 5 ORDER BY RAND() LIMIT 1
    ]]&gt;</span>
<span class="nt">&lt;/select&gt;</span>

</code></pre></div></div>

<h4 id="242优化">24.2、优化</h4>

<p>SQL ROUND() 语法</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">ROUND</span><span class="p">(</span><span class="k">column_name</span><span class="p">,</span><span class="n">decimals</span><span class="p">)</span> <span class="k">FROM</span> <span class="k">table_name</span>

</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>参数</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>column_name</td>
      <td>必需。要舍入的字段</td>
    </tr>
    <tr>
      <td>decimals</td>
      <td>非必需，规定返回的小数位数，如果不给值，则自动四舍五入取整取整，select round(100.9) ;  101</td>
    </tr>
  </tbody>
</table>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="err">随机选择一个</span><span class="n">id</span><span class="err">，然后选择一个大于他的数据，</span><span class="k">limit</span><span class="err">控制为</span><span class="mi">1</span>
<span class="err">随机选择一个推广位，具体条件就是下面</span><span class="k">and</span><span class="err">中连接的</span><span class="k">and</span> <span class="n">t1</span><span class="p">.</span><span class="n">status</span> <span class="err">开始</span>

<span class="o">&gt;</span>     <span class="o">&lt;</span><span class="k">select</span> <span class="n">id</span><span class="o">=</span><span class="nv">"findUserCouponAdzone"</span> <span class="n">resultType</span><span class="o">=</span><span class="nv">"com.duodian.youhui.entity.db.coupon.CouponAdzone"</span><span class="o">&gt;</span>
   <span class="o">&lt;!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span>
        <span class="k">SELECT</span> <span class="o">*</span>
        <span class="k">FROM</span> <span class="nv">`coupon_adzone`</span> <span class="k">AS</span> <span class="n">t1</span>
          <span class="k">JOIN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">ROUND</span><span class="p">(</span><span class="n">RAND</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
                                       <span class="k">FROM</span> <span class="nv">`coupon_adzone`</span><span class="p">))</span> <span class="k">AS</span> <span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">t2</span>
        <span class="k">WHERE</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="o">&gt;=</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span> 

<span class="k">and</span> <span class="n">t1</span><span class="p">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span>  <span class="n">t1</span><span class="p">.</span><span class="n">adzoneType</span> <span class="o">=</span> <span class="mi">3</span>  <span class="k">and</span> <span class="p">(</span><span class="n">TIMESTAMPDIFF</span><span class="p">(</span><span class="n">HOUR</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">userUseTime</span><span class="p">,</span> <span class="n">now</span><span class="p">())</span> <span class="o">&gt;</span> <span class="o">#</span><span class="err">{</span><span class="n">timeDiff</span><span class="err">}</span> <span class="k">OR</span> <span class="n">t1</span><span class="p">.</span><span class="n">userInfoId</span> <span class="k">IS</span> <span class="k">NULL</span> <span class="p">)</span>
        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="k">ASC</span>
        <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span>
   <span class="p">]]</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="k">select</span><span class="o">&gt;</span>
</code></pre></div></div>

<h2 id="25-group_concat---sql语句将某一列的值查询成逗号分隔的字符串">25、 GROUP_CONCAT  -sql语句将某一列的值查询成，逗号分隔的字符串</h2>
<p>#</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">from</span> <span class="n">coupon_item_good</span><span class="p">;</span>


<span class="err">返回结果</span>

<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">33</span>

</code></pre></div></div>

<h2 id="26find_in_set--查询字段为逗号隔开的字段属性">26、find_in_set  查询字段为逗号隔开的字段属性</h2>

<p>字段 pnum为逗号隔开的字符串</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">9</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">test</span>  <span class="n">t</span> <span class="k">where</span> <span class="n">find_in_set</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">pnum</span><span class="p">)</span> <span class="p">;</span>
</code></pre></div></div>

<p>查看某个字符串中存在</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">update</span> <span class="n">site</span> <span class="k">set</span> <span class="n">url</span> <span class="o">=</span><span class="n">concat</span><span class="p">(</span><span class="s1">'http://'</span><span class="p">,</span><span class="n">url</span><span class="p">)</span> <span class="k">where</span> <span class="n">locate</span><span class="p">(</span><span class="s1">'http://'</span><span class="p">,</span><span class="n">url</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> 

</code></pre></div></div>

<h2 id="27whencase进行条件判断">27、when，case、进行条件判断</h2>

<p>**</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 <span class="k">case</span> <span class="n">cp</span><span class="p">.</span><span class="n">ssid</span> <span class="k">when</span> <span class="s1">'aa'</span> <span class="k">then</span> <span class="s1">'0'</span> <span class="k">else</span><span class="s1">'1'</span> <span class="k">end</span> <span class="k">as</span> <span class="n">flag</span><span class="p">,</span> <span class="nv">"+
      "</span> <span class="k">case</span> <span class="n">cp</span><span class="p">.</span><span class="n">ssid</span> <span class="k">when</span> <span class="s1">'aa'</span> <span class="k">then</span> <span class="s1">'3001'</span> <span class="k">else</span> <span class="s1">'0000'</span> <span class="k">end</span>  <span class="k">as</span> <span class="n">retCode</span><span class="p">,</span><span class="nv">"+
</span></code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">"SELECT cp.ssid AS ssid,"</span> <span class="o">+</span>
      <span class="nv">" cp.accname AS accname,"</span> <span class="o">+</span>
      <span class="nv">" cp.PAYSUMUNTAX AS PAYSUMUNTAX,"</span> <span class="o">+</span>
      <span class="nv">" cp.PAYTAX AS PAYTAX,"</span> <span class="o">+</span>
      <span class="nv">" cp.payaftersum AS payAmt,"</span> <span class="o">+</span>
      <span class="nv">" cp.benetype AS benetype,"</span> <span class="o">+</span>
      <span class="nv">" cp.memo AS memo,"</span> <span class="o">+</span>
    <span class="nv">" case cp.ssid when 'aa' then '0' else'1' end as flag, "</span><span class="o">+</span>
      <span class="nv">" case cp.ssid when 'aa' then '3001' else '0000' end  as retCode,"</span><span class="o">+</span>
      <span class="nv">" to_char(sysdate,'yyyyMMdd') as drawDate,"</span><span class="o">+</span>
      <span class="nv">" to_char(sysdate,'HH24mmss') as drawTime"</span><span class="o">+</span>
  <span class="nv">" FROM CSIP_OA_PAYLISTINFO CPI"</span> <span class="o">+</span>
 <span class="nv">" JOIN CSIP_OA_TASKFILE CT"</span> <span class="o">+</span>
   <span class="nv">" ON CPI.PK_PAYLISTINFO = CT.PK_PAYLISTINFO"</span> <span class="o">+</span>
 <span class="nv">" JOIN CSIP_OA_PAYLIST CP"</span> <span class="o">+</span>
   <span class="nv">" ON CP.PK_TASKFILE = CT.PK_TASKFILE"</span> <span class="o">+</span>
<span class="nv">" WHERE CPI.INNER_LISTNO = '"</span><span class="o">+</span><span class="n">inworkflowno</span><span class="o">+</span><span class="nv">"'"</span> <span class="p">;</span>
</code></pre></div></div>

<h2 id="28和项目中使用的区别">28、#和$项目中使用的区别</h2>

<h3 id="281变量名可以进行预编译类型匹配等操作变量名会转化为jdbc的类型变量名不进行数据类型匹配直接替换">28.1、#{变量名}可以进行预编译、类型匹配等操作，#{变量名}会转化为jdbc的类型,${变量名}不进行数据类型匹配，直接替换。</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tablename</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">id</span><span class="err">}</span>


<span class="err">假设</span><span class="n">id</span><span class="err">的值为</span><span class="mi">12</span><span class="err">，其中如果数据库字段</span><span class="n">id</span><span class="err">为字符型，那么</span><span class="o">#</span><span class="err">{</span><span class="n">id</span><span class="err">}表示的就是</span><span class="s1">'12'</span><span class="err">，如果</span><span class="n">id</span><span class="err">为整型，那么</span><span class="n">id</span><span class="err">就是</span><span class="mi">12</span><span class="err">，并且</span><span class="n">MyBatis</span><span class="err">会将上面</span><span class="k">SQL</span><span class="err">语句转化为</span><span class="n">jdbc</span><span class="err">的</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tablename</span> <span class="k">where</span> <span class="n">id</span><span class="o">=?</span><span class="err">，把</span><span class="o">?</span><span class="err">参数设置为</span><span class="n">id</span><span class="err">的值。</span>



<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tablename</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="err">${</span><span class="n">id</span><span class="err">}</span>
<span class="err">如果字段</span><span class="n">id</span><span class="err">为整型，</span><span class="k">sql</span><span class="err">语句就不会出错，但是如果字段</span><span class="n">id</span><span class="err">为字符型，</span> <span class="err">那么</span><span class="k">sql</span><span class="err">语句应该写成</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="s1">'${id}'</span><span class="err">。</span>

</code></pre></div></div>

<h3 id="282方式能够很大程度防止sql注入因为会自动转换而为直接替换所以方式无法防止sql注入">28.2、方式能够很大程度防止sql注入。因为#会自动转换，而&amp;为直接替换,所以$方式无法防止sql注入。</h3>

<h3 id="283项目中的使用尽量使用-少用-臭小子明白了吧">28.3、项目中的使用，尽量使用# ，少用&amp; 臭小子，明白了吧</h3>

<p><code class="highlighter-rouge">#</code>适用于普通的参数传入</p>

<p><code class="highlighter-rouge">$</code>方式一般用于传入数据库对象，例如传入表名。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>order为 A ASC, A DESC ,B DESC ，B asc数据，这里直接使用#是错误的

 &lt;when  test="order != null"&gt;
                     order by  ${order}
  &lt;/when&gt;
</code></pre></div></div>

<h2 id="29mysql除法">29、mysql除法</h2>

<p>余数可以为0，得到的结果为NUll</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SELECT</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span> <span class="n">from</span> <span class="n">dual</span> <span class="o">;</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/WX20181212-160341.png" alt="WX20181212-160341" /></p>

<h2 id="30mysql-取小数-convert---round--cast">30、mysql 取小数 convert   round  cast</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="err">、</span><span class="k">convert</span><span class="err">（四舍五入）</span>

<span class="k">select</span> <span class="k">convert</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="n">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>

<span class="o">#</span> <span class="err">四舍五入，</span><span class="n">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="err">后面的代表最大长度</span><span class="mi">10</span><span class="err">以及保留的小数位数</span><span class="mi">2</span>
<span class="k">select</span> <span class="k">convert</span><span class="p">(</span><span class="mi">10569</span><span class="p">.</span><span class="mi">3645</span><span class="p">,</span><span class="n">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>    <span class="o">#</span><span class="mi">10569</span><span class="p">.</span><span class="mi">36</span>
<span class="k">select</span> <span class="k">convert</span><span class="p">(</span><span class="mi">10569</span><span class="p">.</span><span class="mi">3665555</span><span class="p">,</span><span class="n">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span> <span class="o">#</span><span class="mi">10569</span><span class="p">.</span><span class="mi">37</span>


<span class="mi">2</span><span class="err">、</span><span class="n">round</span><span class="err">（自动四舍五入）</span>
<span class="o">#</span> <span class="n">round</span> <span class="err">第二个表示保留几位，如果之前有小数，那么不足的补上</span><span class="mi">0</span><span class="err">。肯定是够的。</span>
<span class="o">#</span>        <span class="err">第二个如果为负数</span> <span class="o">-</span><span class="mi">1</span> <span class="err">代表个位数为</span><span class="mi">0</span>             <span class="n">ROUND</span><span class="p">(</span><span class="mi">114</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="err">结果</span> <span class="mi">110</span><span class="err">，</span>
<span class="o">#</span>                      <span class="o">-</span><span class="mi">2</span> <span class="err">代表个位数和十分位</span> <span class="err">为</span><span class="mi">0</span> <span class="err">例如</span> <span class="n">ROUND</span><span class="p">(</span><span class="mi">114</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="err">结果</span>  <span class="mi">100</span>
<span class="o">#</span> <span class="mi">100</span><span class="p">.</span><span class="mi">35</span>  <span class="mi">100</span> <span class="mi">0</span><span class="p">.</span><span class="mi">60</span>  <span class="mi">110</span>
<span class="k">SELECT</span> <span class="n">ROUND</span><span class="p">(</span><span class="mi">100</span><span class="p">.</span><span class="mi">3465</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">ROUND</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">ROUND</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">ROUND</span><span class="p">(</span><span class="mi">114</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">;</span>


<span class="mi">3</span><span class="err">、</span><span class="k">cast</span><span class="err">，强制转换</span>
<span class="k">select</span> <span class="k">cast</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">from</span> <span class="n">dual</span>


</code></pre></div></div>

<h2 id="31子查询">31、子查询</h2>

<h3 id="311子查询中的变量是不可以是哦用外面的变量的">31.1、子查询中的变量是不可以是哦用外面的变量的</h3>

<h4 id="比如下面的-userinfoid-是不可以使用u的只能是使用已知的参数">比如下面的 #{userInfoId} 是不可以使用u的。只能是使用已知的参数</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">select</span>
               <span class="n">o</span><span class="p">.</span><span class="n">payAmount</span><span class="p">,</span>
               <span class="n">o</span><span class="p">.</span><span class="n">estimateAmount</span><span class="p">,</span>
               <span class="p">(</span><span class="n">o3</span><span class="p">.</span><span class="n">notValidOrderSize</span> <span class="o">+</span><span class="n">o</span><span class="p">.</span><span class="n">orderSize</span><span class="p">)</span> <span class="k">as</span> <span class="n">orderSize</span>
        <span class="k">from</span> <span class="n">user_info</span> <span class="n">u</span>
                       <span class="k">left</span> <span class="k">join</span>  <span class="p">(</span><span class="k">select</span>    <span class="n">IFNULL</span><span class="p">(</span><span class="k">count</span><span class="p">(</span><span class="n">o1</span><span class="p">.</span><span class="n">orderNo</span><span class="p">),</span><span class="mi">0</span> <span class="p">)</span>  <span class="k">as</span> <span class="n">orderSize</span> <span class="p">,</span>
                                             <span class="n">IFNULL</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">o1</span><span class="p">.</span><span class="n">estimateAmount</span><span class="p">)</span> <span class="p">,</span><span class="mi">0</span><span class="p">)</span>  <span class="k">as</span>  <span class="n">estimateAmount</span> <span class="p">,</span>
                                             <span class="n">IFNULL</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">o1</span><span class="p">.</span><span class="n">payAmount</span><span class="p">)</span> <span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">payAmount</span><span class="p">,</span>
                                             <span class="n">o1</span><span class="p">.</span><span class="n">userInfoId</span> <span class="k">as</span> <span class="n">userInfoId</span>
                                     <span class="k">from</span>    <span class="n">user_order</span> <span class="n">o1</span>
                                     <span class="k">where</span>   <span class="n">o1</span><span class="p">.</span><span class="n">userInfoId</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">userInfoId</span><span class="err">}</span> <span class="k">and</span>
                                             <span class="n">o1</span><span class="p">.</span><span class="n">orderStatus</span> <span class="o">!=</span><span class="s1">'订单失效'</span>
                                  <span class="p">)</span>
               <span class="n">o</span> <span class="k">on</span> <span class="n">o</span><span class="p">.</span><span class="n">userInfoId</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span>
                       <span class="k">left</span> <span class="k">join</span>   <span class="p">(</span><span class="k">select</span> <span class="n">IFNULL</span><span class="p">(</span><span class="k">count</span><span class="p">(</span><span class="n">o2</span><span class="p">.</span><span class="n">orderNo</span><span class="p">),</span><span class="mi">0</span> <span class="p">)</span> <span class="k">as</span> <span class="n">notValidOrderSize</span><span class="p">,</span>
                                             <span class="n">o2</span><span class="p">.</span><span class="n">userInfoId</span> <span class="k">as</span> <span class="n">userInfoId</span>
                                      <span class="k">from</span>   <span class="n">user_order</span> <span class="n">o2</span>
                                      <span class="k">where</span> <span class="n">o2</span><span class="p">.</span><span class="n">orderStatus</span> <span class="o">=</span><span class="s1">'订单失效'</span>  <span class="k">and</span> <span class="n">o2</span><span class="p">.</span><span class="n">userInfoId</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">userInfoId</span><span class="err">}</span>
                                   <span class="p">)</span>
              <span class="n">o3</span> <span class="k">on</span> <span class="n">o3</span><span class="p">.</span><span class="n">userInfoId</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span>
        <span class="k">where</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">#</span><span class="err">{</span><span class="n">userInfoId</span><span class="err">}</span><span class="p">;</span>
 <span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> 
</code></pre></div></div>

<h3 id="312内部查询是可以使用外面的下面是更新内部查询是不可以使用被更新对象进行筛选的">31.2、内部查询是可以使用外面的,下面是更新，内部查询是不可以使用被更新对象进行筛选的</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span>  <span class="n">user_access_erweima_ip_info</span> <span class="n">u</span> <span class="k">set</span> <span class="n">u</span><span class="p">.</span><span class="n">dingId</span> <span class="o">=</span> <span class="p">(</span>
   <span class="k">select</span> <span class="k">c</span><span class="p">.</span><span class="n">dingId</span> <span class="k">from</span>  <span class="n">coupon_adzone</span>  <span class="k">c</span> <span class="k">where</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="n">couponAdzoneId</span>
 <span class="p">)</span> <span class="k">where</span>  <span class="n">u</span><span class="p">.</span><span class="n">dingId</span> <span class="k">is</span> <span class="k">null</span> <span class="p">;</span>
 
</code></pre></div></div>

<h2 id="32sql查询结果加法">32、sql查询结果加法</h2>

<p>尽量每个参数都带上ifNULL，防止null+size造成的数据时null，不显示</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>


  <span class="k">select</span>  <span class="n">o</span><span class="p">.</span><span class="n">payAmount</span><span class="p">,</span>
          <span class="n">o</span><span class="p">.</span><span class="n">estimateAmount</span><span class="p">,</span>
         <span class="p">(</span><span class="n">o3</span><span class="p">.</span><span class="n">notValidOrderSize</span> <span class="o">+</span><span class="n">o</span><span class="p">.</span><span class="n">orderSize</span><span class="p">)</span> <span class="k">as</span> <span class="n">orderSize</span>
        <span class="k">from</span> <span class="n">user_info</span> <span class="n">u</span>
        

<span class="p">(</span><span class="n">IFNULL</span><span class="p">(</span><span class="n">o3</span><span class="p">.</span><span class="n">notValidOrderSize</span> <span class="p">,</span><span class="mi">0</span> <span class="p">)</span> <span class="o">+</span> <span class="n">IFNULL</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">orderSize</span> <span class="p">,</span><span class="mi">0</span> <span class="p">)</span> <span class="p">)</span> <span class="k">as</span> <span class="n">orderSize</span>
<span class="p">(</span><span class="n">o3</span><span class="p">.</span><span class="n">notValidOrderSize</span> <span class="o">+</span><span class="n">o</span><span class="p">.</span><span class="n">orderSize</span><span class="p">)</span> <span class="k">as</span> <span class="n">orderSize</span>
        
</code></pre></div></div>

<h2 id="33某一个或者多个字段查找重复数据的sql语句">33、某一个或者多个字段查找重复数据的sql语句</h2>

<h3 id="331表中有id和name-两个字段查询出name重复的所有数据">33.1、表中有id和name 两个字段，查询出name重复的所有数据</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">group</span> <span class="k">by</span> <span class="n">username</span>   <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                             

<span class="k">select</span> <span class="o">*</span> 
<span class="k">from</span> <span class="n">healerjean</span> <span class="n">a</span> 
<span class="k">where</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">username</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span>
                    <span class="k">select</span> <span class="n">username</span> 
                    <span class="k">from</span> <span class="n">healerjean</span> 
                    <span class="k">group</span> <span class="k">by</span> <span class="n">username</span> 
                             <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                    <span class="p">)</span>

</code></pre></div></div>

<h3 id="332删除分组中重读的数据只保留id最小的记录">33.2、删除分组中重读的数据，只保留id最小的记录</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">delete</span> <span class="k">from</span> <span class="n">healerjean</span> 
<span class="k">where</span> <span class="n">username</span> <span class="k">in</span> <span class="p">(</span>
                    <span class="k">select</span> <span class="n">username</span> 
                    <span class="k">from</span> <span class="n">healerjean</span> 
                    <span class="k">group</span> <span class="k">by</span> <span class="n">username</span> 
                    <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                    <span class="p">)</span>
      <span class="k">and</span> <span class="n">id</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span>
                    <span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>   <span class="o">#</span><span class="err">每组中最小的数据</span>
                    <span class="k">from</span> <span class="n">healerjean</span> 
                    <span class="k">group</span> <span class="k">by</span> <span class="n">username</span> 
                    <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="n">username</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>


</code></pre></div></div>

<h3 id="333查找表中多余的重复记录多个字段">33.3、查找表中多余的重复记录（多个字段）</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="err">下面这个就保证了，肯定是二者同时存在才会出现</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> 
<span class="err">如果没有</span><span class="k">having</span><span class="err">则，会出现先根据</span><span class="n">peopleId</span><span class="err">分组，然后组内，再根据</span><span class="n">seq</span> <span class="err">分组。</span>

<span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                            
<span class="k">select</span> <span class="o">*</span> 
<span class="k">from</span> <span class="n">vitae</span> <span class="n">a</span>
<span class="k">where</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">peopleId</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">seq</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span>
                            <span class="k">select</span> <span class="n">peopleId</span><span class="p">,</span>    
                                   <span class="n">seq</span>      
                            <span class="k">from</span> <span class="n">vitae</span> 
                            <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> 
                            <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>


</code></pre></div></div>

<h3 id="334选择表中多余的重复记录多个字段只留有id最小的记录">33.4、选择表中多余的重复记录（多个字段），只留有id最小的记录</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="k">select</span> <span class="o">*</span> 
<span class="k">from</span> <span class="n">vitae</span> <span class="n">a</span>
<span class="k">where</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">peopleId</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">seq</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span>
                            <span class="k">select</span> <span class="n">peopleId</span><span class="p">,</span>    
                                   <span class="n">seq</span>      
                            <span class="k">from</span> <span class="n">vitae</span> 
                            <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> 
                            <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">and</span> <span class="n">id</span> <span class="k">not</span> <span class="k">in</span>           <span class="p">(</span> <span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>   
                            <span class="k">from</span> <span class="n">vitae</span> 
                            <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> 
                            <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
 
</code></pre></div></div>

<h2 id="34abs取绝对值">34、ABS取绝对值</h2>

<p>有时候项目中出现两个数字相减，可能是负数，但是只是需要这连个数的差值，所以就需要用它</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="p">(</span><span class="k">ABS</span><span class="p">(</span> <span class="n">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">MINUTE</span><span class="p">,</span><span class="n">i</span><span class="p">.</span><span class="n">cdate</span><span class="p">,</span><span class="o">#</span><span class="err">{</span><span class="n">createTime</span><span class="err">}</span><span class="p">)</span> <span class="p">))</span><span class="o">&lt;</span> <span class="o">#</span><span class="err">{</span><span class="n">adzoneTime</span><span class="err">}</span><span class="o">****</span>

</code></pre></div></div>

<h2 id="35mysql判断是否为null或空字符串">35、MySql判断是否为null或空字符串</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">#</span> <span class="k">ISNULL</span><span class="p">(</span><span class="n">aBegBalRule</span><span class="p">)</span> <span class="o">||</span> <span class="k">LENGTH</span><span class="p">(</span><span class="k">trim</span><span class="p">(</span><span class="n">aBegBalRule</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">1</span>

</code></pre></div></div>

<h2 id="36清表不要用delete">36、清表（不要用delete）</h2>

<p>delete删除之后还会占用id，</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">truncate</span>  <span class="n">income_detail</span> <span class="o">;</span>

</code></pre></div></div>

<h2 id="37concat拼接字符串">37、CONCAT、拼接字符串</h2>

<h3 id="371模糊查询使用concatparams">37.1、模糊查询使用<code class="highlighter-rouge">concat('%',#{params},'%'))</code></h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">"params != null and params != ''"</span><span class="nt">&gt;</span>
                    and (
                    (u.nickName like  concat('%',#{params},'%')) or
                    (u.id = #{params})
                    )
 <span class="nt">&lt;/if&gt;</span>
                
</code></pre></div></div>

<h3 id="372拼接">37.2、拼接</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 <span class="k">SELECT</span> <span class="n">CONCAT</span><span class="p">(</span><span class="err">’</span><span class="n">My</span><span class="err">’</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="err">‘</span><span class="n">QL</span><span class="err">’</span><span class="p">);</span>
 
 <span class="n">MySQL</span>
 
<span class="o">#</span><span class="err">如果有一个参数为</span><span class="k">null</span><span class="err">，则返回结果为</span><span class="k">null</span>
<span class="k">SELECT</span> <span class="n">CONCAT</span><span class="p">(</span><span class="err">’</span><span class="n">My</span><span class="err">’</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="err">‘</span><span class="n">QL</span><span class="err">’</span><span class="p">);</span>

<span class="k">NULL</span>
 
</code></pre></div></div>

<h3 id="373concat_ws-分隔符连接字符串">37.3、CONCAT_WS ，分隔符连接字符串</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>第一个参数是其它参数的分隔符。分隔符的位置放在要连接的两个字符串之间。分隔符可以是一个字符串，也可以是其它参数。如果分隔符为 NULL，则结果为 NULL。函数会忽略任何分隔符参数后的 NULL 值。
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">SELECT</span> <span class="n">CONCAT_WS</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span><span class="s1">'First name'</span><span class="p">,</span><span class="s1">'Second name'</span><span class="p">,</span><span class="s1">'Last Name'</span><span class="p">);</span>

<span class="k">First</span> <span class="n">name</span><span class="p">,</span><span class="k">Second</span> <span class="n">name</span><span class="p">,</span><span class="k">Last</span> <span class="n">Name</span>

<span class="k">SELECT</span> <span class="n">CONCAT_WS</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span><span class="s1">'First name'</span><span class="p">,</span><span class="s1">''</span><span class="p">,</span><span class="s1">'Last Name'</span><span class="p">);</span>

<span class="k">First</span> <span class="n">name</span><span class="p">,,</span><span class="k">Last</span> <span class="n">Name</span> <span class="p">(</span><span class="err">空字符串不会忽略</span><span class="p">)</span>

<span class="k">SELECT</span> <span class="n">CONCAT_WS</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span><span class="s1">'First name'</span><span class="p">,</span><span class="k">null</span> <span class="p">,</span><span class="s1">'Last Name'</span><span class="p">);</span>

<span class="k">First</span> <span class="n">name</span><span class="p">,</span><span class="k">Last</span> <span class="n">Name</span>




</code></pre></div></div>

<h2 id="38locate-出现的位置">38、locate 出现的位置</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">SELECT</span> <span class="n">LOCATE</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'foobarbar'</span><span class="p">);</span> <span class="o">#</span><span class="mi">4</span>

<span class="k">SELECT</span> <span class="n">LOCATE</span><span class="p">(</span><span class="s1">'xbar'</span><span class="p">,</span> <span class="s1">'foobarbar'</span><span class="p">);</span> <span class="o">#</span><span class="mi">0</span>

<span class="err">位置从</span><span class="mi">4</span><span class="err">开始数起</span> 
<span class="k">SELECT</span> <span class="n">LOCATE</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'foobarbar'</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span> <span class="o">#</span> <span class="mi">4</span>
<span class="err">位置从</span><span class="mi">7</span><span class="err">开始数起</span>
<span class="k">SELECT</span> <span class="n">LOCATE</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'foobarbar'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="o">#</span> <span class="mi">7</span>


</code></pre></div></div>

<p>项目使用</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="err">查找具有</span><span class="n">http</span><span class="err">字段的用户</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="n">locate</span><span class="p">(</span><span class="s1">'http'</span><span class="p">,</span><span class="n">itemUrl</span><span class="p">);</span>


<span class="err">判断</span><span class="n">site</span><span class="err">表中的</span><span class="n">url</span><span class="err">是否包含</span><span class="s1">'http://'</span><span class="err">子串</span><span class="p">,</span><span class="err">如果不包含则拼接在</span><span class="n">url</span><span class="err">字符串开头</span>

<span class="k">update</span> <span class="n">site</span> <span class="k">set</span> <span class="n">url</span> <span class="o">=</span><span class="n">concat</span><span class="p">(</span><span class="s1">'http://'</span><span class="p">,</span><span class="n">url</span><span class="p">)</span> <span class="k">where</span> <span class="n">locate</span><span class="p">(</span><span class="s1">'http://'</span><span class="p">,</span><span class="n">url</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>


</code></pre></div></div>

<p><br /><br /></p>
<font color="red"> 感兴趣的，欢迎添加博主微信， </font>
<p><br />
哈，博主很乐意和各路好友交流，如果满意，请打赏博主任意金额，感兴趣的在微信转账的时候，备注您的微信或者其他联系方式。添加博主微信哦。
<br />
请下方留言吧。可与博主自由讨论哦</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">支付包</th>
      <th style="text-align: center">微信</th>
      <th style="text-align: center">微信公众号</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/alpay.jpg" alt="支付宝" /></td>
      <td style="text-align: center"><img src="https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/weixin.jpg" alt="微信" /></td>
      <td style="text-align: center"><img src="https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/my/qrcode_for_gh_a23c07a2da9e_258.jpg" alt="微信公众号" /></td>
    </tr>
  </tbody>
</table>

<!-- Gitalk 评论 start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />

<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
<p> </p>
<div id="gitalk-container"></div>
<p>  <br />
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'yGteDRHAXmN7alJz',
    });
    gitalk.render('gitalk-container');
</script> </p>

<!-- Gitalk end -->

  
	</div>
	<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <!--
  <%- list_categories(item.categories, {
      show_count: false,
      class: 'article-category',
      style: 'none',
      separator: '►'
  }) %>
  -->
  
  <a class="article-category-link" href="/categories/#Database">Database</a>
  
</div>


  <div class="article-tags">
  <!--
  <% var tags = [];
    item.tags.forEach(function(tag){
      tags.push('<a href="' + config.root + tag.path + '">' + tag.name + '</a>');
    }); %>-->
  <span></span> <!--<%- tags.join('') %>-->
  
  
  <a href="/tags/#Database~~~~">Database~~~~</a>
  
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://localhost:4000/database/2018/12/17/35_Mysql%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3sql%E5%A4%A7%E5%85%A8/" data-title="mysql项目相关sql大全_终身受用 | HealeJean的梦想博客" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>
   
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/json/2018/12/14/6_Json%E4%B8%ADdate(JSONObject)%E5%BC%95%E5%8F%91%E7%9A%84%E8%A1%80%E6%A1%88/" title="json中date(JSONObject)引发的血案">
  <strong>上一篇：</strong><br/>
  <span>
  json中date(JSONObject)引发的血案</span>
</a>
</div>


<div class="next">
<a href="/java/2018/12/20/8_%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%88%AA%E5%8F%96/"  title="几种常见的字符串的截取">
 <strong>下一篇：</strong><br/> 
 <span>几种常见的字符串的截取
</span>
</a>
</div>

</nav>

	

</div>  

      
      
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside toc-content">
 
 <!--<%- toc(item.content) %>-->
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">


  <div class="linkslist">
  <p class="asidetitle">个人网站</p>
    <ul>
        
          <li>
            <a href="http://blog.csdn.net/u012954706" target="_blank" title="csdn">csdn</a>
          </li>
        
          <li>
            <a href="http://www.cnblogs.com/HealerJean/" target="_blank" title="博客园">博客园</a>
          </li>
        
          <li>
            <a href="https://weibo.com/u/3889598250/" target="_blank" title="微博">微博</a>
          </li>
        
          <li>
            <a href="https://www.jianshu.com/u/54ba972e92a8" target="_blank" title="简书">简书</a>
          </li>
        
          <li>
            <a href="https://www.zhihu.com/people/healerjean" target="_blank" title="知乎">知乎</a>
          </li>
        
    </ul>
</div>

  <div class="weiboshow">

     <p class="asidetitle">个人信息</p>
     <script src="/assets/img/person/jquery.js"></script>
     <script src="/assets/img/person/jquery-github-user-widget.js"></script>
     <div class="github-widget-user" data-user="HealerJean">	</div>

</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/#Java" title="Java">Java<sup>28</sup></a></li>
			
		
			
				<li><a href="/tags/#MarkDown" title="MarkDown">MarkDown<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#SpringBoot" title="SpringBoot">SpringBoot<sup>24</sup></a></li>
			
		
			
				<li><a href="/tags/#Docker" title="Docker">Docker<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/#server" title="server">server<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Quartz" title="Quartz">Quartz<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/#database" title="database">database<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/#SoftWare" title="SoftWare">SoftWare<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/#GitHub" title="GitHub">GitHub<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/#Mac" title="Mac">Mac<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#Thread" title="Thread">Thread<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/#Url" title="Url">Url<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Annotation" title="Annotation">Annotation<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#SortAlgorithm" title="SortAlgorithm">SortAlgorithm<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/#CAS" title="CAS">CAS<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/#Maven" title="Maven">Maven<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/#HTML" title="HTML">HTML<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#AngularJs" title="AngularJs">AngularJs<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#WeChat" title="WeChat">WeChat<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/#Experience" title="Experience">Experience<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/#Team" title="Team">Team<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#Utils" title="Utils">Utils<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#Hibernate" title="Hibernate">Hibernate<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Date" title="Date">Date<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Log" title="Log">Log<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/#JSON" title="JSON">JSON<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/#GrayLog" title="GrayLog">GrayLog<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Database" title="Database">Database<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/#Redis" title="Redis">Redis<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/#Ehcache" title="Ehcache">Ehcache<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Druid" title="Druid">Druid<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Swagger" title="Swagger">Swagger<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#Netty" title="Netty">Netty<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#NIO" title="NIO">NIO<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#WebSocket" title="WebSocket">WebSocket<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#Map" title="Map">Map<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#JVM" title="JVM">JVM<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/#Element" title="Element">Element<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Job" title="Job">Job<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/#Graphics" title="Graphics">Graphics<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Linux" title="Linux">Linux<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/#Databases" title="Databases">Databases<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Nginx" title="Nginx">Nginx<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#SpirngBoot" title="SpirngBoot">SpirngBoot<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Linu" title="Linu">Linu<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#JAVA" title="JAVA">JAVA<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Server" title="Server">Server<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Google" title="Google">Google<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Git" title="Git">Git<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#分布式" title="分布式">分布式<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#SpringCloud" title="SpringCloud">SpringCloud<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/#http" title="http">http<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#docker" title="docker">docker<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Json" title="Json">Json<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#Database~~~~" title="Database~~~~">Database~~~~<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#weChat" title="weChat">weChat<sup>1</sup></a></li>
			
		
		</ul>
</div>


  


  


</aside>
</div>
    </div>
    <footer><div id="footer" >

	<!-- 打赏功能 -->
  <!-- <script src="http://static.tctip.com/tctip-1.0.0.min.js"></script> -->
  <script src="/assets/img/tctip/tctip-1.0.1.min.js"></script>
	<script>  
	new tctip({
	  top: '20%',
	  button: {
	    id: 9,
	    type: 'dashang',
	  },
	  list: [
	    {
	      type: 'alipay',
	      qrImg: '/assets/img/tctip/alpay.jpg'
	    }, {
	      type: 'wechat',
	      qrImg: '/assets/img/tctip/weixin.jpg'
	    }
	  ]
	}).init()
	</script>



	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 欢迎来到  HealerJean 的梦想博客. <br/>
			------您已走进一个高级软件开发工程师的成长之路</p>
	</section>
	 


<!--  自带的分享功能 	-->
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/3889598250" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		<a href="https://twitter.com/mxzdhealer" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		
		
		
		
		
		<a href="mailto:healerjean@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div> 


	<!--
			<%  Array.prototype.S=String.fromCharCode(2);
			  Array.prototype.in_array=function(e){
    			var r=new RegExp(this.S+e+this.S);
    			return (r.test(this.S+this.join(this.S)+this.S));
				};
				var cc = new Array('by','by-nc','by-nc-nd','by-nc-sa','by-nd','by-sa','zero'); %>
		<% if (cc.in_array(theme.creative_commons) ) { %>
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/<%= theme.creative_commons %>/4.0" class="cc-opacity" target="_blank">
            <img src="<%- config.root %>img/cc-<%= theme.creative_commons %>.svg" alt="Creative Commons" />
          </a>
        </div>
    <% } %>
				-->

		<p class="copyright">
		welcome to <a href="http://jekyllrb.com" target="_blank" title="jekyll">HealerJean</a> 
		blog <a href="https://github.com/simpleyyt/jekyll-jacman" target="_blank" title="Jacman">for</a> © 2017 
		
		<a href="about" target="_blank" title="HealerJean">HealerJean</a>
		
		
		</p>
</div>
</footer>
    <script src="/assets/js/jquery-2.0.3.min.js"></script>
<script src="/assets/js/jquery.imagesloaded.min.js"></script>
<script src="/assets/js/gallery.js"></script>
<script src="/assets/js/jquery.qrcode-0.12.0.min.js"></script>
<script src="/assets/js/toc.js"></script>

<script type="text/javascript">
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });

  

  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
      
    }
  });
});
</script>




<script type="text/javascript">
$(document).ready(function(){
  $('#toc.toc-aside').toc({
    title: "文章目录",
    showEffect: "none"
  });
  $('#toc.toc-article').toc({
    title: "文章目录",
    showEffect: "show",
    showSpeed: 0
  });
});
</script>



<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>



<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
/*
  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      //$('.hoverqrcode').hide();
  });
  */
});
</script>






<!--

-->




<link rel="stylesheet" href="/assets/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/assets/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      if ($(this).hasClass('emoji')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>


<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/assets/img/scrollup.png"/></a>
	</div>
	<script src="/assets/js/totop.js"></script>


<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>

