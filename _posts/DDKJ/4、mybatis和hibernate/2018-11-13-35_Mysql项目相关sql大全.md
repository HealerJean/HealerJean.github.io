---
title: Mysqlé¡¹ç›®ç›¸å…³sqlå¤§å…¨_ç»ˆèº«å—ç”¨
date: 2018-11-13 03:33:00
tags: 
- Database
category: 
- Database
description: Mysqlé¡¹ç›®ç›¸å…³sqlå¤§å…¨_ç»ˆèº«å—ç”¨
---
<!-- image url 
https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages
ã€€ã€€é¦–è¡Œç¼©è¿›
<font color="red">  </font>

<font  color="red" size="4">   </font>


<font size="4">   </font>
-->

### 1ã€Mapç±»å‹çš„æ•°æ®è¿›è¡Œinsetæ’å…¥

æœ‰æ—¶å€™éœ€è¦ç®€å•åœ°æŠŠä¸€ä¸ªMapä¸­æ‰€æœ‰çš„keyå’Œvalueè·å–å‡ºæ¥ï¼Œæ‹¼åˆ°sqlè¯­å¥ä¸­ã€‚MyBatisæä¾›çš„ä¸€ç§æ–¹æ³•æ˜¯éå†Mapä¸­çš„entrySetï¼Œç„¶åæŠŠkeyæ‰”è¿›indexé‡Œé¢ï¼Œvalueæ‰”è¿›itemä¸­ã€‚å…·ä½“çš„ä¸€ä¸ªä½¿ç”¨çš„ä¾‹å­å¦‚ä¸‹ï¼š


```xml
<insertÂ id="operationName"Â parameterType="map">Â Â 
	Â Â Â Â INSERTÂ INTOÂ table_name(hot_word,Â cnt)Â Â 
	Â Â Â Â VALUESÂ Â 
	Â Â Â Â <foreachÂ item="value"Â index="key"Â collection="mapData.entrySet()"Â open="("Â separator="),("Â close=")">Â Â 
	Â Â Â Â Â Â Â Â #{key},Â #{value}Â Â 
	Â Â Â Â </foreach>Â Â 
	Â Â Â Â ONÂ DUPLICATEÂ KEYÂ UPDATEÂ Â 
	Â Â Â Â cnt=VALUES(cnt)Â Â 
</insert>
```


### 2ã€è·å–æ•°æ®ç»“æœä¸º`list<map<String,Object>>`


#### 1ã€mapper


```java

public interface HealerJeanMapper {

     List<Map<String,Object>> sqlMap();
}
```


#### 2ã€mapper.xml


```xml
<select id="sqlMap" resultType="java.util.HashMap">
  SELECT h.id as id ,h.subject as subject FROM  healerjean  h;
</select>

```

#### 3ã€è§£é‡Šï¼š

1ã€è¿”å›ç±»å‹å¿…é¡»æ˜¯java.util.HashMap
2ã€mapä¸­çš„value å¿…é¡»æ˜¯Objecrt

#### 4ã€controlleræµ‹è¯•

```java

@RequestMapping("sqlMap")
@ResponseBody
public List<Map<String,Object>> sqlMap(){
    return healerJeanMapper.sqlMap();
}
```

![](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/WEFASDFUMM.png)

### 3ã€mybatis è‡ªå®šä¹‰å‚æ•°ã€è¿”å›ç±»å‹map

1ã€å‚æ•°

```xml
<select id="getUserCount" parameterMap="getUserCountMap" statementType="CALLABLE"resultType="java.util.HashMap
>
        CALL ges_user_count(?,?)
 </select>     

<parameterMap type="java.util.Map" id="getUserCountMap">
   <parameter property="sexid" mode="IN" jdbcType="INTEGER"/>
   <parameter property="userCount" mode="OUT" jdbcType="INTEGER"/>
</parameterMap>

```

2ã€ç»“æœï¼Œè¿”å›å­—æ®µä¸€ä¸€åŒ¹é…ï¼Œæƒ³æƒ³ä¹‹å‰@Resultså’Œ@Result


```xml

  <resultMap id="BaseResultMap" type="com.taotao.pojo.TbUser" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="username" property="username" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="created" property="created" jdbcType="TIMESTAMP" />
    <result column="updated" property="updated" jdbcType="TIMESTAMP" />
  </resultMap>


```
3ã€è§£é‡Š
`property`å’Œ`column`åˆ†åˆ«æŒ‡å®šå®ä½“ç±»å±æ€§å’Œæ•°æ®è¡¨çš„åˆ—åã€‚



### 4ã€Ifçš„ä½¿ç”¨

#### 1ã€mapperæ¥å£


```java
public interface CustomerMapper {

    List<Customer> findCustomerList( @Param("name") String name,
                                     @Param("status") Integer status,
                                     @Param("offset") Integer offset,
                                     @Param("limit") Integer limit);

}
```

####  2ã€mapper.xml sql'è¯­å¥

```xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.duodian.admore.dao.mybatis.customer.CustomerMapper">

    <select id="findCustomerList" resultType="com.duodian.admore.entity.db.customer.Customer">
        SELECT t.* from crm_customer t
        WHERE t.isVisiblisVisiblee = 1
        <if test="name != null and name != ''">
            and t.name like CONCAT('%','${name}','%' )
        </if>
        <if test="status != null">
            and t.status = #{status}
        </if>
        order by t.id DESC
        limit #{offset}, #{limit}
    </select>

    <select id="countCustomerList" resultType="java.lang.Long">
        select count(*) from crm_customer t
        WHERE t.isVisible = 1
        <if test="name != null and name != ''">
            and t.name like CONCAT('%','${name}','%' )
        </if>
        <if test="status != null">
            and t.status = #{status}
        </if>
    </select>

</mapper>

```

### 5ã€where  includeçš„ä½¿ç”¨<font color="red">ï¼ˆ åŠ å…¥æ¨¡ç³ŠæŸ¥è¯¢ç­›é€‰æ¡ä»¶ï¼‰è‡ªå¸¦å»é™¤ç¬¬ä¸€ä¸ªand </font>

#### 5.1ã€mapper

```java

@Override
    public Page<SignetApplyRecord> findVerifySignetData(Long admId, Pageable pageable, SignetQuery query) {

        query.setStartDate(DateHelper.getDateFirstTime(query.getStartDate()));
        query.setEndDate(DateHelper.getDateLastTime(query.getEndDate()));
        query.setOffset(pageable.getOffset());
        query.setLimit(pageable.getPageSize());

              

        List<SignetApplyRecord> list = signetMapper.findVerifySignetList(query);
              

        Long count = signetMapper.countVerifySignet(query);

        return new PageImpl<>(list, pageable, count);
    }


```


#### 5.2ã€xml


```
<select id="findVerifySignetList" resultType="com.duodian.admore.entity.db.signet.SignetApplyRecord">
    SELECT t.*,d.nickName userNickName,ifnull(e.realName,f.realName) userAuthName,b.name applyAdmName,ura.remittanceAccount
    FROM signet_apply_record t
    LEFT JOIN user d ON d.id = t.userId
    LEFT JOIN user_remittance_account ura ON ura.userId = t.userId
    <if test="currAdmId4Auth != null">
        LEFT JOIN sys_admin_user_customer h ON h.admId = #{currAdmId4Auth} AND h.userId = t.userId
        LEFT JOIN (SELECT wt.pid,count(*) cc FROM workflow_task_examine_details wte LEFT JOIN workflow_task wt ON wt.id = wte.taskId WHERE wt.taskType = 23 AND wte.admId = #{currAdmId4Auth} GROUP BY wt.pid) w ON w.pid = t.id
    </if>
    <where>
        <include refid="findVerifySignetWhere"></include>
    </where>
    order by t.id desc
    <if test="offset != null and limit != null">
        limit #{offset}, #{limit}
    </if>
</select>


<sql id="findVerifySignetWhere">
       <if test="taskTypeList != null and taskTypeList.size() > 0">
        and t.taskType IN
        <foreach collection="taskTypeList" index="index" item="at" open="(" separator="," close=")">
            #{at}
        </foreach>
    </if>
    <if test="signetType != null">
        and t.type = #{signetType}
    </if>
    <if test="status != null">
        and t.status = #{status}
    </if>
    <if test="currAdmId4Auth != null ">
        <![CDATA[ and (h.admId = #{currAdmId4Auth} OR w.cc > 0) ]]>
    </if>
</sql>
```

#### 5.3ã€è‡ªå¸¦å»é™¤ç¬¬ä¸€ä¸ªand

```java

<select id="findUserAppsSpreadEffectList" resultType="com.duodian.admore.entity.db.apps.AppsSpreadEffectReport">
    SELECT t.*,b.trackName,b.smallIcon FROM apps_spread_effect_report t
    LEFT JOIN apps_user_app a ON a.trackId = t.trackId
    LEFT JOIN apps_app b ON b.trackId = t.trackId
    <where>
        <if test="userId != null">
            a.userId = #{userId}
        </if>
        <if test="startDate != null ">
            <![CDATA[ and t.spreadDate >=  #{startDate} ]]>
        </if>
        <if test="endDate != null ">
            <![CDATA[ and t.spreadDate <=  #{endDate} ]]>
        </if>
    </where>
    order by a.id desc
</select>



<!--è‡ªå¸¦å–å»é™¤ç¬¬ä¸€ä¸ªand-->
SELECT * FROM OD_LINK_TYPE
   <where>
       LINK_URI != BASE_TYPE_URI
       <if test="linkUri != null">
          AND LINK_URI LIKE '%${linkUri}%'
       </if>
       <if test="linkLabel != null">
           AND LINK_LABEL LIKE '%${linkLabel}%'
       </if>
       <if test="baseTypeUri != null">
           AND BASE_TYPE_URI=#{baseTypeUri}
       </if>
   </where>


```

### 6ã€ã€foreach listç»“åˆä½œä¸ºå‚æ•°åœ¨mapperä¸­çš„æŸ¥è¯¢ï¼ˆtaskTypeList ä¸ºList<Integer>ï¼‰


```
 <if test="taskTypeList != null and taskTypeList.size() > 0"> and t.taskType IN
      <foreach collection="taskTypeList" index="index" item="at" open="(" separator="," close=")">
            #{at}
       </foreach>
</if>

```

```xml
<sql id="findVerifySignetWhere">
    <if test="startDate != null">
        <![CDATA[ and t.cdate >= #{startDate} ]]>
    </if>
    <if test="endDate != null">
        <![CDATA[ and t.cdate <= #{endDate} ]]>
    </if>
    <if test="userParam != null and userParam != '' and userParam!= 'undefined'">
        AND (t.userId = #{userParam} OR d.nickName LIKE CONCAT('%',#{userParam},'%' ) OR e.realName LIKE
        CONCAT('%',#{userParam},'%' ) OR f.realName LIKE CONCAT('%',#{userParam},'%' ) OR g.email LIKE
        CONCAT('%',#{userParam},'%' ))
    </if>
    <if test="taskType != null">
        and t.taskType = #{taskType}
    </if>
    <if test="taskTypeList != null and taskTypeList.size() > 0"> and t.taskType IN
      <foreach collection="taskTypeList" index="index" item="at" open="(" separator="," close=")">
            #{at}
       </foreach>
    </if>
    <if test="signetType != null">
        and t.type = #{signetType}
    </if>
    <if test="status != null">
        and t.status = #{status}
    </if>
    <if test="currAdmId4Auth != null ">
        <![CDATA[ and (h.admId = #{currAdmId4Auth} OR w.cc > 0) ]]>
    </if>
</sql>



```


### 7ã€choose when 


```xml

<if test="flag != null">
    <choose>
        <when test="flag == 1">
            and t.status = 0
        </when>
        <when test="flag == 2">
            and t.status = 1
        </when>
        <when test="flag == 3">
            and t.expressStatus = 1
        </when>
        <when test="flag == 4">
            and t.status = -2
        </when>
    </choose>
</if>

```

### 8ã€ifnull ï¼ˆå¦‚æœä¸æ˜¯ç©ºè¿”å›ç¬¬ä¸€ä¸ªï¼Œå¦åˆ™è¿”å›ç¬¬äºŒä¸ªï¼‰

```xml
    ifnull(b.realName,c.realName) authName,

```

```xml

<select id="findRedStartSpread" parameterType="com.duodian.admore.dao.db.redstart.query.RedStartSpreadQuery" resultType="com.duodian.admore.dao.db.redstart.bean.RedStartHistoryBean">
    SELECT
    k.trackId,
    e.smallIcon,
    e.formattedPrice,
    e.price,
    e.fileSizeBytes,
    e.trackName,
    f.name admName,
    a.nickName userName,
    ifnull(b.realName,c.realName) authName,
    DATE_FORMAT(k.spreadDateStart, '%Y-%m-%d') AS ymd,
    k.userId
    FROM
    redstart_spread k


```


### 9ã€‚åˆ¶ä½œå‚æ•°ä¸ºmapå€¼è¿›è¡Œä¼ å…¥ï¼ˆopté¡¹ç›®SkinsControllerï¼‰

#### 1ã€controlleræ¥æ”¶å‚æ•°


```java
@RequestMapping("data")
@ResponseBody
public ResponseBean data(String name,
					  Integer type,
					  Integer status,@RequestParam(value = "page",defaultValue = "0") Integer page){
  
        int pageSize = 15;
        Pageable pageable = new PageRequest(page,pageSize);
        Page<SkinAppInfoData> dataPage = skinsService.findSkinAppInfoList(pageable,"name",name,"type",type,"status",status);
        return ResponseBean.buildSuccess(dataPage);

}
```


#### 2ã€service åˆ¶ä½œmapå‚æ•°ï¼ˆä¸‹é¢çš„åŠŸèƒ½æ˜¯æ¨¡ç³ŠæŸ¥è¯¢ğŸ åˆ†é¡µï¼‰

1ã€serviceæ¥å£

```java

public Page<SkinAppInfoData> findSkinAppInfoList(Pageable pageable, Object... param) throws AppException;
```

2ã€serviceå¼€å§‹å®ç° ï¼ˆpageable ä¸»è¦æ˜¯åˆ©ç”¨é‡Œé¢çš„å‚æ•°åˆ¶ä½œlimitå‚æ•°çš„ï¼‰


```java
@Override
public Page<SkinAppInfoData> findSkinAppInfoList(Pageable pageable, Object... param) throws AppException {
    Map data = MyBatisHelper.mergeParameterMap(pageable,param);

if(data.get("startDate") != null){
    Date startDate = (Date) data.get("startDate");
    data.put("startDate", com.duodian.admore.core.helper.DateHelper.getDateFirstTime(startDate));
}
if(data.get("endDate") != null){
    Date endDate = (Date) data.get("endDate");
    data.put("endDate", com.duodian.admore.core.helper.DateHelper.getDateLastTime(endDate));
}

    List<SkinAppInfoData> dataList = skinsMapper.findSkinList(data);

    for(SkinAppInfoData skinAppInfoData :dataList){
        List<ChannelJson> channelJsonList = new ArrayList<>();
        if(skinAppInfoData.getChannelJson()!=null&&!"".equals(skinAppInfoData.getChannelJson())) {
            JSONArray jsonArray = JSONArray.fromObject(skinAppInfoData.getChannelJson());
            for (int i = 0; i < jsonArray.size(); i++) {
                ObjectMapper objectMapper = new ObjectMapper();
                try {
                    ChannelJson channelJson = objectMapper.readValue(jsonArray.get(i).toString(), ChannelJson.class);
                    channelJsonList.add(channelJson);
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
        skinAppInfoData.setChannelJsonList(channelJsonList);

    }

    Long count = skinsMapper.countSkinList(data);
    return new PageImpl<SkinAppInfoData>(dataList,pageable,count);
}
```


#### 3ã€MyBatisHelperå·¥å…·æ 

```java

public class MyBatisHelper {
    public static final String PARAM_OFFSET = "offset";
    public static final String PARAM_LIMIT = "limit";

    public MyBatisHelper() {
    }

    public static Map<String, Object> mergeParameterMap(Object... parameter) {
        if (parameter.length % 2 != 0) {
            throw new IllegalArgumentException("parameteré¡»ä¸ºkey-valueå¯¹åº”å‚æ•°");
        } else {
            Map<String, Object> map = new HashMap();

            for(int i = 0; i < parameter.length; i += 2) {
                map.put(parameter[i].toString(), parameter[i + 1]);
            }

            return map;
        }
    }

    public static Map<String, Object> mergeParameterMap(Pageable pageable, Object... parameter) {
        if (parameter.length % 2 != 0) {
            throw new IllegalArgumentException("parameteré¡»ä¸ºkey-valueå¯¹åº”å‚æ•°");
        } else {
            Map<String, Object> map = new HashMap();
            map.put("offset", pageable.getOffset());
            map.put("limit", pageable.getPageSize());

            for(int i = 0; i < parameter.length; i += 2) {
                map.put(parameter[i].toString(), parameter[i + 1]);
            }

            return map;
        }
    }
}
```



#### 4ã€mapper.java ï¼ˆä¸‹é¢è¿™ä¸¤ä¸ªå…¶å®å°±æ˜¯ä¸“é—¨ç”¨æ¥åšåˆ¶ä½œpageåˆ†é¡µçš„ï¼‰


```java
public interface SkinsMapper {

    public List<SkinAppInfoData> findSkinList(Map param);

    public Long countSkinList(Map param);

}
```


```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.duodian.admore.dao.db.skins.SkinsMapper">

    <select id="findSkinList" resultType="com.duodian.admore.data.skins.SkinAppInfoData">
        SELECT
            A1.`appid`,
            A1.`appSecret`,
            A1.`icon`,
            A1.`makerMemo`,
            A1.`haveBackstage`,
            A1.`channelJson`,
            A1.`filePath`
        FROM  `skin_app_info_check`  a1
        where A1.status not in (9)
        <if test="name != null and name != ''">
            AND (A1.trackId = #{name}
            OR A1.name LIKE CONCAT('%',#{name},'%' )
            OR A1.appid LIKE CONCAT('%',#{name},'%' )
            OR A1.appSecret LIKE CONCAT('%',#{name},'%' )
            )
        </if>
        <if test="type != null and type != '' ">
            and A1.type = #{type}
        </if>
        <if test="status != null and status != '' ">
            and  A1.status = #{status}
        </if>
        order by A1.cdate desc
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="countSkinList" resultType="java.lang.Long">
        SELECT
              count(*)
            FROM   `skin_app_info_check`      A1
            where A1.status != 9
            <if test="name != null and name != ''">
                AND (A1.trackId = #{trackId} OR A1.name LIKE CONCAT('%',#{name},'%' ))
            </if>
            <if test="type != null">
                and A1.type = #{type}
            </if>
            <if test="status != null">
                and A1.status = #{status}
            </if>
    </select>
</mapper>

```


#### 5ã€æœ‰åˆ†ç»„çš„


```xml

<select id="findCouponTaoKeDataByParam" resultType="com.duodian.youhui.entity.db.coupon.CouponTaoKeData">
  SELECT c.itemTitle,COUNT(c.itemId),sum(c.estimateAmount),c.adzoneName,c.adzonePid FROM  coupon_taoke_data c WHERE  1=1
    <where>
        <include refid="findCouponTaoKeDataByParamSQL"></include>
    </where>
    GROUP by c.itemId
    <if test="offset != null and limit != null">
        limit #{offset}, #{limit}
    </if>
</select>

<select id="countFindCouponTaoKeDataByParam">
    select count(*) from (
     SELECT c.itemTitle FROM  coupon_taoke_data c WHERE  1=1
    <where>
        <include refid="findCouponTaoKeDataByParamSQL"></include>
    </where>
    GROUP by c.itemId
    ) as a
</select>

<sql id="findCouponTaoKeDataByParamSQL">
    <if test="startDate != null ">
        <![CDATA[ and  c.createTime >=  #{endDate} ]]>
    </if>
    <if test="endDate != null ">
        <![CDATA[ and c.createTime <=  #{endDate} ]]>
    </if>
    <if test="adzonePid != null and adzonePid != ''">
        <![CDATA[ and c.adzonePid <=  #{adzonePid} ]]>
    </if>
</sql>
```

### 10ã€æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œç±»ä¼¼äº9ä¸­çš„map

#### 1ã€queryå¯¹è±¡ (æŸ¥è¯¢å‚æ•°)


```java
public class SysUserQuery implements Serializable {

    private static final long serialVersionUID = -4564423981924197001L;

    private Long id;
    private Integer offset;
    private Integer limit;
    private Date startDate;
    private Date endDate ;
    private String userid;
    private String userParam;
    private Integer status;


}


```

#### 2ã€controllerå±‚

```java
@RequestMapping("data")
@ResponseBody
public ResponseBean data(@RequestParam(defaultValue = "0")Integer page, @RequestParam(defaultValue = "15")Integer pageSize, SysUserQuery query){
    try {
        Pageable pageable = new PageRequest(page,pageSize);
        return ResponseBean.buildSuccess(sysDingUserService.getDingUserData(pageable,query));
    } catch (AppException e) {
        return ResponseBean.buildFailure(e.getMessage());
    } catch (Exception e) {
        logger.error(e.getMessage(),e);
        return ResponseBean.buildFailure(ErrorCodeEnum.ç³»ç»Ÿé”™è¯¯);
    }
}
```



#### 3ã€serviceå±‚ï¼Œå°†pageableåˆ†é¡µå¯¹è±¡æ”¾å…¥



```java
 @Override
    public Page<SysDingUser> getDingUserData(Pageable pageable, SysUserQuery query) {

        query.setOffset(pageable.getOffset());
        query.setLimit(pageable.getPageSize());

        List<SysDingUser> list = sysMapper.findSysDingUserList(query);

        Long count = sysMapper.countSysDingUser(query);
        return new PageImpl<>(list, pageable, count);
    }
}

```   

#### 4ã€mybatisæŸ¥è¯¢è¯­å¥


```xml

<select id="findSysDingUserList" resultType="com.duodian.admore.entity.db.admin.SysDingUser">
    SELECT t.*, a.admId,b.name admName FROM sys_ding_user t
    LEFT JOIN sys_admin_user_ding a ON a.userid = t.userid
    LEFT JOIN sys_admin_user b ON b.id = a.admId
    <where>
        <if test="userParam != null and userParam != ''">
            and (t.userid = #{userParam} OR t.name LIKE CONCAT('%',#{userParam},'%' ) OR t.email LIKE CONCAT('%',#{userParam},'%' )
            OR t.orgEmail LIKE CONCAT('%',#{userParam},'%' ) OR t.mobile LIKE CONCAT('%',#{userParam},'%' ) OR t.position LIKE CONCAT('%',#{userParam},'%' ))
        </if>
    </where>
    ORDER BY t.id ASC
    limit #{offset}, #{limit}
</select>


```

### 11ã€sqlå–å‡ºåˆ¶ä½œDTOå¯¹è±¡

#### 1ã€å¯¹äºæ•°æ®åº“å­—æ®µåŒ¹é…çš„ï¼Œå¯ä»¥ç›´æ¥é€‰æ‹©
#### 2ã€å¯¹äºä¸åŒ¹é…çš„ä½¿ç”¨ as  è½¬åŒ–


```xml

<select id="findRedStartSpread" parameterType="com.duodian.admore.dao.db.redstart.query.RedStartSpreadQuery" resultType="com.duodian.admore.dao.db.redstart.bean.RedStartHistoryBean">
    SELECT
    k.trackId,
    e.smallIcon,
    e.formattedPrice,
    e.price,
    e.fileSizeBytes,
    e.trackName,
    f.name admName,
    a.nickName userName,

    DATE_FORMAT(k.spreadDateStart, '%Y-%m-%d') AS ymd,
    k.userId
    FROM
    redstart_spread k
```

### 11.1ã€RedStartHistoryBean


```java
public class RedStartHistoryBean implements Serializable {

    private Long userId;
    private String ymd;
    private String trackId;
    private String smallIcon;
    private String bundleId;
    private String formattedPrice;
    private BigDecimal price;
    private BigInteger fileSizeBytes;
    private String trackName;

    private String fileSizeDesc;   //æ–‡ä»¶å¤§å°æè¿°
    private String authName;
    private String admName;
    private String userName;

```

#### 11.2ã€RedStartSpreadQuery


```java
public class RedStartSpreadQuery implements Serializable {

    private Long userId;
    private String trackId;
    private String trackName;
    private Date startDate;
    private Date endDate;
    private String name;
    private Integer status;

    private Integer offset;
    private Integer limit;
    private Date point;

    private String userParam;
    private String appParam;
```


### 12ã€åªæœ‰ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ—¶å€™ï¼Œä¸ä½¿ç”¨æ³¨è§£@Param,ä¸èƒ½ç›´æ¥å†™å‚æ•°åå­—äº† è€Œæ˜¯ä½¿ç”¨ä¸‹é¢çš„_parameter

#### 1ã€mapepr.java


```java
List<CustomerChance> getCustomerList(Long adminId);

```


#### 2ã€mapper.xml

```xml

<select id="getCustomerList" resultType="com.duodian.admore.entity.db.customer.CustomerChance">
    SELECT *
    FROM `crm_customer_chance`  c
    where c.isVisible = 1
    <if test="_parameter != null">
        and c.adminId = #{_parameter}
    </if>
</select>

```

### 13ã€åŠ å…¥åŸç”Ÿç¬¦å·

 t.cdate >= #{startDate}
  


<![CDATA[]]>å’Œè½¬ä¹‰å­—ç¬¦
è¢«<![CDATA[]]>è¿™ä¸ªæ ‡è®°æ‰€åŒ…å«çš„å†…å®¹å°†è¡¨ç¤ºä¸ºçº¯æ–‡æœ¬ï¼Œæ¯”å¦‚<![CDATA[<]]>è¡¨ç¤ºæ–‡æœ¬å†…å®¹â€œ<â€ã€‚Â 
ã€€ã€€æ­¤æ ‡è®°ç”¨äºxmlæ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä½¿ç”¨è½¬ä¹‰ç¬¦çš„æƒ…å†µã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨xmlä¸­ï¼Œâ€<â€ã€â€>â€ã€â€&â€ç­‰å­—ç¬¦æ˜¯ä¸èƒ½ç›´æ¥å­˜å…¥çš„ï¼Œå¦åˆ™xmlè¯­æ³•æ£€æŸ¥æ—¶ä¼šæŠ¥é”™ï¼Œå¦‚æœæƒ³åœ¨xmlä¸­ä½¿ç”¨è¿™äº›ç¬¦å·ï¼Œå¿…é¡»å°†å…¶è½¬ä¹‰ä¸ºå®ä½“ï¼Œå¦‚â€&lt;â€ã€â€&gt;â€ã€â€&amp;â€ï¼Œè¿™æ ·æ‰èƒ½ä¿å­˜è¿›xmlæ–‡æ¡£ã€‚Â 
ã€€

#### 13.1ã€ä¸¾ä¾‹è¯´æ˜


```xml
 <sql id="pageSuffix">
    ) a where rownum <![CDATA[<=]]> #{end,jdbcType=INTEGER} ) b where b.rn <![CDATA[>]]> #{start,jdbcType=INTEGER}
  </sql>
```
 
### 14ã€ä¸€ä¸ªæ¡ä»¶åŒ¹é…å¤šä¸ªå­—æ®µ


```xml

<if test="userParam != null and userParam != ''">
    AND (t.userId = #{userParam}
          OR a.nickName LIKE CONCAT('%',#{userParam},'%' )
          OR b.realName LIKE CONCAT('%',#{userParam},'%' )
          OR c.realName LIKE CONCAT('%',#{userParam},'%' )
          OR t.customerId LIKE CONCAT('%',#{userParam},'%' )
          OR t.customerName LIKE CONCAT('%',#{userParam},'%'))
</if>


```

### 15ã€countè¯¦è§£

#### 1ã€è¿™æ ·è¾“å‡ºç»“æœåªæœ‰ä¸€è¡Œï¼Œå› ä¸ºcountï¼ˆ*ï¼‰æœ¬æ¥ä»£è¡¨çš„å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæœ¬èº«å°±æ˜¯ä¸€è¡Œ


```sql
SELECT  count(*) as "count",idfa from apps_click_record a; # WHERE  a.keywordId = '169995' GROUP  by idfa ORDER BY count(*) DESC ;

```





#### 2ã€ä½¿ç”¨groupåˆ†ç»„ ï¼ˆä¸‹é¢äºŒè€…æ˜¯ä¸€æ ·çš„ï¼‰ å…¶å®è¿™é‡Œå°±è¡¨ç¤ºåˆ†ç»„ä¹‹åæ¯ç»„çš„ä¸ªæ•°


```sql
SELECT  count(*) as "count",idfa from apps_click_record a WHERE  a.keywordId = '169995' GROUP  by idfa ORDER BY count(*) DESC ;
    
SELECT  count(idfa) as "count",idfa from apps_click_record a WHERE  a.keywordId = '169995' GROUP  by idfa ORDER BY count(*) DESC ;

```

#### 3ã€countï¼ˆ*ï¼‰ å’Œ * çš„æŸ¥è¯¢ æ˜¯é”™è¯¯çš„


```sql
ä¸‹é¢æ˜¯é”™è¯¯çš„

SELECT  count(*) as "count",* from apps_click_record a; 

```


### 18ã€deleteåˆ é™¤è¡¨ä¸­æ•°æ®


```xml
1,delete from user as u where u.userid=6; é”™è¯¯
2,delete from user u where u.userid=6; é”™è¯¯
3,delete from user where userid=6;  æ­£ç¡®
4,delete u.* from user u where u.userid=6; æ­£ç¡®
5,delete u from user u where u.userid=6; æ­£ç¡® 
```

### 19ã€è¯·æ±‚åˆ†é¡µå‚æ•°


#### 19.1ã€congtroller

```java
@GetMapping("getOriginData")
public Wrapper<?> getOriginData(String phone, Integer bankId, PageQuery pageQuery){

```


#### 19.2ã€DOTO

```java
@Setter
@ApiModel("åˆ†é¡µå¯¹è±¡")
@Accessors(chain = true)
public class PageQuery {

    @ApiModelProperty(value = "å¼€å§‹é¡µæ•°ï¼Œä»1å¼€å§‹",example = "1", required = true,dataType = "java.lang.Integer")
    private Integer pageNum = 1;
    @ApiModelProperty(value = "æ¯é¡µæ•°é‡",example = "20", required = true,dataType = "java.lang.Integer")
    private Integer pageSize = 20;
   

    public Integer getPageSize() {
        return pageSize == null ? 20 : pageSize;
    }

    public Integer getPageNum() {
        return pageNum == null ? 1 : pageNum;
    }
}


```

### 20ã€timestamp å¤šä¸ªæ—¥æœŸï¼Œå¦‚æœå¯èƒ½ä¸ºç©ºï¼Œåˆ™å»ºè®®ä½¿ç”¨datetime


é‡ç‚¹ï¼š2ã€@Temporal(TemporalType.DATE)æ’å…¥æ•°æ®åº“ä¸­çš„æ—¥æœŸä¼šè‡ªåŠ¨å˜æˆ 00.00.00ï¼Œåº”è¯¥ä½¿ç”¨TIMESTAMPï¼Œsqlä¸­æ˜¯datetime
<br/>

æ™®é€šå­—æ®µä¸è¦è®¾ç½®ä¸ºtimestampï¼Œtimestampåˆ—å¿…é¡»æœ‰é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼å¯ä»¥ä¸ºâ€œ0000-00-00 00:00:00â€ï¼Œä½†ä¸èƒ½ä¸ºnullã€‚å¦‚æœæˆ‘ä»¬åœ¨saveå®ä½“çš„æ—¶å€™ï¼Œæ²¡æœ‰ç»™ç›¸å…³timestampè®¾ç½®å€¼ï¼Œé‚£ä¹ˆä»–å°±ä¼šè‡ªåŠ¨ç”±mysqlå°†å½“å‰æ—¶é—´è®¾ç½®è¿›å»ï¼Œ cdateå’Œudateï¼Œéƒ½æ˜¯åœ¨javaåŸºç¡€ä¸Šæ§åˆ¶çš„


```java
æ­£ç¡®æ•°æ®

createTime datetime default null ,
clickTime datetime default null,

@Temporal(TemporalType.TIMESTAMP)
@ApiModelProperty(value = "åˆ›å»ºæ—¶é—´")
private Date createTime;

@Temporal(TemporalType.TIMESTAMP)
@ApiModelProperty(value = "ç‚¹å‡»æ—¶é—´")
private Date clickTime;



```


```java
ä¸‹é¢è¿™ä¸ªä¸å¯èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æ­£ç¡®çš„
cdate timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
udate timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,



@Temporal(TemporalType.TIMESTAMP)
@Column(columnDefinition="TIMESTAMP DEFAULT CURRENT_TIMESTAMP",insertable = true,updatable = false)
@ApiModelProperty(hidden = true)
private Date cdate;

@UpdateTimestamp
@Temporal(TemporalType.TIMESTAMP)
@ApiModelProperty(hidden = true)
private Date udate;

```


### 21ã€å¤šæ¡ä»¶æ’åº

ä¸¾ä¾‹ï¼šè®¢å•é™åº 1ï¼Œè®¢å•å‡åº 2 ï¼Œæˆäº¤é¢é™åº 3ï¼Œæˆäº¤é¢å‡åº 4ï¼Œ


```xml

<select id="findCouponTaoKeDataByParam" resultType="com.duodian.youhui.data.coupon.CouponTaoKeItemGoodSummaryData">
  SELECT c.itemTitle,COUNT(c.itemId) as orderSize,sum(c.estimateAmount) AS sumEstimateAmount ,c.adzoneName,c.adzonePid,c.createTime,c.itemId  FROM  coupon_taoke_data c
    <where>
        c.dataType = 1 and  c.status = 1
        <include refid="findCouponTaoKeDataByParamSQL"></include>
    </where>
    GROUP by c.itemId,c.adzonePid

    <if test="order != null">
        <choose>
            <when test="order == 1">
                order by    orderSize DESC
            </when>
            <when test="order == 2">
                order by    orderSize asc
            </when>
            <when test="order == 3">
                order by   sumEstimateAmount DESC
            </when>
            <when test="order == 4">
                order by   sumEstimateAmount asc
            </when>
        </choose>
    </if>

    <if test="offset != null and limit != ''">
        limit #{offset}, #{limit}
    </if>

</select>

```


#### 2ã€ç»™æ’åºæ·»åŠ éç©ºæ¡ä»¶

ä½¿ç”¨order byorderid descå®ç°é™åºæ—¶<br/>
orderid ä¸ºnullæ•°æ®çš„ä¼šæ’åœ¨æ•°æ®çš„æœ€åé¢ï¼›<br/><br/>

ä½†æ˜¯ï¼Œorder by orderidå‡åºæ—¶<br/>
orderid ä¸ºnullçš„æ•°æ®åˆ™ä¼šæ’åœ¨æœ€å‰é¢<br/><br/>

å¦‚æœæƒ³è¦å°†orderidä¸ºnullçš„æ•°æ®æ’åœ¨æœ€åï¼Œå°±éœ€è¦åŠ ä¸Šis nullã€‚

```sql

select * from b_programme u order by u.orderid is null, u.orderid

```


### 23ã€å‚æ•°ä¼ å…¥ä¸º0ï¼Œåˆ¤æ–­nullçš„æ—¶å€™

<font color="red">

#### 23.1ã€ç¬¬ä¸€ç§è§£å†³æ–¹æ³•ï¼Œä¸å»ºè®®

idä¼ å€¼ä¸º0æ—¶(å‰ææ˜¯idå¯¹åº”çš„ç±»å‹ä¸ºlong æˆ–è€…Â Integerï¼ŒStringå‹æ— æ­¤é—®é¢˜)ï¼Œå‘ç°å¹¶æ²¡æœ‰æ‰§è¡Œifé‡Œçš„sqlï¼Œå› ä¸ºåœ¨mybatisä¸­ä¼šè‡ªåŠ¨æŠŠ0å½“æˆâ€˜â€™ç©ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å»ºè®®ä»¥åä¼ å…¥è¿™ç§ç±»å‹çš„æ•°æ®ï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦ä¼ å…¥0ï¼Œå¯ä»¥å°†0æ”¹å˜ä¸ºå…¶ä»–çš„æ•°å­—ï¼Œæ¯”å¦‚5ç­‰  

</font>


```sql
    <if test="status == 5">
        and c.connectStatus = 0 and c.createAdminId is not NULL
    </if>
```

```java
List<CouponItemGood> dataByParam(@Param("status") Integer status,


```


```xml

<if test="status !=null and status !=''">
    <if test="status == 5">
        and c.connectStatus = 0 and c.createAdminId is not NULL
    </if>
    <if test="status == 1">
        and c.connectStatus = 1 and c.status = 1 and c.createAdminId is not NULL
    </if>
    <if test="status == 2">
        and c.connectStatus = 1 and c.status = 0 and c.createAdminId is not NULL
    </if>
    <if test="status == 3">
        and c.status = 2  and c.createAdminId is not NULL
    </if>
    <if test="status == 4">
        and c.createAdminId  is NULL
    </if>
    <if test="status == 6 ">
        and c.status  not in (0)  and c.zhiboStatus=1
    </if>
    <if test="status == 7 ">
        and c.scheduleDealStatus = 0 and c.createAdminId is not NULL
    </if>
</if>
```








#### 23.2ã€ç¬¬äºŒç§è§£å†³æ–¹æ³•

ä½¿ç”¨æ—¶å¢åŠ å¤šä¸€ä¸ªor status == 0åˆ¤æ–­

```xml
<if test="status != null and status !=Â  ''Â or status == 0">

```


### 24ã€æŸ¥è¯¢éšæœºæ•°ä¼˜åŒ–


#### 24.1 ã€æ€§èƒ½æ¯”è¾ƒå·®çš„ä¸€ä¸ª

RAND() Â å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå°äº1çš„éšæœºæ•°ã€€ã€€



```sql
BY RAND() LIMIT 1

```

```xml
<!--å¤±æ•ˆä¹‹åï¼Œä»é€‰å“åº“ä¸­éšä¾¿æ‰¾ä¸€ä¸ª -->
<select id="wechatSuiJiItemGoodImageUrl" resultType="java.lang.String">
    <![CDATA[
        SELECT c.erWeiMaInfoUrl FROM coupon_item_good c WHERE
          TIMESTAMPDIFF(DAY ,cdate,now())  < 5 ORDER BY RAND() LIMIT 1
    ]]>
</select>

```


#### 24.2ã€ä¼˜åŒ–

SQL ROUND() è¯­æ³•

```sql
SELECT ROUND(column_name,decimals) FROM table_name

```
|å‚æ•°|æè¿°|
|----|----|----|----|
|column_name|å¿…éœ€ã€‚è¦èˆå…¥çš„å­—æ®µ|
|decimals|å¿…éœ€ï¼Œè§„å®šè¿”å›çš„å°æ•°ä½æ•°|



```sql
éšæœºé€‰æ‹©ä¸€ä¸ªæ¨å¹¿ä½ï¼Œå…·ä½“æ¡ä»¶å°±æ˜¯ä¸‹é¢andä¸­è¿æ¥çš„and t1.status å¼€å§‹

<select id="findUserCouponAdzone" resultType="com.duodian.youhui.entity.db.coupon.CouponAdzone">
   <![CDATA[
        SELECT *
        FROM `coupon_adzone` AS t1
          JOIN (SELECT ROUND(RAND() * (SELECT MAX(id)
                                       FROM `coupon_adzone`)) AS id) AS t2
        WHERE t1.id >= t2.id 

and t1.status = 1 AND  t1.adzoneType = 3  and (TIMESTAMPDIFF(HOUR, t1.userUseTime, now()) > #{timeDiff} OR t1.userInfoId IS NULL )
        ORDER BY t1.id ASC
        LIMIT 1;
   ]]>
</select>
```

### 25ã€ GROUP_CONCAT  -sqlè¯­å¥å°†æŸä¸€åˆ—çš„å€¼æŸ¥è¯¢æˆï¼Œé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²


```sql
select GROUP_CONCAT(c.id) from coupon_item_good;


è¿”å›ç»“æœ

1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,23,24,25,26,27,28,29,30,31,32,33

```


### 26ã€find_in_set  æŸ¥è¯¢å­—æ®µä¸ºé€—å·éš”å¼€çš„å­—æ®µå±æ€§


å­—æ®µ pnumä¸ºé€—å·éš”å¼€çš„å­—ç¬¦ä¸²

```sql

1,2,3,4,21,9

select * from test  t where find_in_set(2,t.pnum) ;
```




### 27ã€whenï¼Œcaseã€è¿›è¡Œæ¡ä»¶åˆ¤æ–­


```sql

 case cp.ssid when 'aa' then '0' else'1' end as flag, "+
      " case cp.ssid when 'aa' then '3001' else '0000' end  as retCode,"+
```

```sql
"SELECT cp.ssid AS ssid," +
      " cp.accname AS accname," +
      " cp.PAYSUMUNTAX AS PAYSUMUNTAX," +
      " cp.PAYTAX AS PAYTAX," +
      " cp.payaftersum AS payAmt," +
      " cp.benetype AS benetype," +
      " cp.memo AS memo," +
    " case cp.ssid when 'aa' then '0' else'1' end as flag, "+
      " case cp.ssid when 'aa' then '3001' else '0000' end  as retCode,"+
      " to_char(sysdate,'yyyyMMdd') as drawDate,"+
      " to_char(sysdate,'HH24mmss') as drawTime"+
  " FROM CSIP_OA_PAYLISTINFO CPI" +
 " JOIN CSIP_OA_TASKFILE CT" +
   " ON CPI.PK_PAYLISTINFO = CT.PK_PAYLISTINFO" +
 " JOIN CSIP_OA_PAYLIST CP" +
   " ON CP.PK_TASKFILE = CT.PK_TASKFILE" +
" WHERE CPI.INNER_LISTNO = '"+inworkflowno+"'" ;
```















<br/><br/>
<font color="red"> æ„Ÿå…´è¶£çš„ï¼Œæ¬¢è¿æ·»åŠ åšä¸»å¾®ä¿¡ï¼Œ </font><br/>
å“ˆï¼Œåšä¸»å¾ˆä¹æ„å’Œå„è·¯å¥½å‹äº¤æµï¼Œå¦‚æœæ»¡æ„ï¼Œè¯·æ‰“èµåšä¸»ä»»æ„é‡‘é¢ï¼Œæ„Ÿå…´è¶£çš„åœ¨å¾®ä¿¡è½¬è´¦çš„æ—¶å€™ï¼Œå¤‡æ³¨æ‚¨çš„å¾®ä¿¡æˆ–è€…å…¶ä»–è”ç³»æ–¹å¼ã€‚æ·»åŠ åšä¸»å¾®ä¿¡å“¦ã€‚
<br/>
è¯·ä¸‹æ–¹ç•™è¨€å§ã€‚å¯ä¸åšä¸»è‡ªç”±è®¨è®ºå“¦

|æ”¯ä»˜åŒ… | å¾®ä¿¡|å¾®ä¿¡å…¬ä¼—å·|
|:-------:|:-------:|:------:|
|![æ”¯ä»˜å®](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/alpay.jpg) | ![å¾®ä¿¡](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/weixin.jpg)|![å¾®ä¿¡å…¬ä¼—å·](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/my/qrcode_for_gh_a23c07a2da9e_258.jpg)|




<!-- Gitalk è¯„è®º start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>Â 
<div id="gitalk-container"></div>Â    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'yGteDRHAXmN7alJz',
    });
    gitalk.render('gitalk-container');
</script>Â 

<!-- Gitalk end -->

