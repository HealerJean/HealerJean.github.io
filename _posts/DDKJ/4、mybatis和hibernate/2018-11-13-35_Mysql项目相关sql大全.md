---
title: mysqlé¡¹ç›®ç›¸å…³sqlå¤§å…¨_ç»ˆèº«å—ç”¨
date: 2018-12-17 03:33:00
tags: 
- Database
category: 
- Database
description: Mysqlé¡¹ç›®ç›¸å…³sqlå¤§å…¨_ç»ˆèº«å—ç”¨
---
<!-- image url 
https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages
ã€€ã€€é¦–è¡Œç¼©è¿›
<font color="red">  </font>

<font  color="red" size="4">   </font>


<font size="4">   </font>
-->

## 1ã€Mapç±»å‹çš„æ•°æ®è¿›è¡Œinsetæ’å…¥

æœ‰æ—¶å€™éœ€è¦ç®€å•åœ°æŠŠä¸€ä¸ªMapä¸­æ‰€æœ‰çš„keyå’Œvalueè·å–å‡ºæ¥ï¼Œæ‹¼åˆ°sqlè¯­å¥ä¸­ã€‚MyBatisæä¾›çš„ä¸€ç§æ–¹æ³•æ˜¯éå†Mapä¸­çš„entrySetï¼Œç„¶åæŠŠkeyæ‰”è¿›indexé‡Œé¢ï¼Œvalueæ‰”è¿›itemä¸­ã€‚å…·ä½“çš„ä¸€ä¸ªä½¿ç”¨çš„ä¾‹å­å¦‚ä¸‹ï¼š


```xml
<insertÂ id="operationName"Â parameterType="map">Â Â 
	Â Â Â Â INSERTÂ INTOÂ table_name(hot_word,Â cnt)Â Â 
	Â Â Â Â VALUESÂ Â 
	Â Â Â Â <foreachÂ item="value"Â index="key"Â collection="mapData.entrySet()"Â open="("Â separator="),("Â close=")">Â Â 
	Â Â Â Â Â Â Â Â #{key},Â #{value}Â Â 
	Â Â Â Â </foreach>Â Â 
	Â Â Â Â ONÂ DUPLICATEÂ KEYÂ UPDATEÂ Â 
	Â Â Â Â cnt=VALUES(cnt)Â Â 
</insert>
```


## 2ã€è·å–æ•°æ®ç»“æœä¸º`list<map<String,Object>>`


### 1ã€mapper


```java

public interface HealerJeanMapper {

     List<Map<String,Object>> sqlMap();
}
```


### 2ã€mapper.xml


```xml
<select id="sqlMap" resultType="java.util.HashMap">
  SELECT h.id as id ,h.subject as subject FROM  healerjean  h;
</select>

```

### 3ã€è§£é‡Šï¼š

1ã€è¿”å›ç±»å‹å¿…é¡»æ˜¯java.util.HashMap
2ã€mapä¸­çš„value å¿…é¡»æ˜¯Objecrt

### 4ã€controlleræµ‹è¯•

```java

@RequestMapping("sqlMap")
@ResponseBody
public List<Map<String,Object>> sqlMap(){
    return healerJeanMapper.sqlMap();
}
```

![](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/WEFASDFUMM.png)

## 3ã€mybatis è‡ªå®šä¹‰å‚æ•°ã€è¿”å›ç±»å‹map

1ã€å‚æ•°

```xml
<select id="getUserCount" parameterMap="getUserCountMap" statementType="CALLABLE"resultType="java.util.HashMap
>
        CALL ges_user_count(?,?)
 </select>     

<parameterMap type="java.util.Map" id="getUserCountMap">
   <parameter property="sexid" mode="IN" jdbcType="INTEGER"/>
   <parameter property="userCount" mode="OUT" jdbcType="INTEGER"/>
</parameterMap>

```

2ã€ç»“æœï¼Œè¿”å›å­—æ®µä¸€ä¸€åŒ¹é…ï¼Œæƒ³æƒ³ä¹‹å‰@Resultså’Œ@Result


```xml

  <resultMap id="BaseResultMap" type="com.taotao.pojo.TbUser" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="username" property="username" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="created" property="created" jdbcType="TIMESTAMP" />
    <result column="updated" property="updated" jdbcType="TIMESTAMP" />
  </resultMap>


```
3ã€è§£é‡Š
`property`å’Œ`column`åˆ†åˆ«æŒ‡å®šå®ä½“ç±»å±æ€§å’Œæ•°æ®è¡¨çš„åˆ—åã€‚



## 4ã€Ifçš„ä½¿ç”¨

### 1ã€mapperæ¥å£


```java
public interface CustomerMapper {

    List<Customer> findCustomerList( @Param("name") String name,
                                     @Param("status") Integer status,
                                     @Param("offset") Integer offset,
                                     @Param("limit") Integer limit);

}
```

### 2ã€mapper.xml sql'è¯­å¥

```xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.duodian.admore.dao.mybatis.customer.CustomerMapper">

    <select id="findCustomerList" resultType="com.duodian.admore.entity.db.customer.Customer">
        SELECT t.* from crm_customer t
        WHERE t.isVisiblisVisiblee = 1
        <if test="name != null and name != ''">
            and t.name like CONCAT('%','${name}','%' )
        </if>
        <if test="status != null">
            and t.status = #{status}
        </if>
        order by t.id DESC
        limit #{offset}, #{limit}
    </select>

    <select id="countCustomerList" resultType="java.lang.Long">
        select count(*) from crm_customer t
        WHERE t.isVisible = 1
        <if test="name != null and name != ''">
            and t.name like CONCAT('%','${name}','%' )
        </if>
        <if test="status != null">
            and t.status = #{status}
        </if>
    </select>

</mapper>

```

## 5ã€where  includeçš„ä½¿ç”¨<font color="red"> è‡ªåŠ¨åŠ where</font>

### 5.1ã€ä¸ä¼šå»é™¤ç¬¬ä¸€ä¸ªandï¼Œä¼šè‡ªåŠ¨åŠ ä¸Šwhere

```java

<select id="findUserAppsSpreadEffectList" resultType="com.duodian.admore.entity.db.apps.AppsSpreadEffectReport">
    SELECT t.*,b.trackName,b.smallIcon FROM apps_spread_effect_report t
    LEFT JOIN apps_user_app a ON a.trackId = t.trackId
    LEFT JOIN apps_app b ON b.trackId = t.trackId
    <where>
        <if test="userId != null">
            a.userId = #{userId}
        </if>
        <if test="startDate != null ">
            <![CDATA[ and t.spreadDate >=  #{startDate} ]]>
        </if>
        <if test="endDate != null ">
            <![CDATA[ and t.spreadDate <=  #{endDate} ]]>
        </if>
    </where>
    order by a.id desc
</select>


```

## 6ã€ã€foreach listç»“åˆä½œä¸ºå‚æ•°åœ¨mapperä¸­çš„æŸ¥è¯¢ï¼ˆtaskTypeList ä¸ºList<Integer>ï¼‰


```
 <if test="taskTypeList != null and taskTypeList.size() > 0"> and t.taskType IN
      <foreach collection="taskTypeList" index="index" item="at" open="(" separator="," close=")">
            #{at}
       </foreach>
</if>

```

```xml
<sql id="findVerifySignetWhere">
    <if test="startDate != null">
        <![CDATA[ and t.cdate >= #{startDate} ]]>
    </if>
    <if test="endDate != null">
        <![CDATA[ and t.cdate <= #{endDate} ]]>
    </if>
    <if test="userParam != null and userParam != '' and userParam!= 'undefined'">
        AND (t.userId = #{userParam} OR d.nickName LIKE CONCAT('%',#{userParam},'%' ) OR e.realName LIKE
        CONCAT('%',#{userParam},'%' ) OR f.realName LIKE CONCAT('%',#{userParam},'%' ) OR g.email LIKE
        CONCAT('%',#{userParam},'%' ))
    </if>
    <if test="taskType != null">
        and t.taskType = #{taskType}
    </if>
    <if test="taskTypeList != null and taskTypeList.size() > 0"> and t.taskType IN
      <foreach collection="taskTypeList" index="index" item="at" open="(" separator="," close=")">
            #{at}
       </foreach>
    </if>
    <if test="signetType != null">
        and t.type = #{signetType}
    </if>
    <if test="status != null">
        and t.status = #{status}
    </if>
    <if test="currAdmId4Auth != null ">
        <![CDATA[ and (h.admId = #{currAdmId4Auth} OR w.cc > 0) ]]>
    </if>
</sql>



```


## 7ã€choose when (ç›¸å½“äºif else)


```xml
    <choose>
        <when test="flag == 1">
            and t.status = 0
        </when>
        <when test="flag == 2">
            and t.status = 1
        </when>
        <when test="flag == 3">
            and t.expressStatus = 1
        </when>
        <when test="flag == 4">
            and t.status = -2
        </when>
        <otherwise>
        <y/otherwise>
    </choose>

```

## 8ã€ifnull ï¼ˆå¦‚æœä¸æ˜¯ç©ºè¿”å›ç¬¬ä¸€ä¸ªï¼Œå¦åˆ™è¿”å›ç¬¬äºŒä¸ªï¼‰

```xml
    ifnull(b.realName,c.realName) authName,

```

```xml

<select id="findRedStartSpread" parameterType="com.duodian.admore.dao.db.redstart.query.RedStartSpreadQuery" resultType="com.duodian.admore.dao.db.redstart.bean.RedStartHistoryBean">
    SELECT
    k.trackId,
    e.smallIcon,
    e.formattedPrice,
    e.price,
    e.fileSizeBytes,
    e.trackName,
    f.name admName,
    a.nickName userName,
    ifnull(b.realName,c.realName) authName,
    DATE_FORMAT(k.spreadDateStart, '%Y-%m-%d') AS ymd,
    k.userId
    FROM
    redstart_spread k


```


## 9ã€‚åˆ¶ä½œå‚æ•°ä¸ºmapå€¼è¿›è¡Œä¼ å…¥ï¼ˆopté¡¹ç›®SkinsControllerï¼‰

### 1ã€controlleræ¥æ”¶å‚æ•°


```java
@RequestMapping("data")
@ResponseBody
public ResponseBean data(String name,
					  Integer type,
					  Integer status,@RequestParam(value = "page",defaultValue = "0") Integer page){
  
        int pageSize = 15;
        Pageable pageable = new PageRequest(page,pageSize);
        Page<SkinAppInfoData> dataPage = skinsService.findSkinAppInfoList(pageable,"name",name,"type",type,"status",status);
        return ResponseBean.buildSuccess(dataPage);

}
```


### 2ã€service åˆ¶ä½œmapå‚æ•°ï¼ˆä¸‹é¢çš„åŠŸèƒ½æ˜¯æ¨¡ç³ŠæŸ¥è¯¢ğŸ åˆ†é¡µï¼‰

1ã€serviceæ¥å£

```java

public Page<SkinAppInfoData> findSkinAppInfoList(Pageable pageable, Object... param) throws AppException;
```

2ã€serviceå¼€å§‹å®ç° ï¼ˆpageable ä¸»è¦æ˜¯åˆ©ç”¨é‡Œé¢çš„å‚æ•°åˆ¶ä½œlimitå‚æ•°çš„ï¼‰


```java
@Override
public Page<SkinAppInfoData> findSkinAppInfoList(Pageable pageable, Object... param) throws AppException {
    Map data = MyBatisHelper.mergeParameterMap(pageable,param);

if(data.get("startDate") != null){
    Date startDate = (Date) data.get("startDate");
    data.put("startDate", com.duodian.admore.core.helper.DateHelper.getDateFirstTime(startDate));
}
if(data.get("endDate") != null){
    Date endDate = (Date) data.get("endDate");
    data.put("endDate", com.duodian.admore.core.helper.DateHelper.getDateLastTime(endDate));
}

    List<SkinAppInfoData> dataList = skinsMapper.findSkinList(data);

    for(SkinAppInfoData skinAppInfoData :dataList){
        List<ChannelJson> channelJsonList = new ArrayList<>();
        if(skinAppInfoData.getChannelJson()!=null&&!"".equals(skinAppInfoData.getChannelJson())) {
            JSONArray jsonArray = JSONArray.fromObject(skinAppInfoData.getChannelJson());
            for (int i = 0; i < jsonArray.size(); i++) {
                ObjectMapper objectMapper = new ObjectMapper();
                try {
                    ChannelJson channelJson = objectMapper.readValue(jsonArray.get(i).toString(), ChannelJson.class);
                    channelJsonList.add(channelJson);
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
        skinAppInfoData.setChannelJsonList(channelJsonList);

    }

    Long count = skinsMapper.countSkinList(data);
    return new PageImpl<SkinAppInfoData>(dataList,pageable,count);
}
```


### 3ã€MyBatisHelperå·¥å…·æ 

```java

public class MyBatisHelper {
    public static final String PARAM_OFFSET = "offset";
    public static final String PARAM_LIMIT = "limit";

    public MyBatisHelper() {
    }

    public static Map<String, Object> mergeParameterMap(Object... parameter) {
        if (parameter.length % 2 != 0) {
            throw new IllegalArgumentException("parameteré¡»ä¸ºkey-valueå¯¹åº”å‚æ•°");
        } else {
            Map<String, Object> map = new HashMap();

            for(int i = 0; i < parameter.length; i += 2) {
                map.put(parameter[i].toString(), parameter[i + 1]);
            }

            return map;
        }
    }

    public static Map<String, Object> mergeParameterMap(Pageable pageable, Object... parameter) {
        if (parameter.length % 2 != 0) {
            throw new IllegalArgumentException("parameteré¡»ä¸ºkey-valueå¯¹åº”å‚æ•°");
        } else {
            Map<String, Object> map = new HashMap();
            map.put("offset", pageable.getOffset());
            map.put("limit", pageable.getPageSize());

            for(int i = 0; i < parameter.length; i += 2) {
                map.put(parameter[i].toString(), parameter[i + 1]);
            }

            return map;
        }
    }
}
```



### 4ã€mapper.java ï¼ˆä¸‹é¢è¿™ä¸¤ä¸ªå…¶å®å°±æ˜¯ä¸“é—¨ç”¨æ¥åšåˆ¶ä½œpageåˆ†é¡µçš„ï¼‰


```java
public interface SkinsMapper {

    public List<SkinAppInfoData> findSkinList(Map param);

    public Long countSkinList(Map param);

}
```


```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.duodian.admore.dao.db.skins.SkinsMapper">

    <select id="findSkinList" resultType="com.duodian.admore.data.skins.SkinAppInfoData">
        SELECT
            A1.`appid`,
            A1.`appSecret`,
            A1.`icon`,
            A1.`makerMemo`,
            A1.`haveBackstage`,
            A1.`channelJson`,
            A1.`filePath`
        FROM  `skin_app_info_check`  a1
        where A1.status not in (9)
        <if test="name != null and name != ''">
            AND (A1.trackId = #{name}
            OR A1.name LIKE CONCAT('%',#{name},'%' )
            OR A1.appid LIKE CONCAT('%',#{name},'%' )
            OR A1.appSecret LIKE CONCAT('%',#{name},'%' )
            )
        </if>
        <if test="type != null and type != '' ">
            and A1.type = #{type}
        </if>
        <if test="status != null and status != '' ">
            and  A1.status = #{status}
        </if>
        order by A1.cdate desc
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="countSkinList" resultType="java.lang.Long">
        SELECT
              count(*)
            FROM   `skin_app_info_check`      A1
            where A1.status != 9
            <if test="name != null and name != ''">
                AND (A1.trackId = #{trackId} OR A1.name LIKE CONCAT('%',#{name},'%' ))
            </if>
            <if test="type != null">
                and A1.type = #{type}
            </if>
            <if test="status != null">
                and A1.status = #{status}
            </if>
    </select>
</mapper>

```


### 5ã€æœ‰åˆ†ç»„çš„


```xml


    <select id="findCouponTaoKeDataByParam" resultType="com.duodian.youhui.data.coupon.CouponTaoKeItemGoodSummaryData">
        SELECT c.itemTitle,
        COUNT(c.itemId) as orderSize,
        sum(c.estimateAmount) AS sumEstimateAmount ,
        sum(c.payAmount) AS transAmount,
        c.adzoneName,
        c.adzonePid,
        c.createTime,
        date_format(c.createTime,'%Y-%m-%d') as everyDate,
        c.itemId  FROM  coupon_taoke_data c

        <where>
            c.dataType = 1 and c.orderStatus not in ('è®¢å•å¤±æ•ˆ') and c.status = 1
            <include refid="findCouponTaoKeDataByParamSQL"></include>
        </where>

        <choose>
            <when test="isLinkCome==1">
                GROUP by c.itemId, date_format(c.createTime,'%Y-%m-%d'), c.adzonePid
            </when>
            <otherwise>
                GROUP by c.itemId,c.adzonePid
            </otherwise>
        </choose>

        <choose>
            <when  test="order != null">
                     order by  ${order}
            </when>
            <otherwise>
                <choose>
                    <when test="isLinkCome==1">
                        order by date_format(c.createTime,'%Y-%m-%d') DESC
                    </when>
                </choose>
            </otherwise>
        </choose>



        <if test="offset != null and limit != ''">
            limit #{offset}, #{limit}
        </if>

    </select>

    <select id="countFindCouponTaoKeDataByParam" resultType="java.lang.Long">
        select count(*) from (
        SELECT c.itemTitle FROM  coupon_taoke_data c
        <where>
            c.dataType = 1 and c.orderStatus not in ('è®¢å•å¤±æ•ˆ') and c.status = 1
            <include refid="findCouponTaoKeDataByParamSQL"></include>
        </where>
        <choose>
            <when test="isLinkCome==1">
                GROUP by c.itemId, date_format(c.createTime,'%Y-%m-%d'), c.adzonePid
            </when>
            <otherwise>
                GROUP by c.itemId,c.adzonePid
            </otherwise>
        </choose>
        ) as a
    </select>



```

## 10ã€æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œç±»ä¼¼äº9ä¸­çš„map

### 1ã€queryå¯¹è±¡ (æŸ¥è¯¢å‚æ•°)


```java
public class SysUserQuery implements Serializable {

    private static final long serialVersionUID = -4564423981924197001L;

    private Long id;
    private Integer offset;
    private Integer limit;
    private Date startDate;
    private Date endDate ;
    private String userid;
    private String userParam;
    private Integer status;


}


```

### 2ã€controllerå±‚

```java
@RequestMapping("data")
@ResponseBody
public ResponseBean data(@RequestParam(defaultValue = "0")Integer page, @RequestParam(defaultValue = "15")Integer pageSize, SysUserQuery query){
    try {
        Pageable pageable = new PageRequest(page,pageSize);
        return ResponseBean.buildSuccess(sysDingUserService.getDingUserData(pageable,query));
    } catch (AppException e) {
        return ResponseBean.buildFailure(e.getMessage());
    } catch (Exception e) {
        logger.error(e.getMessage(),e);
        return ResponseBean.buildFailure(ErrorCodeEnum.ç³»ç»Ÿé”™è¯¯);
    }
}
```



### 3ã€serviceå±‚ï¼Œå°†pageableåˆ†é¡µå¯¹è±¡æ”¾å…¥



```java
 @Override
    public Page<SysDingUser> getDingUserData(Pageable pageable, SysUserQuery query) {

        query.setOffset(pageable.getOffset());
        query.setLimit(pageable.getPageSize());

        List<SysDingUser> list = sysMapper.findSysDingUserList(query);

        Long count = sysMapper.countSysDingUser(query);
        return new PageImpl<>(list, pageable, count);
    }
}

```   

### 4ã€mybatisæŸ¥è¯¢è¯­å¥


```xml

<select id="findSysDingUserList" resultType="com.duodian.admore.entity.db.admin.SysDingUser">
    SELECT t.*, a.admId,b.name admName FROM sys_ding_user t
    LEFT JOIN sys_admin_user_ding a ON a.userid = t.userid
    LEFT JOIN sys_admin_user b ON b.id = a.admId
    <where>
        <if test="userParam != null and userParam != ''">
            and (t.userid = #{userParam} OR t.name LIKE CONCAT('%',#{userParam},'%' ) OR t.email LIKE CONCAT('%',#{userParam},'%' )
            OR t.orgEmail LIKE CONCAT('%',#{userParam},'%' ) OR t.mobile LIKE CONCAT('%',#{userParam},'%' ) OR t.position LIKE CONCAT('%',#{userParam},'%' ))
        </if>
    </where>
    ORDER BY t.id ASC
    limit #{offset}, #{limit}
</select>


```

## 11ã€sqlå–å‡ºåˆ¶ä½œDTOå¯¹è±¡

### 1ã€å¯¹äºæ•°æ®åº“å­—æ®µåŒ¹é…çš„ï¼Œå¯ä»¥ç›´æ¥é€‰æ‹©
### 2ã€å¯¹äºä¸åŒ¹é…çš„ä½¿ç”¨ as  è½¬åŒ–


```xml

<select id="findRedStartSpread" parameterType="com.duodian.admore.dao.db.redstart.query.RedStartSpreadQuery" resultType="com.duodian.admore.dao.db.redstart.bean.RedStartHistoryBean">
    SELECT
    k.trackId,
    e.smallIcon,
    e.formattedPrice,
    e.price,
    e.fileSizeBytes,
    e.trackName,
    f.name admName,
    a.nickName userName,

    DATE_FORMAT(k.spreadDateStart, '%Y-%m-%d') AS ymd,
    k.userId
    FROM
    redstart_spread k
```

### 11.1ã€RedStartHistoryBean


```java
public class RedStartHistoryBean implements Serializable {

    private Long userId;
    private String ymd;
    private String trackId;
    private String smallIcon;
    private String bundleId;
    private String formattedPrice;
    private BigDecimal price;
    private BigInteger fileSizeBytes;
    private String trackName;

    private String fileSizeDesc;   //æ–‡ä»¶å¤§å°æè¿°
    private String authName;
    private String admName;
    private String userName;

```

### 11.2ã€RedStartSpreadQuery


```java
public class RedStartSpreadQuery implements Serializable {

    private Long userId;
    private String trackId;
    private String trackName;
    private Date startDate;
    private Date endDate;
    private String name;
    private Integer status;

    private Integer offset;
    private Integer limit;
    private Date point;

    private String userParam;
    private String appParam;
```


## 12ã€åªæœ‰ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ—¶å€™ï¼Œä¸ä½¿ç”¨æ³¨è§£@Param,ä¸èƒ½ç›´æ¥å†™å‚æ•°åå­—äº† è€Œæ˜¯ä½¿ç”¨ä¸‹é¢çš„_parameter

### 1ã€mapepr.java


```java
List<CustomerChance> getCustomerList(Long adminId);

```


### 2ã€mapper.xml

```xml

<select id="getCustomerList" resultType="com.duodian.admore.entity.db.customer.CustomerChance">
    SELECT *
    FROM `crm_customer_chance`  c
    where c.isVisible = 1
    <if test="_parameter != null">
        and c.adminId = #{_parameter}
    </if>
</select>

```

## 13ã€åŠ å…¥åŸç”Ÿç¬¦å·

 t.cdate >= #{startDate}
  


<![CDATA[]]>å’Œè½¬ä¹‰å­—ç¬¦
è¢«<![CDATA[]]>è¿™ä¸ªæ ‡è®°æ‰€åŒ…å«çš„å†…å®¹å°†è¡¨ç¤ºä¸ºçº¯æ–‡æœ¬ï¼Œæ¯”å¦‚<![CDATA[<]]>è¡¨ç¤ºæ–‡æœ¬å†…å®¹â€œ<â€ã€‚Â 
ã€€ã€€æ­¤æ ‡è®°ç”¨äºxmlæ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä½¿ç”¨è½¬ä¹‰ç¬¦çš„æƒ…å†µã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨xmlä¸­ï¼Œâ€<â€ã€â€>â€ã€â€&â€ç­‰å­—ç¬¦æ˜¯ä¸èƒ½ç›´æ¥å­˜å…¥çš„ï¼Œå¦åˆ™xmlè¯­æ³•æ£€æŸ¥æ—¶ä¼šæŠ¥é”™ï¼Œå¦‚æœæƒ³åœ¨xmlä¸­ä½¿ç”¨è¿™äº›ç¬¦å·ï¼Œå¿…é¡»å°†å…¶è½¬ä¹‰ä¸ºå®ä½“ï¼Œå¦‚â€&lt;â€ã€â€&gt;â€ã€â€&amp;â€ï¼Œè¿™æ ·æ‰èƒ½ä¿å­˜è¿›xmlæ–‡æ¡£ã€‚Â 
ã€€

### 13.1ã€ä¸¾ä¾‹è¯´æ˜

<font  color="red" size="4">ä½†æ˜¯åœ¨mybaitsæ‰§è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ <![CDATA[>]]>  ç›´æ¥ >=ä¹Ÿæ²¡æœ‰æç¤ºæŠ¥é”™
  </font>

```xml
 <sql id="pageSuffix">
    ) a where rownum <![CDATA[<=]]> #{end,jdbcType=INTEGER} ) b where b.rn <![CDATA[>]]> #{start,jdbcType=INTEGER}
  </sql>
```
 
## 14ã€ä¸€ä¸ªæ¡ä»¶åŒ¹é…å¤šä¸ªå­—æ®µ

****
```xml

<if test="userParam != null and userParam != ''">
    AND (t.userId = #{userParam}
          OR a.nickName LIKE CONCAT('%',#{userParam},'%' )
          OR b.realName LIKE CONCAT('%',#{userParam},'%' )
          OR c.realName LIKE CONCAT('%',#{userParam},'%' )
          OR t.customerId LIKE CONCAT('%',#{userParam},'%' )
          OR t.customerName LIKE CONCAT('%',#{userParam},'%'))
</if>


```

## 15ã€countè¯¦è§£

### 1ã€è¿™æ ·è¾“å‡ºç»“æœåªæœ‰ä¸€è¡Œï¼Œå› ä¸ºcountï¼ˆ*ï¼‰æœ¬æ¥ä»£è¡¨çš„å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæœ¬èº«å°±æ˜¯ä¸€è¡Œ


```sql
SELECT  count(*) as "count",idfa from apps_click_record a; 

```





### 2ã€ä½¿ç”¨groupåˆ†ç»„ ï¼ˆä¸‹é¢äºŒè€…æ˜¯ä¸€æ ·çš„ï¼‰ å…¶å®è¿™é‡Œå°±è¡¨ç¤ºåˆ†ç»„ä¹‹åæ¯ç»„çš„ä¸ªæ•°


```sql
SELECT  count(*) as "count",idfa from apps_click_record a WHERE  a.keywordId = '169995' GROUP  by idfa ORDER BY count(*) DESC ;
    
SELECT  count(idfa) as "count",idfa from apps_click_record a WHERE  a.keywordId = '169995' GROUP  by idfa ORDER BY count(*) DESC ;

```

### 3ã€countï¼ˆ*ï¼‰ å’Œ * çš„æŸ¥è¯¢ æ˜¯é”™è¯¯çš„


```sql
ä¸‹é¢æ˜¯é”™è¯¯çš„

SELECT  count(*) as "count",* from apps_click_record a; 

```

### 4ã€æŸ¥æ‰¾æ•°group byåˆ†ç»„åçš„ä¸ªæ•°ï¼Œä½¿ç”¨åµŒå¥—


```sql

select count(*) from 
(
    select sum(b.id) from B b group by b.type
) m

```

### 5ã€count(distinct Sname)å»æ‰é‡å¤å¾—åˆ°å”¯ä¸€çš„æ•°é‡

## 18ã€deleteåˆ é™¤è¡¨ä¸­æ•°æ®


```xml
1,delete from user as u where u.userid=6; é”™è¯¯
2,delete from user u where u.userid=6; é”™è¯¯
3,delete from user where userid=6;  æ­£ç¡®
4,delete u.* from user u where u.userid=6; æ­£ç¡®
5,delete u from user u where u.userid=6; æ­£ç¡® 
```

## 19ã€è¯·æ±‚åˆ†é¡µå‚æ•°


### 19.1ã€congtroller

```java
@GetMapping("getOriginData")
public Wrapper<?> getOriginData(String phone, Integer bankId, PageQuery pageQuery){

```


### 19.2ã€DOTO

```java
@Setter
@ApiModel("åˆ†é¡µå¯¹è±¡")
@Accessors(chain = true)
public class PageQuery {

    @ApiModelProperty(value = "å¼€å§‹é¡µæ•°ï¼Œä»1å¼€å§‹",example = "1", required = true,dataType = "java.lang.Integer")
    private Integer pageNum = 1;
    @ApiModelProperty(value = "æ¯é¡µæ•°é‡",example = "20", required = true,dataType = "java.lang.Integer")
    private Integer pageSize = 20;
   

    public Integer getPageSize() {
        return pageSize == null ? 20 : pageSize;
    }

    public Integer getPageNum() {
        return pageNum == null ? 1 : pageNum;
    }
}


```

## 20ã€timestamp å¤šä¸ªæ—¥æœŸï¼Œå¦‚æœå¯èƒ½ä¸ºç©ºï¼Œåˆ™å»ºè®®ä½¿ç”¨datetime


é‡ç‚¹ï¼š2ã€@Temporal(TemporalType.DATE)æ’å…¥æ•°æ®åº“ä¸­çš„æ—¥æœŸä¼šè‡ªåŠ¨å˜æˆ 00.00.00ï¼Œåº”è¯¥ä½¿ç”¨TIMESTAMPï¼Œsqlä¸­æ˜¯datetime
<br/>

æ™®é€šå­—æ®µä¸è¦è®¾ç½®ä¸ºtimestampï¼Œtimestampåˆ—å¿…é¡»æœ‰é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼å¯ä»¥ä¸ºâ€œ0000-00-00 00:00:00â€ï¼Œä½†ä¸èƒ½ä¸ºnullã€‚å¦‚æœæˆ‘ä»¬åœ¨saveå®ä½“çš„æ—¶å€™ï¼Œæ²¡æœ‰ç»™ç›¸å…³timestampè®¾ç½®å€¼ï¼Œé‚£ä¹ˆä»–å°±ä¼šè‡ªåŠ¨ç”±mysqlå°†å½“å‰æ—¶é—´è®¾ç½®è¿›å»ï¼Œ cdateå’Œudateï¼Œéƒ½æ˜¯åœ¨javaåŸºç¡€ä¸Šæ§åˆ¶çš„


```java
æ­£ç¡®æ•°æ®

createTime datetime default null ,
clickTime datetime default null,

@Temporal(TemporalType.TIMESTAMP)
@ApiModelProperty(value = "åˆ›å»ºæ—¶é—´")
private Date createTime;

@Temporal(TemporalType.TIMESTAMP)
@ApiModelProperty(value = "ç‚¹å‡»æ—¶é—´")
private Date clickTime;



```


```java
ä¸‹é¢è¿™ä¸ªä¸å¯èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æ­£ç¡®çš„
cdate timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
udate timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,



@Temporal(TemporalType.TIMESTAMP)
@Column(columnDefinition="TIMESTAMP DEFAULT CURRENT_TIMESTAMP",insertable = true,updatable = false)
@ApiModelProperty(hidden = true)
private Date cdate;

@UpdateTimestamp
@Temporal(TemporalType.TIMESTAMP)
@ApiModelProperty(hidden = true)
private Date udate;

```

### 20.1ã€mybatisæ—¥æœŸæŠ¥é”™

#### å¼‚å¸¸ï¼š`invalid comparison: java.util.Date and java.lang.Stringã€‚`

```xml
<if test="date!= null and date !=''">
dateä¸ºDateç±»å‹ï¼Œä¸èƒ½å’Œâ€˜â€™æ¯”è¾ƒï¼Œåªåˆ¤æ–­æ˜¯ä¸æ˜¯nullå°±è¡Œå•¦:

<if test="date!= null">

```

## 21ã€å¤šæ¡ä»¶æ’åº

ä¸¾ä¾‹ï¼šè®¢å•é™åº 1ï¼Œè®¢å•å‡åº 2 ï¼Œæˆäº¤é¢é™åº 3ï¼Œæˆäº¤é¢å‡åº 4ï¼Œ


```xml

<select id="findCouponTaoKeDataByParam" resultType="com.duodian.youhui.data.coupon.CouponTaoKeItemGoodSummaryData">
  SELECT c.itemTitle,COUNT(c.itemId) as orderSize,sum(c.estimateAmount) AS sumEstimateAmount ,c.adzoneName,c.adzonePid,c.createTime,c.itemId  FROM  coupon_taoke_data c
    <where>
        c.dataType = 1 and  c.status = 1
        <include refid="findCouponTaoKeDataByParamSQL"></include>
    </where>
    GROUP by c.itemId,c.adzonePid

    <if test="order != null">
        <choose>
            <when test="order == 1">
                order by    orderSize DESC
            </when>
            <when test="order == 2">
                order by    orderSize asc
            </when>
            <when test="order == 3">
                order by   sumEstimateAmount DESC
            </when>
            <when test="order == 4">
                order by   sumEstimateAmount asc
            </when>
        </choose>
    </if>

    <if test="offset != null and limit != ''">
        limit #{offset}, #{limit}
    </if>

</select>

```


### 2ã€ç»™æ’åºæ·»åŠ éç©ºæ¡ä»¶

ä½¿ç”¨order byorderid descå®ç°é™åºæ—¶<br/>
orderid ä¸ºnullæ•°æ®çš„ä¼šæ’åœ¨æ•°æ®çš„æœ€åé¢ï¼›<br/><br/>

ä½†æ˜¯ï¼Œorder by orderidå‡åºæ—¶<br/>
orderid ä¸ºnullçš„æ•°æ®åˆ™ä¼šæ’åœ¨æœ€å‰é¢<br/><br/>

å¦‚æœæƒ³è¦å°†orderidä¸ºnullçš„æ•°æ®æ’åœ¨æœ€åï¼Œå°±éœ€è¦åŠ ä¸Šis nullã€‚

```sql

select * from b_programme u order by u.orderid is null, u.orderid

```

### 3ã€æ­£ç¡®çš„å¤šæ¡ä»¶æ’åºï¼Œæ’åºå­—æ®µç”±å‰ç«¯è¿›è¡Œä¼ å…¥`${order}`


```sql
    
        <choose>
            <when  test="order != null">
                     order by  ${order}
            </when>
            <otherwise>
                <choose>
                    <when test="isLinkCome==1">
                        order by date_format(c.createTime,'%Y-%m-%d') DESC
                    </when>
                </choose>
            </otherwise>
        </choose>


```


## 23ã€å‚æ•°ä¼ å…¥ä¸º0ï¼Œåˆ¤æ–­nullçš„æ—¶å€™

<font color="red">

### 23.1ã€ç¬¬ä¸€ç§è§£å†³æ–¹æ³•ï¼Œä¸å»ºè®®

idä¼ å€¼ä¸º0æ—¶(å‰ææ˜¯idå¯¹åº”çš„ç±»å‹ä¸ºlong æˆ–è€…Â Integerï¼ŒStringå‹æ— æ­¤é—®é¢˜)ï¼Œå‘ç°å¹¶æ²¡æœ‰æ‰§è¡Œifé‡Œçš„sqlï¼Œå› ä¸ºåœ¨mybatisä¸­ä¼šè‡ªåŠ¨æŠŠ0å½“æˆâ€˜â€™ç©ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å»ºè®®ä»¥åä¼ å…¥è¿™ç§ç±»å‹çš„æ•°æ®ï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦ä¼ å…¥0ï¼Œå¯ä»¥å°†0æ”¹å˜ä¸ºå…¶ä»–çš„æ•°å­—ï¼Œæ¯”å¦‚5ç­‰  

</font>


```sql
    <if test="status == 5">
        and c.connectStatus = 0 and c.createAdminId is not NULL
    </if>
```

```java
List<CouponItemGood> dataByParam(@Param("status") Integer status,


```


```xml

<if test="status !=null and status !=''">
    <if test="status == 5">
        and c.connectStatus = 0 and c.createAdminId is not NULL
    </if>
    <if test="status == 1">
        and c.connectStatus = 1 and c.status = 1 and c.createAdminId is not NULL
    </if>
    <if test="status == 2">
        and c.connectStatus = 1 and c.status = 0 and c.createAdminId is not NULL
    </if>
    <if test="status == 3">
        and c.status = 2  and c.createAdminId is not NULL
    </if>
    <if test="status == 4">
        and c.createAdminId  is NULL
    </if>
    <if test="status == 6 ">
        and c.status  not in (0)  and c.zhiboStatus=1
    </if>
    <if test="status == 7 ">
        and c.scheduleDealStatus = 0 and c.createAdminId is not NULL
    </if>
</if>
```








### 23.2ã€ç¬¬äºŒç§è§£å†³æ–¹æ³•

ä½¿ç”¨æ—¶å¢åŠ å¤šä¸€ä¸ªor status == 0åˆ¤æ–­

```xml
<if test="status != null and status !=Â  ''Â or status == 0">

```


## 24ã€æŸ¥è¯¢éšæœºæ•°ä¼˜åŒ–


#### 24.1 ã€æ€§èƒ½æ¯”è¾ƒå·®çš„ä¸€ä¸ª

RAND() Â å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå°äº1çš„éšæœºæ•°ã€€ã€€



```sql
BY RAND() LIMIT 1

```

```xml
<!--å¤±æ•ˆä¹‹åï¼Œä»é€‰å“åº“ä¸­éšä¾¿æ‰¾ä¸€ä¸ª -->
<select id="wechatSuiJiItemGoodImageUrl" resultType="java.lang.String">
    <![CDATA[
        SELECT c.erWeiMaInfoUrl FROM coupon_item_good c WHERE
          TIMESTAMPDIFF(DAY ,cdate,now())  < 5 ORDER BY RAND() LIMIT 1
    ]]>
</select>

```


#### 24.2ã€ä¼˜åŒ–

SQL ROUND() è¯­æ³•

```sql
SELECT ROUND(column_name,decimals) FROM table_name

```


|å‚æ•°|æè¿°|
|----|----|----|----|
|column_name|å¿…éœ€ã€‚è¦èˆå…¥çš„å­—æ®µ|
|decimals|éå¿…éœ€ï¼Œè§„å®šè¿”å›çš„å°æ•°ä½æ•°ï¼Œå¦‚æœä¸ç»™å€¼ï¼Œåˆ™è‡ªåŠ¨å››èˆäº”å…¥å–æ•´å–æ•´ï¼Œselect round(100.9) ;  101|




```sql

éšæœºé€‰æ‹©ä¸€ä¸ªidï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¤§äºä»–çš„æ•°æ®ï¼Œlimitæ§åˆ¶ä¸º1
éšæœºé€‰æ‹©ä¸€ä¸ªæ¨å¹¿ä½ï¼Œå…·ä½“æ¡ä»¶å°±æ˜¯ä¸‹é¢andä¸­è¿æ¥çš„and t1.status å¼€å§‹

>     <select id="findUserCouponAdzone" resultType="com.duodian.youhui.entity.db.coupon.CouponAdzone">
   <![CDATA[
        SELECT *
        FROM `coupon_adzone` AS t1
          JOIN (SELECT ROUND(RAND() * (SELECT MAX(id)
                                       FROM `coupon_adzone`)) AS id) AS t2
        WHERE t1.id >= t2.id 

and t1.status = 1 AND  t1.adzoneType = 3  and (TIMESTAMPDIFF(HOUR, t1.userUseTime, now()) > #{timeDiff} OR t1.userInfoId IS NULL )
        ORDER BY t1.id ASC
        LIMIT 1;
   ]]>
</select>
```

## 25ã€ GROUP_CONCAT  -sqlè¯­å¥å°†æŸä¸€åˆ—çš„å€¼æŸ¥è¯¢æˆï¼Œé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²
# 

```sql
select GROUP_CONCAT(c.id) from coupon_item_good;


è¿”å›ç»“æœ

1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,23,24,25,26,27,28,29,30,31,32,33

```


## 26ã€find_in_set  æŸ¥è¯¢å­—æ®µä¸ºé€—å·éš”å¼€çš„å­—æ®µå±æ€§


å­—æ®µ pnumä¸ºé€—å·éš”å¼€çš„å­—ç¬¦ä¸²

```sql

1,2,3,4,21,9

select * from test  t where find_in_set(2,t.pnum) ;
```

æŸ¥çœ‹æŸä¸ªå­—ç¬¦ä¸²ä¸­å­˜åœ¨


```sql

update site set url =concat('http://',url) where locate('http://',url)=0 

```



## 27ã€whenï¼Œcaseã€è¿›è¡Œæ¡ä»¶åˆ¤æ–­

**
```sql

 case cp.ssid when 'aa' then '0' else'1' end as flag, "+
      " case cp.ssid when 'aa' then '3001' else '0000' end  as retCode,"+
```

```sql
"SELECT cp.ssid AS ssid," +
      " cp.accname AS accname," +
      " cp.PAYSUMUNTAX AS PAYSUMUNTAX," +
      " cp.PAYTAX AS PAYTAX," +
      " cp.payaftersum AS payAmt," +
      " cp.benetype AS benetype," +
      " cp.memo AS memo," +
    " case cp.ssid when 'aa' then '0' else'1' end as flag, "+
      " case cp.ssid when 'aa' then '3001' else '0000' end  as retCode,"+
      " to_char(sysdate,'yyyyMMdd') as drawDate,"+
      " to_char(sysdate,'HH24mmss') as drawTime"+
  " FROM CSIP_OA_PAYLISTINFO CPI" +
 " JOIN CSIP_OA_TASKFILE CT" +
   " ON CPI.PK_PAYLISTINFO = CT.PK_PAYLISTINFO" +
 " JOIN CSIP_OA_PAYLIST CP" +
   " ON CP.PK_TASKFILE = CT.PK_TASKFILE" +
" WHERE CPI.INNER_LISTNO = '"+inworkflowno+"'" ;
```




## 28ã€#å’Œ$é¡¹ç›®ä¸­ä½¿ç”¨çš„åŒºåˆ«


### 28.1ã€#{å˜é‡å}å¯ä»¥è¿›è¡Œé¢„ç¼–è¯‘ã€ç±»å‹åŒ¹é…ç­‰æ“ä½œï¼Œ#{å˜é‡å}ä¼šè½¬åŒ–ä¸ºjdbcçš„ç±»å‹,${å˜é‡å}ä¸è¿›è¡Œæ•°æ®ç±»å‹åŒ¹é…ï¼Œç›´æ¥æ›¿æ¢ã€‚

```sql
select * from tablename where id = #{id}


å‡è®¾idçš„å€¼ä¸º12ï¼Œå…¶ä¸­å¦‚æœæ•°æ®åº“å­—æ®µidä¸ºå­—ç¬¦å‹ï¼Œé‚£ä¹ˆ#{id}è¡¨ç¤ºçš„å°±æ˜¯'12'ï¼Œå¦‚æœidä¸ºæ•´å‹ï¼Œé‚£ä¹ˆidå°±æ˜¯12ï¼Œå¹¶ä¸”MyBatisä¼šå°†ä¸Šé¢SQLè¯­å¥è½¬åŒ–ä¸ºjdbcçš„select * from tablename where id=?ï¼ŒæŠŠ?å‚æ•°è®¾ç½®ä¸ºidçš„å€¼ã€‚



select * from tablename where id = ${id}
å¦‚æœå­—æ®µidä¸ºæ•´å‹ï¼Œsqlè¯­å¥å°±ä¸ä¼šå‡ºé”™ï¼Œä½†æ˜¯å¦‚æœå­—æ®µidä¸ºå­—ç¬¦å‹ï¼Œ é‚£ä¹ˆsqlè¯­å¥åº”è¯¥å†™æˆselect * from table where id = '${id}'ã€‚

```


### 28.2ã€æ–¹å¼èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦é˜²æ­¢sqlæ³¨å…¥ã€‚å› ä¸º#ä¼šè‡ªåŠ¨è½¬æ¢ï¼Œè€Œ&ä¸ºç›´æ¥æ›¿æ¢,æ‰€ä»¥$æ–¹å¼æ— æ³•é˜²æ­¢sqlæ³¨å…¥ã€‚

### 28.3ã€é¡¹ç›®ä¸­çš„ä½¿ç”¨ï¼Œå°½é‡ä½¿ç”¨# ï¼Œå°‘ç”¨& è‡­å°å­ï¼Œæ˜ç™½äº†å§

`#`é€‚ç”¨äºæ™®é€šçš„å‚æ•°ä¼ å…¥

`$`æ–¹å¼ä¸€èˆ¬ç”¨äºä¼ å…¥æ•°æ®åº“å¯¹è±¡ï¼Œä¾‹å¦‚ä¼ å…¥è¡¨åã€‚



```
orderä¸º A ASC, A DESC ,B DESC ï¼ŒB ascæ•°æ®ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨#æ˜¯é”™è¯¯çš„

 <when  test="order != null">
                     order by  ${order}
  </when>
```


## 29ã€mysqlé™¤æ³•

ä½™æ•°å¯ä»¥ä¸º0ï¼Œå¾—åˆ°çš„ç»“æœä¸ºNUll

```java
SELECT 1/0 from dual ;
```

![WX20181212-160341](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/WX20181212-160341.png)


## 30ã€mysql å–å°æ•° convert   round  cast



```sql
1ã€convertï¼ˆå››èˆäº”å…¥ï¼‰

select convert(10000,decimal(10,2));

# å››èˆäº”å…¥ï¼Œdecimal(10,2)åé¢çš„ä»£è¡¨æœ€å¤§é•¿åº¦10ä»¥åŠä¿ç•™çš„å°æ•°ä½æ•°2
select convert(10569.3645,decimal(10,2));    #10569.36
select convert(10569.3665555,decimal(10,2)); #10569.37


2ã€roundï¼ˆè‡ªåŠ¨å››èˆäº”å…¥ï¼‰
# round ç¬¬äºŒä¸ªè¡¨ç¤ºä¿ç•™å‡ ä½ï¼Œå¦‚æœä¹‹å‰æœ‰å°æ•°ï¼Œé‚£ä¹ˆä¸è¶³çš„è¡¥ä¸Š0ã€‚è‚¯å®šæ˜¯å¤Ÿçš„ã€‚
#        ç¬¬äºŒä¸ªå¦‚æœä¸ºè´Ÿæ•° -1 ä»£è¡¨ä¸ªä½æ•°ä¸º0             ROUND(114.6,-1) ç»“æœ 110ï¼Œ
#                      -2 ä»£è¡¨ä¸ªä½æ•°å’Œååˆ†ä½ ä¸º0 ä¾‹å¦‚ ROUND(114.6,-2) ç»“æœ  100
# 100.35  100 0.60  110
SELECT ROUND(100.3465,2),ROUND(100,2),ROUND(0.6,2),ROUND(114.6,-1) ;


3ã€castï¼Œå¼ºåˆ¶è½¬æ¢
select cast(10*1/4 as decimal(18,2)) from dual


```


## 31ã€å­æŸ¥è¯¢

### 31.1ã€å­æŸ¥è¯¢ä¸­çš„å˜é‡æ˜¯ä¸å¯ä»¥æ˜¯å“¦ç”¨å¤–é¢çš„å˜é‡çš„ 

#### æ¯”å¦‚ä¸‹é¢çš„ #{userInfoId} æ˜¯ä¸å¯ä»¥ä½¿ç”¨uçš„ã€‚åªèƒ½æ˜¯ä½¿ç”¨å·²çŸ¥çš„å‚æ•°


```sql
 select
               o.payAmount,
               o.estimateAmount,
               (o3.notValidOrderSize +o.orderSize) as orderSize
        from user_info u
                       left join  (select    IFNULL(count(o1.orderNo),0 )  as orderSize ,
                                             IFNULL(sum(o1.estimateAmount) ,0)  as  estimateAmount ,
                                             IFNULL(sum(o1.payAmount) ,0) as payAmount,
                                             o1.userInfoId as userInfoId
                                     from    user_order o1
                                     where   o1.userInfoId = #{userInfoId} and
                                             o1.orderStatus !='è®¢å•å¤±æ•ˆ'
                                  )
               o on o.userInfoId = u.id
                       left join   (select IFNULL(count(o2.orderNo),0 ) as notValidOrderSize,
                                             o2.userInfoId as userInfoId
                                      from   user_order o2
                                      where o2.orderStatus ='è®¢å•å¤±æ•ˆ'  and o2.userInfoId = #{userInfoId}
                                   )
              o3 on o3.userInfoId = u.id
        where u.id = #{userInfoId};
 u.id = 
```

### 31.2ã€å†…éƒ¨æŸ¥è¯¢æ˜¯å¯ä»¥ä½¿ç”¨å¤–é¢çš„,ä¸‹é¢æ˜¯æ›´æ–°ï¼Œå†…éƒ¨æŸ¥è¯¢æ˜¯ä¸å¯ä»¥ä½¿ç”¨è¢«æ›´æ–°å¯¹è±¡è¿›è¡Œç­›é€‰çš„



```sql
update  user_access_erweima_ip_info u set u.dingId = (
   select c.dingId from  coupon_adzone  c where c.id = u.couponAdzoneId
 ) where  u.dingId is null ;
 
```



## 32ã€sqlæŸ¥è¯¢ç»“æœåŠ æ³•

å°½é‡æ¯ä¸ªå‚æ•°éƒ½å¸¦ä¸ŠifNULLï¼Œé˜²æ­¢null+sizeé€ æˆçš„æ•°æ®æ—¶nullï¼Œä¸æ˜¾ç¤º

```sql



  select  o.payAmount,
          o.estimateAmount,
         (o3.notValidOrderSize +o.orderSize) as orderSize
        from user_info u
        

(IFNULL(o3.notValidOrderSize ,0 ) + IFNULL(o.orderSize ,0 ) ) as orderSize
(o3.notValidOrderSize +o.orderSize) as orderSize
        
```


## 33ã€Group by æŸä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—æ®µæŸ¥æ‰¾é‡å¤æ•°æ®çš„sqlè¯­å¥

5.7mysqlä¸­å¯èƒ½ä¼šé‡åˆ°å–å”¯ä¸€å€¼çš„é—®é¢˜ã€‚ä¸€å®šè¦æ³¨æ„


### 33.1ã€è¡¨ä¸­æœ‰idå’Œname ä¸¤ä¸ªå­—æ®µï¼ŒæŸ¥è¯¢å‡ºnameé‡å¤çš„æ‰€æœ‰æ•°æ®


```sql

group by username   having count(*) > 1
                             

select * 
from healerjean a 
where (a.username) in (
                    select username 
                    from healerjean 
                    group by username 
                             having count(*) > 1
                    )

```

### 33.2ã€åˆ é™¤åˆ†ç»„ä¸­é‡è¯»çš„æ•°æ®ï¼Œåªä¿ç•™idæœ€å°çš„è®°å½•


```sql

delete from healerjean 
where username in (
                    select username 
                    from healerjean 
                    group by username 
                    having count(username) > 1
                    )
      and id not in (
                    select min(id)   #æ¯ç»„ä¸­æœ€å°çš„æ•°æ®
                    from healerjean 
                    group by username 
                    having count(username)>1)


```

### 33.3ã€æŸ¥æ‰¾è¡¨ä¸­å¤šä½™çš„é‡å¤è®°å½•ï¼ˆå¤šä¸ªå­—æ®µï¼‰


```sql

ä¸‹é¢è¿™ä¸ªå°±ä¿è¯äº†ï¼Œè‚¯å®šæ˜¯äºŒè€…åŒæ—¶å­˜åœ¨æ‰ä¼šå‡ºç°count(*)>1 
å¦‚æœæ²¡æœ‰havingåˆ™ï¼Œä¼šå‡ºç°å…ˆæ ¹æ®peopleIdåˆ†ç»„ï¼Œç„¶åç»„å†…ï¼Œå†æ ¹æ®seq åˆ†ç»„ã€‚

group by peopleId,seq having count(*) > 1
                            
select * 
from vitae a
where (a.peopleId,a.seq) in (
                            select peopleId,    
                                   seq      
                            from vitae 
                            group by peopleId,seq 
                            having count(*) > 1)


```

### 33.4ã€é€‰æ‹©è¡¨ä¸­å¤šä½™çš„é‡å¤è®°å½•ï¼ˆå¤šä¸ªå­—æ®µï¼‰ï¼Œåªç•™æœ‰idæœ€å°çš„è®°å½•


```sql


select * 
from vitae a
where (a.peopleId,a.seq) in (
                            select peopleId,    
                                   seq      
                            from vitae 
                            group by peopleId,seq 
                            having count(*) > 1)
and id not in           ( select min(id)   
                            from vitae 
                            group by peopleId,seq 
                            having count(*) > 1)
 
```



## 34ã€ABSå–ç»å¯¹å€¼

æœ‰æ—¶å€™é¡¹ç›®ä¸­å‡ºç°ä¸¤ä¸ªæ•°å­—ç›¸å‡ï¼Œå¯èƒ½æ˜¯è´Ÿæ•°ï¼Œä½†æ˜¯åªæ˜¯éœ€è¦è¿™è¿ä¸ªæ•°çš„å·®å€¼ï¼Œæ‰€ä»¥å°±éœ€è¦ç”¨å®ƒ


```sql

(ABS( TIMESTAMPDIFF(MINUTE,i.cdate,#{createTime}) ))< #{adzoneTime}****

```


## 35ã€MySqlåˆ¤æ–­æ˜¯å¦ä¸ºnullæˆ–ç©ºå­—ç¬¦ä¸²


```sql

# ISNULL(aBegBalRule) || LENGTH(trim(aBegBalRule))<1

```


## 36ã€æ¸…è¡¨ï¼ˆä¸è¦ç”¨deleteï¼‰

deleteåˆ é™¤ä¹‹åè¿˜ä¼šå ç”¨idï¼Œ

```java
truncate  income_detail ;

```

## 37ã€CONCATã€æ‹¼æ¥å­—ç¬¦ä¸²

### 37.1ã€æ¨¡ç³ŠæŸ¥è¯¢ä½¿ç”¨`concat('%',#{params},'%'))`

```xml

  <if test="params != null and params != ''">
                    and (
                    (u.nickName like  concat('%',#{params},'%')) or
                    (u.id = #{params})
                    )
 </if>
                
```

### 37.2ã€æ‹¼æ¥

```sql

 SELECT CONCAT(â€™Myâ€™, NULL, â€˜QLâ€™);
 
 MySQL
 
#å¦‚æœæœ‰ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œåˆ™è¿”å›ç»“æœä¸ºnull
SELECT CONCAT(â€™Myâ€™, NULL, â€˜QLâ€™);

NULL
 
```

### 37.3ã€CONCAT_WS ï¼Œåˆ†éš”ç¬¦è¿æ¥å­—ç¬¦ä¸²

    ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…¶å®ƒå‚æ•°çš„åˆ†éš”ç¬¦ã€‚åˆ†éš”ç¬¦çš„ä½ç½®æ”¾åœ¨è¦è¿æ¥çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´ã€‚åˆ†éš”ç¬¦å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒå‚æ•°ã€‚å¦‚æœåˆ†éš”ç¬¦ä¸º NULLï¼Œåˆ™ç»“æœä¸º NULLã€‚å‡½æ•°ä¼šå¿½ç•¥ä»»ä½•åˆ†éš”ç¬¦å‚æ•°åçš„ NULL å€¼ã€‚

```sql

SELECT CONCAT_WS(',','First name','Second name','Last Name');

First name,Second name,Last Name

SELECT CONCAT_WS(',','First name','','Last Name');

First name,,Last Name (ç©ºå­—ç¬¦ä¸²ä¸ä¼šå¿½ç•¥)

SELECT CONCAT_WS(',','First name',null ,'Last Name');

First name,Last Name




```

## 38ã€locate å‡ºç°çš„ä½ç½®


```sql

SELECT LOCATE('bar', 'foobarbar'); #4

SELECT LOCATE('xbar', 'foobarbar'); #0

ä½ç½®ä»4å¼€å§‹æ•°èµ· 
SELECT LOCATE('bar', 'foobarbar',4); # 4
ä½ç½®ä»7å¼€å§‹æ•°èµ·
SELECT LOCATE('bar', 'foobarbar',5); # 7


```

é¡¹ç›®ä½¿ç”¨


```sql

æŸ¥æ‰¾å…·æœ‰httpå­—æ®µçš„ç”¨æˆ·

select * from users where locate('http',itemUrl);


åˆ¤æ–­siteè¡¨ä¸­çš„urlæ˜¯å¦åŒ…å«'http://'å­ä¸²,å¦‚æœä¸åŒ…å«åˆ™æ‹¼æ¥åœ¨urlå­—ç¬¦ä¸²å¼€å¤´

update site set url =concat('http://',url) where locate('http://',url)=0;


```

## 39ã€UNION å’Œ UNION ALL æ“ä½œç¬¦



### é»˜è®¤æƒ…å†µä¸‹ UNION æ“ä½œç¬¦å·²ç»åˆ é™¤äº†é‡å¤æ•°æ®ã€‚å¦‚æœå…è®¸é‡å¤çš„å€¼ï¼Œè¯·ä½¿ç”¨ UNION ALLã€‚

SELECT è¯­å¥å¿…é¡»æ‹¥æœ‰ç›¸åŒæ•°é‡çš„åˆ—ã€‚åˆ—ä¹Ÿå¿…é¡»æ‹¥æœ‰ç›¸ä¼¼çš„æ•°æ®ç±»å‹ã€‚åŒæ—¶ï¼Œæ¯æ¡ SELECT è¯­å¥ä¸­çš„åˆ—çš„é¡ºåºå¿…é¡»ç›¸åŒã€‚


```sql

SELECT column_name(s) FROM table_name1
UNION
SELECT column_name(s) FROM table_name2

```


## 40ã€å†…è¿æ¥ å·¦é“¾æ¥ï¼Œå³è¿æ¥ï¼Œå…¨è¿æ¥

### 40.1ã€INNER JOIN å’Œ JOIN å³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ


![15515914742853](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/15515914742853.png)

```sql
 
SELECT Persons.LastName, Persons.FirstName, Orders.OrderNo
FROM Persons
       INNER JOIN Orders ON Persons.Id_P = Orders.Id_P
ORDER BY Persons.LastName

```
![15515916356311](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/15515916356311.png)


### 40.2ã€LEFT JOIN å³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ



```sql
select Persons.LastName, Persons.FirstName, Orders.OrderNo
from Persons
       left join Orders on Persons.Id_P = Orders.Id_P
order by Persons.LastName

```
![15515917585785](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/15515917585785.png)

### 40.3ã€RIGHT JOIN: å³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å³è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ


```sql
select Persons.LastName, Persons.FirstName, Orders.OrderNo
from Persons
       right join Orders on Persons.Id_P = Orders.Id_P
order by Persons.LastName

```
![15515918393236](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/15515918393236.png)

### 40.4ã€FULL JOIN: åªè¦å…¶ä¸­ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨åŒ¹é…ï¼Œå°±è¿”å›è¡Œ


```sql

select Persons.LastName, Persons.FirstName, Orders.OrderNo
from Persons full
       join Orders on Persons.Id_P = Orders.Id_P
order by Persons.LastName

```


![15515919032202](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/15515919032202.png)


### 40.5ã€left join on åé¢åŠ  and 


```sql

create table department (
  dept_id int(11) default 0 comment 'éƒ¨é—¨id',
  dept_name varchar(20) default '' comment 'éƒ¨é—¨åç§°'
)comment ='éƒ¨é—¨' ;

insert into department values(1,'å¹¿å‘Šéƒ¨');
insert into department values(2,'åª’ä½“éƒ¨');
insert into department values(3,'ç®¡ç†éƒ¨');
select * from department ;


create table employee (
  emp_id int(11) default 0 comment 'å‘˜å·¥id',
  emp_name varchar(20) default '' comment 'å‘˜å·¥åå­—',
  dept_id int(11) default 0 comment 'éƒ¨é—¨id',
  emp_wage decimal(19,2) default 0 comment 'è–ªæ°´'
)comment ='å‘˜å·¥è¡¨' ;


insert into employee values(1,'å¼ å®‡æ™‹',1,17000);
insert into employee values(2,'å¼ ä¸‰ä¸°',1,15000);
insert into employee values(3,'å¼ ç¿ ',2,18000);
insert into employee values(4,'æ—å¾½å› ',2,12000);
insert into employee values(5,'èµµå›½å¼º',3,17000);


```

<table>
<tr><th>dept_id</th><th>dept_name</th></tr>
<tr><td>1</td><td>å¹¿å‘Šéƒ¨</td></tr>
<tr><td>2</td><td>åª’ä½“éƒ¨</td></tr>
<tr><td>3</td><td>ç®¡ç†éƒ¨</td></tr></table>

<table>
<tr><th>emp_id</th><th>emp_name</th><th>dept_id</th><th>emp_wage</th></tr>
<tr><td>1</td><td>å¼ å®‡æ™‹</td><td>1</td><td>17000.00</td></tr>
<tr><td>2</td><td>å¼ ä¸‰ä¸°</td><td>1</td><td>15000.00</td></tr>
<tr><td>3</td><td>å¼ ç¿ </td><td>2</td><td>18000.00</td></tr>
<tr><td>4</td><td>æ—å¾½å› </td><td>2</td><td>12000.00</td></tr>
<tr><td>5</td><td>èµµå›½å¼º</td><td>3</td><td>17000.00</td></tr></table>




#### 1ã€left join

```sql
select d.dept_id, d.dept_name, e.emp_name, e.emp_wage
from department d
       left join employee e on e.dept_id = d.dept_id 
```

<table>
<tr><th>dept_id</th><th>dept_name</th><th>emp_name</th><th>emp_wage</th></tr>
<tr><td>1</td><td>å¹¿å‘Šéƒ¨</td><td>å¼ å®‡æ™‹</td><td>17000.00</td></tr>
<tr><td>1</td><td>å¹¿å‘Šéƒ¨</td><td>å¼ ä¸‰ä¸°</td><td>15000.00</td></tr>
<tr><td>2</td><td>åª’ä½“éƒ¨</td><td>å¼ ç¿ </td><td>18000.00</td></tr>
<tr><td>2</td><td>åª’ä½“éƒ¨</td><td>æ—å¾½å› </td><td>12000.00</td></tr>
<tr><td>3</td><td>ç®¡ç†éƒ¨</td><td>èµµå›½å¼º</td><td>17000.00</td></tr></table>

#### 2ã€left join on   and è‡ªä¸ªè¡¨and
 

```sql
select d.dept_id, d.dept_name, e.emp_name, e.emp_wage
from department d
       left join employee e on e.dept_id = d.dept_id and e.emp_wage = 17000
```

<table>
<tr><th>dept_id</th><th>dept_name</th><th>emp_name</th><th>emp_wage</th></tr>
<tr><td>1</td><td>å¹¿å‘Šéƒ¨</td><td>å¼ å®‡æ™‹</td><td>17000.00</td></tr>
<tr><td>3</td><td>ç®¡ç†éƒ¨</td><td>èµµå›½å¼º</td><td>17000.00</td></tr>
<tr><td>2</td><td>åª’ä½“éƒ¨</td><td>NULL</td><td>NULL</td></tr></table>

 

```sql
select d.dept_id, d.dept_name, e.emp_name, e.emp_wage
from department d
       left join employee e on e.dept_id = d.dept_id and d.dept_id = 1
       
```
#### 3ã€left join on   and ç¬¬ä¸€å¼ è¡¨ and

<table>
<tr><th>dept_id</th><th>dept_name</th><th>emp_name</th><th>emp_wage</th></tr>
<tr><td>1</td><td>å¹¿å‘Šéƒ¨</td><td>å¼ å®‡æ™‹</td><td>17000.00</td></tr>
<tr><td>1</td><td>å¹¿å‘Šéƒ¨</td><td>å¼ ä¸‰ä¸°</td><td>15000.00</td></tr>
<tr><td>2</td><td>åª’ä½“éƒ¨</td><td>NULL</td><td>NULL</td></tr>
<tr><td>3</td><td>ç®¡ç†éƒ¨</td><td>NULL</td><td>NULL</td></tr></table>



#### 4ã€whereåé¢è¿‡æ»¤æœ€åçš„è°ƒèŠ‚


```sql

select d.dept_id, d.dept_name, e.emp_name, e.emp_wage
from department d
       left join employee e on e.dept_id = d.dept_id and d.dept_id = 1
where e.emp_wage = 17000;

```

<table>
<tr><th>dept_id</th><th>dept_name</th><th>emp_name</th><th>emp_wage</th></tr>
<tr><td>1</td><td>å¹¿å‘Šéƒ¨</td><td>å¼ å®‡æ™‹</td><td>17000.00</td></tr></table>



#### é«˜çº§sqlã€æ¯ä¸ªéƒ¨é—¨ä¸­æœ€å¤§å·¥èµ„å’Œæœ€å°å·¥èµ„ï¼Œæœ€å¤§å·¥èµ„å¤§äº17000 æœ€å°å·¥èµ„å°äº16000


```sql



select d.dept_id, d.dept_name, l.MaxWage, s.MinWage
from department d
       left join (select a.dept_id, a.emp_wage as MaxWage
                  from employee a
                  where a.emp_wage > 17000
                  group by a.dept_id
                  having a.emp_wage = max(a.emp_wage))l on l.dept_id = d.dept_id
       left join (select m.dept_id, m.emp_wage as MinWage
                  from employee m
                  where m.emp_wage < 16000
                  group by m.dept_id
                  having m.emp_wage = min(m.emp_wage))s on s.dept_id = d.dept_id;


ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨ä¸­æœ€å¤§çš„å·¥èµ„ï¼Œå¹¶ä¸”è¦æ±‚å¤§äº 17000
select a.dept_id, a.emp_wage as MaxWage
                  from employee a
                  where a.emp_wage > 17000
                  group by a.dept_id
                  having a.emp_wage = max(a.emp_wage)  
               
ç¬¬äºŒéƒ¨ ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨ä¸­æŠ¥æœ€å°å·¥èµ„ è¦æ±‚å°äº16000
select m.dept_id, m.emp_wage as MinWage
                  from employee m
                  where m.emp_wage < 16000
                  group by m.dept_id
                  having m.emp_wage = min(m.emp_wage)
                  
ç¬¬ä¸‰éƒ¨ï¼Œå¼€å§‹è¿æ¥æŸ¥è¯¢

select d.dept_id, d.dept_name, l.MaxWage, s.MinWage
from department d
       left join (select a.dept_id, a.emp_wage as MaxWage
                  from employee a
                  where a.emp_wage > 17000
                  group by a.dept_id
                  having a.emp_wage = max(a.emp_wage))l on l.dept_id = d.dept_id
       left join (select m.dept_id, m.emp_wage as MinWage
                  from employee m
                  where m.emp_wage < 16000
                  group by m.dept_id
                  having m.emp_wage = min(m.emp_wage))s on s.dept_id = d.dept_id;                  

```

## 41ã€havaing countç”¨æ³•


```sql

create table tb_grade (
  Sno int(11) default 0 comment 'å­¦å·',
  Sname varchar(20) default '' comment 'å§“å',
  Cno int(11) default  0  comment 'å­¦å·',
  Cname varchar(20) default ''comment 'è¯¾ç¨‹å',
  score int(11) default 0 comment 'åˆ†æ•°'
) comment 'æˆç»©è¡¨' ;

INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, 'æè²', 1, 'è¯­æ–‡', 86);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, 'æè²', 2, 'æ•°å­¦', 50);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, 'æè²', 3, 'è‹±è¯­', 41);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, 'æè²', 4, 'åŒ–å­¦', 89);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, 'æè²', 5, 'ç‰©ç†', 20);

INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, 'å¼ å®‡æ™‹', 1, 'è¯­æ–‡', 86);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, 'å¼ å®‡æ™‹', 2, 'æ•°å­¦', 50);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, 'å¼ å®‡æ™‹', 3, 'è‹±è¯­', 70);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, 'å¼ å®‡æ™‹', 4, 'åŒ–å­¦', 89);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, 'å¼ å®‡æ™‹', 5, 'ç‰©ç†', 20);


INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, 'ç¿ èŠ±', 1, 'è¯­æ–‡', 10);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, 'ç¿ èŠ±', 2, 'æ•°å­¦', 20);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, 'ç¿ èŠ±', 3, 'è‹±è¯­', 70);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, 'ç¿ èŠ±', 4, 'åŒ–å­¦', 40);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, 'ç¿ èŠ±', 5, 'ç‰©ç†', 10);

```

<table >
<tr><th>Sno</th><th>Sname</th><th>Cno</th><th>Cname</th><th>score</th></tr>
<tr><td>1001</td><td>æè²</td><td>1</td><td>è¯­æ–‡</td><td>86</td></tr>
<tr><td>1001</td><td>æè²</td><td>2</td><td>æ•°å­¦</td><td>50</td></tr>
<tr><td>1001</td><td>æè²</td><td>3</td><td>è‹±è¯­</td><td>41</td></tr>
<tr><td>1001</td><td>æè²</td><td>4</td><td>åŒ–å­¦</td><td>89</td></tr>
<tr><td>1001</td><td>æè²</td><td>5</td><td>ç‰©ç†</td><td>20</td></tr>
<tr><td>1002</td><td>å¼ å®‡æ™‹</td><td>1</td><td>è¯­æ–‡</td><td>86</td></tr>
<tr><td>1002</td><td>å¼ å®‡æ™‹</td><td>2</td><td>æ•°å­¦</td><td>50</td></tr>
<tr><td>1002</td><td>å¼ å®‡æ™‹</td><td>3</td><td>è‹±è¯­</td><td>70</td></tr>
<tr><td>1002</td><td>å¼ å®‡æ™‹</td><td>4</td><td>åŒ–å­¦</td><td>89</td></tr>
<tr><td>1002</td><td>å¼ å®‡æ™‹</td><td>5</td><td>ç‰©ç†</td><td>20</td></tr>
<tr><td>1003</td><td>ç¿ èŠ±</td><td>1</td><td>è¯­æ–‡</td><td>10</td></tr>
<tr><td>1003</td><td>ç¿ èŠ±</td><td>2</td><td>æ•°å­¦</td><td>20</td></tr>
<tr><td>1003</td><td>ç¿ èŠ±</td><td>3</td><td>è‹±è¯­</td><td>70</td></tr>
<tr><td>1003</td><td>ç¿ èŠ±</td><td>4</td><td>åŒ–å­¦</td><td>40</td></tr>
<tr><td>1003</td><td>ç¿ èŠ±</td><td>5</td><td>ç‰©ç†</td><td>10</td></tr></table>



#### 1ã€æŸ¥è¯¢ä¸åŠæ ¼ç§‘ç›®æ•°å¤§äºç­‰äº2çš„å­¦ç”Ÿå­¦å·å’Œå­¦ç”Ÿå§“åï¼š


```sql
select t.Sno,t.Sname 
       from tb_grade t 
where t.score < 60 
group by t.Sno having count(t.Cno) > 2

```
<table >
<tr><th>Sno</th><th>Sname</th></tr>
<tr><td>1001</td><td>æè²</td></tr>
<tr><td>1003</td><td>ç¿ èŠ±</td></tr></table>

#### 2ã€æŸ¥è¯¢ä¸åŠæ ¼ç§‘ç›®æ•°å¤§äºç­‰äº2çš„å­¦ç”Ÿå­¦å·å’Œä¸åŠæ ¼ç§‘ç›®æ•°é‡ï¼š


```sql

whereæ¡ä»¶ä¸­å·²ç»ç­›é€‰å‡ºæ¥äº†ä¸åŠæ ¼çš„äººï¼Œåé¢haveingä¸­å¼€å§‹åˆ¤æ–­ä¸‹ä¸åŠæ ¼ç§‘ç›®æ•°é‡å¤§äº2çš„äººã€‚

ä¸åŠæ ¼ç§‘ç›®æ•°é‡ ï¼Œå…¶å®å·²ç»å¸®æˆ‘ç­›é€‰å‡ºæ¥äº†ï¼Œåªè¦ç­¾åæ·»åŠ å°±å¯ä»¥äº†

select t.Sno,
     count(t.Cno) as 'ä¸åŠæ ¼ç§‘ç›®æ•°é‡' 
from tb_grade t 
where t.score < 60 
group by t.Sno having count(t.Cno) > 2 
```

<table  style="border-collapse:collapse">
<tr><th>Sno</th><th>ä¸åŠæ ¼ç§‘ç›®æ•°é‡</th></tr>
<tr><td>1001</td><td>3</td></tr>
<tr><td>1003</td><td>4</td></tr></table>

#### 3ã€æŸ¥è¯¢ä¸åŠæ ¼ç§‘ç›®æ•°å¤§äºç­‰äº2çš„å­¦ç”Ÿå­¦å·ã€å­¦ç”Ÿå§“åã€ç§‘ç›®å·ã€ç§‘ç›®åç§°å’Œåˆ†æ•°ï¼Œå¹¶æŒ‰å­¦å·é™åºã€ç§‘ç›®å·å‡åºæ’åº



```sql

select t.Sno, t.Sname, t.Cno, t.Cname, t.score
from tb_grade t
where t.score < 60
  and t.Sno in (select b.Sno from tb_grade b where b.score < 60 group by b.Sno having count(b.Cno) > 2)
order by t.Sno desc, Cno asc;


ç¬¬ä¸€æ­¥ï¼ŒæŸ¥è¯¢å­¦ç”Ÿå§“åã€ç§‘ç›®å·ã€ç§‘ç›®åç§°å’Œåˆ†æ•°ï¼Œå¹¶æŒ‰å­¦å·é™åºã€ç§‘ç›®å·å‡åºæ’åº

select t.Sno, t.Sname, t.Cno, t.Cname, t.score
from tb_grade t
order by t.Sno desc, Cno asc;

ç¬¬äºŒéƒ¨ï¼Œæ³¨æ„æ˜¯ä¸åŠæ ¼ï¼Œæ·»åŠ whereç­›é€‰
select t.Sno, t.Sname, t.Cno, t.Cname, t.score
from tb_grade t
where t.score < 60
order by t.Sno desc, Cno asc;

ç¬¬ä¸‰éƒ¨ï¼Œé€‰å‡ºï¼Œä¸åŠæ ¼ç§‘ç›®æ•°é‡å¤§äº2çš„åŒå­¦ï¼Œå°†2ä¸­çš„ç­›é€‰æ·»åŠ æ”¾è¿›æ¥å§

select t.Sno, t.Sname, t.Cno, t.Cname, t.score
from tb_grade t
where t.score < 60
  and t.Sno in (select b.Sno from tb_grade b where b.score < 60 group by b.Sno having count(b.Cno) > 2)
order by t.Sno desc, Cno asc;

```

#### 4ã€åˆ†ç»„havingä¸­æ·»åŠ and


```sql
select t.Sno,t.Sname
from tb_grade t
where t.score < 60
group by t.Sno having count(t.Cno) > 1 and Sname = 'æè²';

```

<table>
<tr><th>Sno</th><th>Sname</th></tr>
<tr><td>1001</td><td>æè²</td></tr></table>



<br/><br/>
<font color="red"> æ„Ÿå…´è¶£çš„ï¼Œæ¬¢è¿æ·»åŠ åšä¸»å¾®ä¿¡ï¼Œ </font><br/>
å“ˆï¼Œåšä¸»å¾ˆä¹æ„å’Œå„è·¯å¥½å‹äº¤æµï¼Œå¦‚æœæ»¡æ„ï¼Œè¯·æ‰“èµåšä¸»ä»»æ„é‡‘é¢ï¼Œæ„Ÿå…´è¶£çš„åœ¨å¾®ä¿¡è½¬è´¦çš„æ—¶å€™ï¼Œå¤‡æ³¨æ‚¨çš„å¾®ä¿¡æˆ–è€…å…¶ä»–è”ç³»æ–¹å¼ã€‚æ·»åŠ åšä¸»å¾®ä¿¡å“¦ã€‚
<br/>
è¯·ä¸‹æ–¹ç•™è¨€å§ã€‚å¯ä¸åšä¸»è‡ªç”±è®¨è®ºå“¦

|æ”¯ä»˜åŒ… | å¾®ä¿¡|å¾®ä¿¡å…¬ä¼—å·|
|:-------:|:-------:|:------:|
|![æ”¯ä»˜å®](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/alpay.jpg) | ![å¾®ä¿¡](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/weixin.jpg)|![å¾®ä¿¡å…¬ä¼—å·](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/my/qrcode_for_gh_a23c07a2da9e_258.jpg)|




<!-- Gitalk è¯„è®º start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>Â 
<div id="gitalk-container"></div>Â    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'yGteDRHAXmN7alJz',
    });
    gitalk.render('gitalk-container');
</script>Â 

<!-- Gitalk end -->

