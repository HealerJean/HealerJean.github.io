---
title: 个人sql代码规范书写_仅供参考
date: 2018-12-14 03:33:00
tags: 
- Database
category: 
- Database
description: 个人sql代码规范书写_仅供参考
---
<!-- image url 
https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages
　　首行缩进
<font color="red">  </font>

<font  color="red" size="4">   </font>


<font size="4">   </font>
-->

## 前言


### 1、left join

on 后面的写前面的字段，这样个人认为比较好区分
__

#### 1、没有子查询的时候

```sql

select o.createTime,
       o.clickTime,
       c.itemTitle,
       o.itemId,
       o.orderNo,
       c.shopTitle,
       o.estimateAmount,
       o.payAmount,
       c.commissionRatio,
       o.orderStatus
from user_order o left  join
     coupon_taoke_data c on c.id = o.taokeId
where 1=1





```

#### 2、有子查询



```sql


 select  o.payAmount,
          o.estimateAmount,
       ( IFNULL(o3.notValidOrderSize ,0 ) + IFNULL(o.orderSize ,0 ) ) as orderSize
from user_info u
                  left join  (select    IFNULL(count(o1.orderNo),0 )  as orderSize ,
                                        IFNULL(sum(o1.estimateAmount) ,0)  as  estimateAmount ,
                                        IFNULL(sum(o1.payAmount) ,0) as payAmount,
                                        o1.userInfoId as userInfoId
                                from    user_order o1
                                where   o1.userInfoId = 4 and o1.orderStatus !='订单失效'
                             )
          o on o.userInfoId = u.id
                  left join   (select IFNULL(count(o2.orderNo),0 ) as notValidOrderSize,
                                        o2.userInfoId as userInfoId
                                 from   user_order o2
                                 where o2.orderStatus ='订单失效'  and o2.userInfoId = 4
                              )
         o3 on o3.userInfoId = u.id
where u.id = 4;
   
        

```


## 经典sql

## 1、havaing count用法

<table >
<tr><th>Sno</th><th>Sname</th><th>Cno</th><th>Cname</th><th>score</th></tr>
<tr><td>1001</td><td>李菲</td><td>1</td><td>语文</td><td>86</td></tr>
<tr><td>1001</td><td>李菲</td><td>2</td><td>数学</td><td>50</td></tr>
<tr><td>1001</td><td>李菲</td><td>3</td><td>英语</td><td>41</td></tr>
<tr><td>1001</td><td>李菲</td><td>4</td><td>化学</td><td>89</td></tr>
<tr><td>1001</td><td>李菲</td><td>5</td><td>物理</td><td>20</td></tr>
<tr><td>1002</td><td>张宇晋</td><td>1</td><td>语文</td><td>86</td></tr>
<tr><td>1002</td><td>张宇晋</td><td>2</td><td>数学</td><td>50</td></tr>
<tr><td>1002</td><td>张宇晋</td><td>3</td><td>英语</td><td>70</td></tr>
<tr><td>1002</td><td>张宇晋</td><td>4</td><td>化学</td><td>89</td></tr>
<tr><td>1002</td><td>张宇晋</td><td>5</td><td>物理</td><td>20</td></tr>
<tr><td>1003</td><td>翠花</td><td>1</td><td>语文</td><td>10</td></tr>
<tr><td>1003</td><td>翠花</td><td>2</td><td>数学</td><td>20</td></tr>
<tr><td>1003</td><td>翠花</td><td>3</td><td>英语</td><td>70</td></tr>
<tr><td>1003</td><td>翠花</td><td>4</td><td>化学</td><td>40</td></tr>
<tr><td>1003</td><td>翠花</td><td>5</td><td>物理</td><td>10</td></tr></table>


```sql

drop table tb_grade ;
create table tb_grade (
  Sno int(11) default 0 comment '学号',
  Sname varchar(20) default '' comment '姓名',
  Cno int(11) default  0  comment '学号',
  Cname varchar(20) default ''comment '课程名',
  score int(11) default 0 comment '分数'
) comment '成绩表' ;

INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, '李菲', 1, '语文', 86);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, '李菲', 2, '数学', 50);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, '李菲', 3, '英语', 41);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, '李菲', 4, '化学', 89);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1001, '李菲', 5, '物理', 20);

INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, '张宇晋', 1, '语文', 86);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, '张宇晋', 2, '数学', 50);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, '张宇晋', 3, '英语', 70);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, '张宇晋', 4, '化学', 89);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1002, '张宇晋', 5, '物理', 20);


INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, '翠花', 1, '语文', 10);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, '翠花', 2, '数学', 20);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, '翠花', 3, '英语', 70);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, '翠花', 4, '化学', 40);
INSERT INTO tb_grade (Sno, Sname, Cno, Cname, score) VALUES (1003, '翠花', 5, '物理', 10);

```




#### 1、查询不及格科目数大于等于2的学生学号和学生姓名：


```sql
select t.Sno,t.Sname 
       from tb_grade t 
where t.score < 60 
group by t.Sno having count(t.Cno) > 2

```
<table >
<tr><th>Sno</th><th>Sname</th></tr>
<tr><td>1001</td><td>李菲</td></tr>
<tr><td>1003</td><td>翠花</td></tr></table>

#### 2、查询不及格科目数大于等于2的学生学号和不及格科目数量：


```sql

where条件中已经筛选出来了不及格的人，后面haveing中开始判断下不及格科目数量大于2的人。

不及格科目数量 ，其实已经帮我筛选出来了，只要签名添加就可以了

select t.Sno,
     count(t.Cno) as '不及格科目数量' 
from tb_grade t 
where t.score < 60 
group by t.Sno having count(t.Cno) > 2 
```

<table  style="border-collapse:collapse">
<tr><th>Sno</th><th>不及格科目数量</th></tr>
<tr><td>1001</td><td>3</td></tr>
<tr><td>1003</td><td>4</td></tr></table>

#### 3、查询不及格科目数大于等于2的学生学号、学生姓名、科目号、科目名称和分数，并按学号降序、科目号升序排序



```sql

select t.Sno, t.Sname, t.Cno, t.Cname, t.score
from tb_grade t
where t.score < 60
  and t.Sno in (select b.Sno from tb_grade b where b.score < 60 group by b.Sno having count(b.Cno) > 2)
order by t.Sno desc, Cno asc;


第一步，查询学生姓名、科目号、科目名称和分数，并按学号降序、科目号升序排序

select t.Sno, t.Sname, t.Cno, t.Cname, t.score
from tb_grade t
order by t.Sno desc, Cno asc;

第二部，注意是不及格，添加where筛选
select t.Sno, t.Sname, t.Cno, t.Cname, t.score
from tb_grade t
where t.score < 60
order by t.Sno desc, Cno asc;

第三部，选出，不及格科目数量大于2的同学，将2中的筛选添加放进来吧

select t.Sno, t.Sname, t.Cno, t.Cname, t.score
from tb_grade t
where t.score < 60
  and t.Sno in (select b.Sno from tb_grade b where b.score < 60 group by b.Sno having count(b.Cno) > 2)
order by t.Sno desc, Cno asc;

```

## 2、高级join连接用法

<table>
<tr><th>dept_id</th><th>dept_name</th></tr>
<tr><td>1</td><td>广告部</td></tr>
<tr><td>2</td><td>媒体部</td></tr>
<tr><td>3</td><td>管理部</td></tr></table>

<table>
<tr><th>emp_id</th><th>emp_name</th><th>dept_id</th><th>emp_wage</th></tr>
<tr><td>1</td><td>张宇晋</td><td>1</td><td>17000.00</td></tr>
<tr><td>2</td><td>张三丰</td><td>1</td><td>15000.00</td></tr>
<tr><td>3</td><td>张翠</td><td>2</td><td>18000.00</td></tr>
<tr><td>4</td><td>林徽因</td><td>2</td><td>12000.00</td></tr>
<tr><td>5</td><td>赵国强</td><td>3</td><td>17000.00</td></tr></table>


```sql

create table department (
  dept_id int(11) default 0 comment '部门id',
  dept_name varchar(20) default '' comment '部门名称'
)comment ='部门' ;

insert into department values(1,'广告部');
insert into department values(2,'媒体部');
insert into department values(3,'管理部');
select * from department ;


create table employee (
  emp_id int(11) default 0 comment '员工id',
  emp_name varchar(20) default '' comment '员工名字',
  dept_id int(11) default 0 comment '部门id',
  emp_wage decimal(19,2) default 0 comment '薪水'
)comment ='员工表' ;


insert into employee values(1,'张宇晋',1,17000);
insert into employee values(2,'张三丰',1,15000);
insert into employee values(3,'张翠',2,18000);
insert into employee values(4,'林徽因',2,12000);
insert into employee values(5,'赵国强',3,17000);
select * from employee;

```

#### 1、每个部门中最大工资和最小工资，最大工资大于17000 最小工资小于16000


```sql



select d.dept_id, d.dept_name, l.MaxWage, s.MinWage
from department d
       left join (select a.dept_id, a.emp_wage as MaxWage
                  from employee a
                  where a.emp_wage > 17000
                  group by a.dept_id
                  having a.emp_wage = max(a.emp_wage))l on l.dept_id = d.dept_id
       left join (select m.dept_id, m.emp_wage as MinWage
                  from employee m
                  where m.emp_wage < 16000
                  group by m.dept_id
                  having m.emp_wage = min(m.emp_wage))s on s.dept_id = d.dept_id;


第一步：查询每个部门中最大的工资，并且要求大于 17000
select a.dept_id, a.emp_wage as MaxWage
                  from employee a
                  where a.emp_wage > 17000
                  group by a.dept_id
                  having a.emp_wage = max(a.emp_wage)  
               
第二部 ：查询每个部门中报最小工资 要求小于16000
select m.dept_id, m.emp_wage as MinWage
                  from employee m
                  where m.emp_wage < 16000
                  group by m.dept_id
                  having m.emp_wage = min(m.emp_wage)
                  
第三部，开始连接查询

select d.dept_id, d.dept_name, l.MaxWage, s.MinWage
from department d
       left join (select a.dept_id, a.emp_wage as MaxWage
                  from employee a
                  where a.emp_wage > 17000
                  group by a.dept_id
                  having a.emp_wage = max(a.emp_wage))l on l.dept_id = d.dept_id
       left join (select m.dept_id, m.emp_wage as MinWage
                  from employee m
                  where m.emp_wage < 16000
                  group by m.dept_id
                  having m.emp_wage = min(m.emp_wage))s on s.dept_id = d.dept_id;                  

```


<br/><br/><br/>
<font color="red"> 感兴趣的，欢迎添加博主微信， </font><br/>
哈，博主很乐意和各路好友交流，如果满意，请打赏博主任意金额，感兴趣的在微信转账的时候，备注您的微信或者其他联系方式。添加博主微信哦。
<br/>
请下方留言吧。可与博主自由讨论哦

|微信 | 微信公众号|支付宝|
|:-------:|:-------:|:------:|
| ![微信](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/weixin.jpg)|![微信公众号](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/my/qrcode_for_gh_a23c07a2da9e_258.jpg)|![支付宝](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/alpay.jpg) |




<!-- Gitalk 评论 start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'lRSA9sVGPbC0ByxF',
    });
    gitalk.render('gitalk-container');
</script> 

<!-- Gitalk end -->

