---
title: 项目开发经验总结-时刻更新
date: 2018-11-04 03:33:00
tags: 
- Experience
category: 
- Experience
description: 项目开发经验总结-时刻更新
---
<!-- image url 
https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages
　　首行缩进
<font color="red">  </font>

<font  color="red" size="4">   </font>


<font size="4">   </font>
-->


## 一、项目开发经验总结

### 1、数据库表的创建 

 1.1、数据库的表名字，统一开头使用t_tablename

 1.2、注意使用unique唯一约束，以及适当使用索引，提高质量


### 2、数据字典

每个人共用一套数据字典，不要产生分歧

### 3、代码结构

 代码的service结构按照功能模块进行划分。不要按照实体类进行划分

### 4、常用的快捷键非常重要

### 5、功能部分 

 组织全员统一规范，不可以自己随意创建名字和返回内容

### 6、设计脑图，防止后期再修改功能的时候，忘记之前的逻辑

### 7、提前预知使用的技术，进行深入学习。




## 二、开发过程

### 1、方法名字：

 2.1、因为我们要使用事物进行控制，所以我们应该在使用名字的时候有严格的规范，否则有可能会让我们查询的也是用事物进行控制。

不包含Jpa中固定的格式，下面是我自己定义的
#### 1.1、查询 


##### 查询数据库


>1、单个记录
>findBy

---

>2、多个记录
>qureyBy


##### 不查询数据库

>1、单个记录
>getBy

---

>2、多个记录
>dataBy


#### 1.2、删除

>1、更新status字段
> deleteUBy 

---

>2、直接删除库里的数据
> deleteDBy 



### 2、操作日志：

 2.1、操作日志尽可能使用切面编程，这样使我们原理纵向的结构能够被横切。

如果一些必要的时刻，那么我们也一定要手动添加工作日志，这对于错误的排查非常重要


### 3、注释

每个方法或者接口上面都要写有注释，代码先给人看，再给机器看，人都看不懂，机器懂了有什么用，如果员工离职了，代码交给机器修改吗？

### 4、if else的使用。

不要写一堆的else和if，这样对于昂长的代码不好看，多使用swatch 以及，如果不得不使用if else，那么在使用的过程中，对于一些重复的代码，要摘出来

### 5、请求参数data和返回参数data

1、数据库相关操作放到数据库实体 data目录下

date->业务名字->(rquest/response)
<br/>

![WX20190213-180253](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/WX20190213-180253.png)



如果是service中的相关操作（比如调用别人的接口，则直接在service层中创建vo目录）
将data放到resques和response包下面，然后根据业务再进行分包

vo->业务名字->(request/response)
<br/>

![WX20190213-180740](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/WX20190213-180740.png)



#### 5.1、请求data


请求参数的data为`ReqRecordData`<br/>


#### 5.2、返回单个实体


返回结果的data为`RspRecordModel`

#### 5.3、返回集合


返回结果的data为`RspRecordList`
    

 
 


## 三、经验

## 1、数据库问题

### 1、事物的控制（事物相关文章）

### 2、建表语句user_id

### 3、防止null，这样即使简历索引，也可能全部扫描，是的索引的统计信息以及运算变得更加复杂，


```java

@Entity
@Data
@Table(name="clear_balance")
@Accessors(chain = true)
@ApiModel(description = "用户收入")
public class  ClearBalance{

    @Id
    @Column(name = "user_id")
    private Long userId;

    /**
     * 未计算金额
     */
    @Column(name = "no_settle")
    private BigDecimal noSettle = BigDecimal.ZERO;

    /**
     * 可用余额
     */
    @Column(name = "balance")
    private BigDecimal balance = BigDecimal.ZERO;

    /**
     * 总余额=未计算金额 + 可用余额
     */
    @Column(name = "total_balance")
    private BigDecimal totalBalance = BigDecimal.ZERO;

    /**
     * 所有已计入余额收入
     */
    @Column(name = "income")
    private BigDecimal income = BigDecimal.ZERO;

    /**
     * 所有收入
     */
    @Column(name = "total_income")
    private BigDecimal totalIncome = BigDecimal.ZERO;

    private Date cdate = new Date();

    private Date udate = new Date();
}

```



### 4、更新操作

对于少量字段的修改，我们尽量使用update sql关键信息更新更新操作，因为如果使用repository直接全部查出来，有可能会造成覆盖别人修改的

## 2、项目问题

### 1、定时器的使用（定时器相关文章）



### 2、初始化实体类
 实体的创建，注意初始化，在项目的开发过程中，避免不了从中间直接切入进行测试，以及，为了防止非空，我们有必要在每个节点进行初始化


```java



    @Override
    public ClearBalance get(Long userId) {
        ClearBalance one = clearBalanceRepository.findOne(userId);
        if (one == null){
            one = new ClearBalance().setUserId(userId);
            init(one);
        }
        return one;
    }

    @Transactional(rollbackFor = Exception.class, isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)
    @Override
    public boolean withdraw(Long userId, BigDecimal money) {
        ClearBalance one = clearBalanceRepository.findOne(userId);
        if (one == null){
            one = new ClearBalance().setUserId(userId);
            init(one);
            return false;
        }
        return clearBalanceRepository.withdraw(userId, money, new Date()) > 0;
    }

    @Transactional(rollbackFor = Exception.class, isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)
    @Override
    public boolean addNoSettleMoney(Long userId, BigDecimal money) {
        ClearBalance one = clearBalanceRepository.findOne(userId);
        if (one == null){
            one = new ClearBalance().setUserId(userId);
            init(one);
        }

        return clearBalanceRepository.addNoSettleMoney(userId, money, new Date()) > 0;
    }

    @Transactional(rollbackFor = Exception.class, isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)
    @Override
    public boolean subNoSettleMoney(Long userId, BigDecimal money) {
        ClearBalance one = clearBalanceRepository.findOne(userId);
        if (one == null){
            one = new ClearBalance().setUserId(userId);
            init(one);
        }
        return clearBalanceRepository.subNoSettleMoney(userId, money, new Date()) > 0;
    }

    @Transactional(rollbackFor = Exception.class, isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)
    @Override
    public boolean noSettleToBalance(Long userId, BigDecimal money) {
        ClearBalance one = clearBalanceRepository.findOne(userId);
        if (one == null) {
            one = new ClearBalance().setUserId(userId);
            init(one);
        }
        return clearBalanceRepository.noSettleToBalance(userId, money, new Date()) > 0;
    }

    @Transactional(rollbackFor = Exception.class, isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED)
    @Override
    public boolean addBalance(Long userId, BigDecimal money) {
        ClearBalance one = clearBalanceRepository.findOne(userId);
        if (one == null) {
            one = new ClearBalance().setUserId(userId);
            init(one);
        }
        return clearBalanceRepository.addBalance(userId, money, new Date()) > 0;
    }

    private void init(ClearBalance clearBalance){
        try {
            clearBalanceRepository.save(clearBalance);
        }catch (Exception e){
            log.info("保存用户余额发生冲突：" + clearBalance);
        }
    }


```



### 3、异常问题

#### 3.1 、 e.printStank()

 1、catch中尽量不要使用e.printStank()，而是采用log将日志打出来（比如传到graylog上我们就可以查看了，具体我自己封装了log日志的工具类，更加详细的查看）

#### 3.2 、是否抛出

一、抛出异常<br/>

1、自己设计的异常<br/>

  throw new AppException("密码不为空");<br/>

 2、别人设计的异常（一般情况下，别人设计的异常，不需要看详情，我们自己将跑出去）<br/>

```java
catch (ApiException e) {
      throw new AppException(e.getMessage());  
  }catch (UnsupportedEncodingException e) {
    throw new RuntimeException(e.getMessage(), e);
}catch (Exception e){
    throw new RuntimeException(e.getMessage(), e);
}
        
```
3、我们工具类中如果是正常的，不要返回null，而是抛出去


```java
public class UrlEncodeUtil {

    public String encode(String text){
        try {
            return URLEncoder.encode(text,"gbk" );
        }catch (UnsupportedEncodingException e) {
            throw new RuntimeException(e.getMessage(), e);
        }catch (Exception e){
            throw new RuntimeException(e.getMessage(), e);
        }
    }

    public String decode(String text){
        try {
            return URLEncoder.encode(text, "gbk");
        } catch (UnsupportedEncodingException e) {
            throw new RuntimeException(e.getMessage(), e);
        }catch (Exception e){
            throw new RuntimeException(e.getMessage(), e);
        }
    }

}

```

二、不抛出异常<br/>

针对大量数据的处理

<font color="red"> 大量数据中如果包含个别不是正常数据，或者有某一特定类型的数据存在错误，要使用独立事物，防止一块臭肉坏了一锅新汤，而且进来捕获单个事物的异常，不抛出，然后继续执行外面未执行的任务

</font>

### 4、添加标记参数

#### 是否抛出异常 

有可能在执行的时候，防止一块臭肉坏了大量数据

```java
    
    @ApiModelProperty(required = true,value = "是否抛出异常")
    private boolean exception ;


```
#### 结果集合是否取第一个

淘宝有些接口我其实是只会用到一个的情况，但是也不排除多个一起处理，返回的结果是一个集合，但是我们可能只获取集合中的第一个就可以

```
@ApiModelProperty(required = true,value = "结果集合是否只取第一个")
private boolean onlyOne ;
    
    
if(reqData.isOnlyOne()){

    log.info(rsp.getResults().get(0).getMaterialLibType());      
}
            
```


### 5、



<br/><br/><br/><br/>
<font color="red"> 感兴趣的，欢迎添加博主微信， </font><br/>
哈，博主很乐意和各路好友交流，如果满意，请打赏博主任意金额，感兴趣的在微信转账的时候，备注您的微信或者其他联系方式。添加博主微信哦。
<br/>
请下方留言吧。可与博主自由讨论哦

|支付包 | 微信|微信公众号|
|:-------:|:-------:|:------:|
|![支付宝](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/alpay.jpg) | ![微信](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/weixin.jpg)|![微信公众号](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/my/qrcode_for_gh_a23c07a2da9e_258.jpg)|




<!-- Gitalk 评论 start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'y1D9fKd2mNLTtJo7',
    });
    gitalk.render('gitalk-container');
</script> 

<!-- Gitalk end -->

