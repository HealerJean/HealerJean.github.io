---
title: 设计模式之生成实例_Prototype模式_通过复制生成实例
date: 2019-02-20 03:33:00
tags: 
- DesignPattern
category: 
- DesignPattern
description: 设计模式之生成实例_Prototype模式_通过复制生成实例
---

<!-- 

https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/
　　首行缩进

<font  clalss="healerColor" color="red" size="5" >     </font>

<font  clalss="healerSize"  size="5" >     </font>
-->




## 前言

#### [博主github](https://github.com/HealerJean)
#### [博主个人博客http://blog.healerjean.com](http://HealerJean.github.io)    



在java中new关键字制定类名来生成类的实例，像这样使用new来生成实例时是必须制定类名的，但是有些时候，**我们需要在不指定类名的前提下生成实例**，比如下面的情况    

1、对象种类繁多，无法将他们整合到一个类中     

+ + 需要处理的对象太多了，如果将他们分别作为一个类，需要编写很多个类文件

2、难以根据类生成实例时  

+ + 生成实例的过程太复杂，很难根据类来生成实例。 

3、想解耦框架与生成的实例     

+ 想让实例生成实例的框架不依赖与具体的类。这是不能指定类名来生成实例，而是事先注册一个原型实例 ，然后通过复制实例来生成新的实例。

这里使用Java中的clone方法和cloneable接口的使用方法



### 1、示例程序

#### 1.1、示例程序UML

![1558698077306](D:\study\HealerJean.github.io\blogImages\1558698077306.png)





#### 1.2、Manager

下面的hashmap用来存放Product，根据不同的key进行标识



```java
package com.hlj.moudle.design.D05_生成实例.D06_Prototype模式.framework;

import java.util.*;

public class Manager {

    private HashMap showcase = new HashMap();

    public void register(String name, Product proto) {
        showcase.put(name, proto);
    }

    public Product create(String protoname) {
        Product p = (Product) showcase.get(protoname);
        return p.createClone();
    }
}

```



#### 1.3、Product 接口 

```java
	public interface Product extends Cloneable {

    void use(String s);

    Product createClone();
}

```





#### 1.4、实现接口Product 

##### 1.4.1、MessageBox

```java
package com.hlj.moudle.design.D05_生成实例.D06_Prototype模式;
package com.hlj.moudle.design.D05_生成实例.D06_Prototype模式;


import com.hlj.moudle.design.D05_生成实例.D06_Prototype模式.framework.Product;

public class MessageBox implements Product {

    private char decochar;

    public MessageBox(char decochar) {
        this.decochar = decochar;
    }

    public void use(String s) {
        int length = s.getBytes().length;
        for (int i = 0; i < length + 4; i++) {
            System.out.print(decochar);
        }
        System.out.println("");
        System.out.println(decochar + " " + s + " " + decochar);
        for (int i = 0; i < length + 4; i++) {
            System.out.print(decochar);
        }
        System.out.println("");
    }

    public Product createClone() {
        Product p = null;
        try {
            p = (Product) super.clone();
        } catch (CloneNotSupportedException e) {
            e.printStackTrace();
        }
        return p;
    }
}


```



##### 1.4.2、UnderlinePen

```java
package com.hlj.moudle.design.D05_生成实例.D06_Prototype模式;


import com.hlj.moudle.design.D05_生成实例.D06_Prototype模式.framework.Product;

public class UnderlinePen implements Product {


    private char ulchar;

    public UnderlinePen(char ulchar) {
        this.ulchar = ulchar;
    }

    public void use(String s) {
        int length = s.getBytes().length;
        System.out.println("\"" + s + "\"");
        System.out.print(" ");
        for (int i = 0; i < length; i++) {
            System.out.print(ulchar);
        }
        System.out.println("");
    }

    public Product createClone() {
        Product p = null;
        try {
            p = (Product) clone();
        } catch (CloneNotSupportedException e) {
            e.printStackTrace();
        }
        return p;
    }
}

```

#### 1.5、Main测试

```java
package com.hlj.moudle.design.D05_生成实例.D06_Prototype模式;


import com.hlj.moudle.design.D05_生成实例.D06_Prototype模式.framework.Manager;
import com.hlj.moudle.design.D05_生成实例.D06_Prototype模式.framework.Product;

public class Main {
    public static void main(String[] args) {
        // 准备
        Manager manager = new Manager();
        UnderlinePen upen = new UnderlinePen('~');

        MessageBox mbox = new MessageBox('*');
        MessageBox sbox = new MessageBox('/');
        manager.register("strong message", upen);
        manager.register("warning box", mbox);
        manager.register("slash box", sbox);

        // 生成
        Product p1 = manager.create("strong message");
        p1.use("Hello, world.");
        Product p2 = manager.create("warning box");
        p2.use("Hello, world.");
        Product p3 = manager.create("slash box");
        p3.use("Hello, world.");
    }
}


"Hello, world."
 ~~~~~~~~~~~~~
*****************
* Hello, world. *
*****************
/////////////////
/ Hello, world. /
/////////////////
```



### 2、Prototype模式中的登场角色

#### 2.1、Ptrototype(原型)

Product角色负责定义用于复制现有实例来生成新实例的方法，示例程序中，有Product接口来扮演这个角色（Cloneable接口）

#### 2.2、ConcretePrototype （具体的类型）

ConcreteProtype角色负责实现复制现有实例并生成新实例的方法，示例程序中 MessageBox和UnderlinePen扮演此角色

#### 2.3、Client （使用者）

Clent角色负责**使用复制实例的方法生成新的实例**，实例程序中Manger类扮演此角色 

### 3、UML图



![1558927517898](D:\study\HealerJean.github.io\blogImages\1558927517898.png)

### 4、扩展思路

#### 4.1、不能根据类来生成实例吗

##### 4.1.1、对象种类繁多，无法将它们整合到一个类中

+ 1 使用 “ ~ ” 为字符串添加下划线
+ 2 使用 “ * ” 为字符串添加边框
+ 3 使用 “ / ” 为字符串添加边框 

我们这个示例程序，只生成了3种样式，但是如果将每个样式都 编写一个类，类的数量会很庞大，而且很多都是可以复用的，比如 2 ，3  。所以这样使用复制模式的话，就可以解决这种类繁多的问题

##### 4.1.2、想解耦框架与生成的实例时， (不确定类名字，但是确定类的一些属性)  

我们上面只用了关于类的一些key值，通过clone方法就获取的类的实例，讲框架从类名的束缚中解脱出来了，在代码中使用类的名字不一定是坏事，但是一旦在代码中出现要使用类的名字，就无法与该类分离出来。



### 5、延伸阅读Cloneable

#### 5.1、clone方法是哪里定义的

clone是定义在了object中，因为object是所有对象的父类 

#### 5.2、Cloneable接口

这个接口是表示接口，如果没有实现该接口使用clone方法会报错，它没有声明任何方法，它只是用来标记可以使用clone方法进行复制，这样的接口被称为 标记接口

#### 5.3、clone方法进行的是浅复制

























<br/>
<br/>

<font  color="red" size="5" >     
感兴趣的，欢迎添加博主微信
 </font>

<br/>



哈，博主很乐意和各路好友交流，如果满意，请打赏博主任意金额，感兴趣的在微信转账的时候，备注您的微信或者其他联系方式。添加博主微信哦。    

请下方留言吧。可与博主自由讨论哦

|微信 | 微信公众号|支付宝|
|:-------:|:-------:|:------:|
| ![微信](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/weixin.jpg)|![微信公众号](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/my/qrcode_for_gh_a23c07a2da9e_258.jpg)|![支付宝](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/alpay.jpg) |



<!-- Gitalk 评论 start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'AAAAAAAAAAAAAAA',
    });
    gitalk.render('gitalk-container');
</script> 

<!-- Gitalk end -->

