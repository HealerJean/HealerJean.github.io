****---
title: Request中藏了什么东东
date: 2018-12-07 03:33:00
tags: 
- http
category: 
- http
description: Request中藏了什么东东
---
<!-- image url 
https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages
　　首行缩进
<font color="red">  </font>

<font  color="red" size="4">   </font>


<font size="4">   </font>
-->

## 前言

我们经常会用到后去PV，UV，有时候，
>1、判断访问我们网站的ip，
>2、以及我们有多个域名，他想知道访问我们的是哪个域名，
>3、他想知道访问的是哪个路径（接口）

那么Request就必不可少楼

### 1、获取Request方法

```java

import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

/**
 * 静态获取HttpServletRequest 和 session的方法
 * 要使用此类需要在web.xml注册org.springframework.web.context.request.RequestContextListener
 */
public class RequestHolder {

    public static HttpSession getSession() {
        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        return request.getSession();
    }

    public static HttpServletRequest getRequest() {
        return ((ServletRequestAttributes)RequestContextHolder.getRequestAttributes()).getRequest();
    }

    public static HttpServletResponse getResponse() {
        return ((ServletRequestAttributes)RequestContextHolder.getRequestAttributes()).getResponse();
    }

}

```


### 2、获取Ip

```java

    public static String getIp(){
        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        if(request==null)return null;
        String ip = request.getHeader("x-forwarded-for");
        if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
            ip = request.getHeader("X-Real-IP");
        }
        if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {
            ip = request.getRemoteAddr();
        }
        if(ip.toLowerCase().contains("x-forwarded-for")){
            String ip_temp = "";
            if(ip.contains(":") && ip.split(":").length>0 && !ip.endsWith(":")){
                ip_temp = ip.split(":")[1];
                if(StringUtils.isBlank(ip_temp)) ip_temp = ip.substring(0,ip.lastIndexOf("X-Forwarded-For"));
            }else{
                ip_temp = ip.substring(0,ip.lastIndexOf("X-Forwarded-For"));
            }
            ip = ip_temp.replaceAll(" ","");
        }
        if (ip.indexOf(",") > -1) {
            String ip_temp = ip.split(",")[0];
            ip_temp = ip_temp.replaceAll(" ", "");
            if(ip_temp.startsWith("10.") && ip.split(",").length>1){
                ip = ip.split(",")[1];
                ip = ip.replaceAll(" ", "");
            }else ip = ip_temp;
        }
        return ip;
    }

```


### 3、Request中的其他东西


```java

//http://test.dangqugame.cn/duodian/youhui/web/authorize?params=j4KDX9ovIC%2BD2dKT2FbgcKXduZ9FsJvN3Oq2Y4oBY5eq7qgl4x%2BWWQ%3D%3D

//http://localhost:8081/duodian/youhui/web/authorize?params=j4KDX9ovIC%2BD2dKT2FbgcKXduZ9FsJvN3Oq2Y4oBY5eq7qgl4x%2BWWQ%3D%3D


//1、获取全部路径
log.info(request.getRequestURL().toString()); ////全部路径，不带参数 http://localhost:8081/duodian/youhui/web/authorize

//2、获取域名（主机名加端口，80不显示）
log.info(request.getHeader("host"));  //localhost:8081  test.dangqugame.cn

//3、获取服务器的 主机名 
log.info(request.getServerName());       //localhost    test.dangqugame.cn

//4、当然我们的Springboot项目中是没有用项目的名字的,下面来源于网络）  
System.out.println(request.getContextPath()); ///可返回站点的根路径。也就是项目的名字   打印结果：/news  
System.out.println(request.getServletPath()); //打印结果：/main/list.jsp  
System.out.println(request.getRequestURI());  //打印结果：/news/main/list.jsp  

我的项目中，因为没有项目的名字，所以下面二者显示的是一样的
log.info(request.getRequestURI());  //我的项目中没有项目的名字 duodian/youhui/web/authorize
log.info(request.getServletPath());      //duodian/youhui/web/authorize

## //5、获取端口号
log.info(request.getServerPort()+"");        //8081  80

//6、获取本机端口号（第二个是阿里云的）
log.info(request.getLocalPort()+"");        //8081  8086

//7、访问的参数
log.info(request.getQueryString()); //参数 params=j4KDX9ovIC%2BD2dKT2FbgcKXduZ9FsJvN3Oq2Y4oBY5eq7qgl4x%2BWWQ%3D%3D

//8、获取来源于上一次网页的url，如果是直接根据地址访问的则，则为null
log.info(request.getHeader( "referer" )); //进入这个地址之前是从那个连接过来的，防盗连接使用




```



<br/><br/><br/>
<font color="red"> 感兴趣的，欢迎添加博主微信， </font><br/>
哈，博主很乐意和各路好友交流，如果满意，请打赏博主任意金额，感兴趣的在微信转账的时候，备注您的微信或者其他联系方式。添加博主微信哦。
<br/>
请下方留言吧。可与博主自由讨论哦

|微信 | 微信公众号|支付宝|
|:-------:|:-------:|:------:|
| ![微信](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/weixin.jpg)|![微信公众号](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/my/qrcode_for_gh_a23c07a2da9e_258.jpg)|![支付宝](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/alpay.jpg) |




<!-- Gitalk 评论 start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'AVjPrq7f2WNwDvlK',
    });
    gitalk.render('gitalk-container');
</script> 

<!-- Gitalk end -->

