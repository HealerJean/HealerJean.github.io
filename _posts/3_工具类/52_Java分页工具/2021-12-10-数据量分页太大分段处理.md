---
title: 数据量分页太大分段处理
date: 2012-12-10 00:00:00
tags: 
- Database
category: 
- Database
description: 数据量分页太大分段处理
---

**前言**     

 Github：[https://github.com/HealerJean](https://github.com/HealerJean)         

 博客：[http://blog.healerjean.com](http://HealerJean.github.io)          



# 1、批量获取数据分段处理

```java
@Slf4j
public class BigDataQueryUtils {

    /**
     * 1、获取分段结果
     */
    @Test
    public void test(){
        int totalCount = 10;
        int intervalLength = 5;
        List<ImmutablePair<Integer, Integer>> result = intervalPairOfTotalCount(totalCount, intervalLength);
        log.info("totalCouont:{}, intervalLength:{}, result:{}", totalCount, intervalLength, result);
    }

    /**
     * 获取分段区间，索引从0开始
     * @param totalCount 总数量
     * @param pageSize 区间长度
     */
    public static List<ImmutablePair<Integer, Integer>> intervalPairOfTotalCount(Integer totalCount, Integer pageSize){
        List<ImmutablePair<Integer, Integer>> result = new ArrayList<>();

        Integer pageCount;
        if (totalCount % pageSize == 0) {
            pageCount = totalCount / pageSize;
        } else {
            pageCount = totalCount / pageSize + 1;
        }

        Integer pageNow = 1;
        while (pageNow <= pageCount ){
            int startIndex = (pageNow - 1) * pageSize;
            ImmutablePair<Integer, Integer> pair = ImmutablePair.of(startIndex, pageSize);

            // 结束索引，看需要是否要取分段endIndex
            // int endIndex = pageNow .compareto(pageCount) !=0  ? startIndex + pageSize : totalCount;
            // ImmutablePair<Integer, Integer> pair = ImmutablePair.of(startIndex, endIndex);

            pageNow++;
            result.add(pair);
        }
        return result;
    }

}

```



# 2、分页太大分段处理

```java

   @Override
    public List<AftersaleBill> queryAfterSalePageList(PageQuery<AftersaleBillQuery> query) {
        List<AftersaleBill> result = new ArrayList<>();

        query.setPageNo(1);
        query.setPageSize(100);
        boolean finish = false;
        try {
            while (Boolean.FALSE.equals(finish)) {
                PageListResult<AftersaleBill> pageListResult = aftersaleBillResource.queryAfterSalePageList(query);
                if (pageListResult == null || !"0".equals(pageListResult.getCode())) {
                    log.error(" fail, query:{}, pageListResult:{}", JSON.toJSONString(query), JSON.toJSONString(pageListResult);
                    throw new AppRunTimeException("接口返回错误");
                }
                if (!CollectionUtils.isEmpty(pageListResult.getValues()) && pageListResult.getPagenation() != null && pageListResult.getPagenation().getPageCount() >= pageListResult.getPagenation().getPageNo()) {
                    result.addAll(pageListResult.getValues());
                    query.setPageNo(query.getPageNo() + 1);
                    continue;
                }
                finish = true;
            }
        } catch (Exception e) {
            log.error(" error, query:{}", JSON.toJSONString(query));
            throw new AppRunTimeException("接口查询异常");
        }
        return result;
    }
```





![ContactAuthor](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/artical_bottom.jpg)



<!-- Gitalk 评论 start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'kh83w2LedSlTHY15',
    });
    gitalk.render('gitalk-container');
</script> 



<!-- Gitalk end -->



