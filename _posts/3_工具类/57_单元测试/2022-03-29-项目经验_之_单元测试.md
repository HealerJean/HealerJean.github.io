---
title: 项目经验_之_单元测试
date: 2022-03-29 00:00:00
tags: 
- Experience
category: 
- Experience
description: 项目经验_之_单元测试
---

**前言**     

 Github：[https://github.com/HealerJean](https://github.com/HealerJean)         

 博客：[http://blog.healerjean.com](http://HealerJean.github.io)          

 来源：阿里技术



# 1、测试环节的简单分类

⬤单元测试：快速地检查一个类或极小范围内的功能        

⬤冒烟测试：快速检查系统核心功能是否有明确缺陷           

⬤ 集成测试：检查整个应用或系统的功能           

⬤ 回归测试：检查变更代码是否破坏旧的功能           

⬤ 黑盒测试：将整个系统看成一个黑盒进行不特定测试           

⬤ 白盒测试：按照编码或运行细节，设计特定的测试过程

## 1.1、如何推进

> 从不写单元测试、不会写单元测试，到写单元测试、写有效的单元测试，可以从4个阶段来推进。



![image-20220329205359078](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/image-20220329205359078.png)



# 2、`Junit`

## 2.1、`mvn test` 和 `mvn surefire:test`       

> `surefire:test` 是 `maven-surefire-plugin` 中定义的一个任务，默认绑定在` test` 阶段运行          
>
> ⬤ 当运行 `mvn tes` t命令时，先运行 `test` 阶段之前的 `compile`、`test-compile` 等 `phase` 及绑定 `goal` 任务;        
>
> ⬤ 而 `mvn surefire:test` 则是直接运行这个任务，不会执行编译，因此需要提前手动编译好源代码和测试代码;             
>
> `Maven` 会自动收集当前项目的所有模块，做依赖树和插件合并。当 `pom` 中未声明任何插件或者插件版本号为空，`Maven` 会使用默认值进行填充。         
>
> `maven` 的 `default` 生命周期和插件版本关系的声明文件：`maven-core-3.6.3.jar/META-INF/plexus/default-bindings.xml`。

## 2.2、`JUnit4` 是如何被 `Maven` 唤起的

> 前文提到，`surefire` 插件的会将测试任务绑定在` test` 阶段，因此当运行` mvn tes`t时会调用 `surefire` 插件的方法。`surefire` 通过 `SPI` 机制扫描类路径下，发现测试引擎实现类(需要实现 `org.apache.maven.surefire.providerapi.SurefireProvider`)，从而将测试任务转嫁到具体的执行引擎 

### 2.2.1、按测试类名称过滤

> `Maven Surefire` 插件无其他测试框架的依赖注入时，默认使用` JUnit3Provider `作为执行引擎，因此要求测试类命名为以下模式：

```
过程中会排除所有嵌套类(包括静态成员类)，也可以通过在 pom 文件中配置include和exclude规则来覆盖默认行为。


**/Test*.java
**/*Test.java
**/*Tests.java
**/*TestCase.java
```

### 2.2.2、默认引擎下扫描测试方法的规则：

> ⬤ 测试方法必须是 `public`， 非 `static`，返回类型为 `void`，无参的方法；       
>
> ⬤ 测试方法必须写成 `testXxx`形式；        
>
> ⬤ 全局变量可以在无参的构造方法中初始化；         
>
> ⬤ 每次执行一个测试用例前，执行一遍`setUp()`，用于对数据的初始化；执行完一个测试用例后，再执行`tearDown()`，用于销毁还原数据;    
>
> 因此当我们需要使用 `JUnit4` 的注解如 `@Before`，需要添加依赖 `surefire-junit4` 告诉 `SurefirePlugin` 优先使用` JUnit4` 的 `@Runner` 来运行。

```xml
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-surefire-plugin</artifactId>
  <version>2.16</version>
  <dependencies>
    <dependency>
      <groupId>org.apache.maven.surefire</groupId>
      <artifactId>surefire-junit4</artifactId>
      <version>2.16</version>
    </dependency>
  </dependencies>
</plugin>
```





![ContactAuthor](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/artical_bottom.jpg)



<!-- Gitalk 评论 start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'rAyaLKZWhFpQbXjC',
    });
    gitalk.render('gitalk-container');
</script> 




<!-- Gitalk end -->



