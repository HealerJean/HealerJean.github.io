---
title: 服务器_之_CPU与负载
date: 2021-01-12 00:00:00
tags: 
- HardWare
category: 
- HardWare
description: 服务器_之_CPU与负载
---

**前言**     

 Github：[https://github.com/HealerJean](https://github.com/HealerJean)         

 博客：[http://blog.healerjean.com](http://HealerJean.github.io)          



# 1、`CPU` 和 `LOAD`

> ⬤  `load averag`e 表示的是 `CPU`的负载，包含的信息不是`CPU`的使用率状况，**而是在一段时间内`CPU`正在处理以及等待 `CPU ` 处理的进程数之和的统计信息，也就是是一段时间内正在使用和等待使用CPU的平均任务数。这个数字越小越好，`CPU` 利用率高，并不意味着负载就一定大**。            
>
> > **如果`load average`值长期大于系统 `CPU `的个数则说明`CPU`很繁忙，负载很高，可能会影响系统性能，导致系统卡顿响应时间长等等**。    
> >
> > 举例来说： 
> >
> > ◯ 如果我有一个程序它需要一直使用 `cpu` 的运算功能，那么此时 `cpu` 的使用率可能达到`100%`，但是 `cpu` 的工作负载则是趋近于 “1”，因为 `cpu` 仅负责一个工作嘛！             
> >
> > ◯ 如果同时执行这样的程序两个呢？`cpu` 的使用率还是 `100%` ，但是工作负载则变成`2`了。所以也就 是说，当`cpu`的工作负载越大，代表`cpu`必须要在不同的工作之间进行频繁的工作切换。
>



## 1.1、处理器

### 1.1.1、单核处理器的情况      

  　**行车过桥**：   **一只单核的处理器可以形象得比喻成一条单车道。**     

　　设想下，你现在需要收取这条道路的过桥费 ，忙于处理那些将要过桥的车辆。你首先当然需要了解些信息，例如车辆的载重、以及 还有多少车辆正在等待过桥。如果前面没有车辆在等待，那么你可以告诉后面的司机通过。 如果车辆众多，那么需要告知他们可能需要稍等一会。     

　　0.00 表示目前桥面上没有任何的车流，过往的车辆可以丝毫不用等待的通过。
　　1.00 表示刚好是在这座桥的承受范围内。 这种情况不算糟糕，只是车流会有些堵，不过这种情况可能会造成交通越来越慢。
　　超过 1.00，那么说明这座桥已经超出负荷，交通严重的拥堵。 那么情况有多糟糕? 例如 2.00 的情况说明车流已经超出了桥所能承受的一倍，那么将有多余过桥一倍的车辆正在焦急的等待。3.00 的话情况就更不妙了，说明这座桥基本上已经快承受不了，还有超出桥负载两倍多的车辆正在等待。

  　　上面的情况和处理器的负载情况非常相似。一辆汽车的过桥时间就好比是处理器处理某线程的实际时间。Unix 系统定义的进程运行时长为所有处理器内核的处理时间加上线程 在队列中等待的时间。    

　　**在实际情况中，有经验的系统管理员都会将这条线划在 0.70：所以你说的理想负荷为 1.00 ?”，负荷 1.00 说明系统已经没有剩余的资源了。 **       

　　“**需要进行调查法则**”： **如果长期你的系统负载在 0.70 上下**，那么你需要在事情变得更糟糕之前，花些时间了解其原因。     

　　“**现在就要修复法则**”：**1.00** 。 如果你的服务器系统负载长期徘徊于 1.00，那么就应该马上解决这个问题。否则，你将半夜接到你上司的电话，这可不是件令人愉快的事情。     

　　“**凌晨三点半锻炼身体法则**”：5.00。 如果你的服务器负载超过了 5.00 这个数字，那么你将失去你的睡眠，还得在会议中说明这情况发生的原因，总之千万不要让它发生。



### 1.1.2、多个处理器的情况

　　**那么多个处理器呢?我的均值是 3.00，但是系统运行正常!，你有四个处理器的主机？那么它的负载均值在 3.00 是很正常的**      

　　在多处理器系统中，1.00 表示单个处理器，而 2.00 则说明有两个双处理器，那么 4.00 就说明主机具有四个处理器。    



### 1.1.3、多核与多处理器

　　我们来讨论下多核心处理器与多处理器的区别。从性能的角度上理解，**一台主机拥有多核心的处理器与另台拥有同样数目的处理器性能基本上可以认为是相差无几。当然实际情况会复杂得多**,　　**但即便这些因素造成的实际性能稍有不同，其实系统还是以处理器的核心数量计算负载均值** 。这使我们有了两个新的法则：     

　　核心分布在分别几个单个物理处理中并不重要，**其实两个四核的处理器 等于四个双核处理器 等于 八个单处理器。所以，它应该有八个处理器内核。** **<font color = "red">在多核处理中，你的系统均值不应该高于处理器核心的总数量。</font>**     



## 1.2、分析

> `CPU`利用率参考值：`15.30` ，最小值 `10.5`，最大 `21.75`
>
> 一般能够被接受的值是 `load average` <=  `CPU核数` * `0.7`。

　　<font color = "red">很多人会这样理解负载均值：三个数分别代表不同时间段的系统平均负载(一分钟、五 分钟、以及十五分钟)，它们的数字当然是越小越好。数字越高，说明服务器的负载越 大，这也可能是服务器出现某种问题的信号。  </font>    

　　**<font color = "red">而事实不完全如此，是什么因素构成了负载均值的大小，以及如何区分它们目前的状况是 “好”还是“糟糕”?什么时候应该注意哪些不正常的数值?</font>**          

　　**<font color = "red">最后一个问题，"load average"一共返回三个平均值----1分钟系统负荷、5分钟系统负荷，15分钟系统负荷，----应该参考哪个值？</font>**    

如果只有1分钟的系统负荷大于1.0，其他两个时间段都小于1.0，这表明只是暂时现象，问题不大。      

如果15分钟内，平均系统负荷大于1.0（调整CPU核心数之后），表明问题持续存在，不是暂时现象。所以，你应该主要观察"15分钟系统负荷"，将它作为电脑正常运行的指标。















![ContactAuthor](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/artical_bottom.jpg)



<!-- Gitalk 评论 start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'AAAAAAAAAAAAAAAAAA',
    });
    gitalk.render('gitalk-container');
</script> 



<!-- Gitalk end -->



