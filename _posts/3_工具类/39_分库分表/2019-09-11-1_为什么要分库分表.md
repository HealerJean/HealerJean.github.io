---
title: 为什么要分库分表
date: 2019-09-11 03:33:00
tags: 
- Database
category: 
- Database
description: 为什么要分库分表
---

<!-- 

https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/blogImages/
　　首行缩进

<font  clalss="healerColor" color="red" size="5" >     </font>

<font  clalss="healerSize"  size="5" >     </font>
-->




## 前言

#### [博主github](https://github.com/HealerJean)
#### [博主个人博客http://blog.healerjean.com](http://HealerJean.github.io)    



## 1、解释 

我们知道互联网是由非常庞大的用户组成，所以肯定有非常绝大的请求，这些请求又会产生非常巨大的信息存储在数据库中，由于数据量非常巨大，单个数据库的表示很难容纳所有数据，所以就有了分库分表的需求。   对于数据的拆分主要有两个方面 ：**垂直拆分和水平拆分**

### 1.1、垂直拆分



> 垂直拆分： 根据业务的维度，将原本的一个库（表）拆分为多个库（表〉，每个库（表）
> 与原有的结构不同。



#### 1.1.1、垂直分表

**也就是“大表拆小表”，基于列字段进行的**。一般是表中的字段较多，将不常用的， 数据较大，长度较长（比如text类型字段）的拆分到“扩展表“。 一般是针对那种几百列的大表，也避免查询时，数据量太大造成的“跨页”问题。

#### 1.1.2、垂直分库

**垂直分库针对的是一个系统中的不同业务进行拆分**，按照业务把不同的数据放到不同的库中。其实在一个大型而且臃肿的数据库中表和表之间的数据很多是没有关系的，比如用户User一个库，商品Producet一个库，订单Order一个库。 切分后，要放在多个服务器上，而不是一个服务器上 



### 1.2、水平拆分



> 水平拆分： 根据分片(sharding )算法，将一个库（表）拆分为多个库（表），每个库（表）依旧保留原有的结构。



#### 1.2.1、水平分表

![1568187931226](D:\study\HealerJean.github.io\blogImages\1568187931226.png)



> 针对数据量巨大的单张表（比如订单表），按照某种规则（`Hash取模`、`地理区域`、`时间`等），切分到多张表里面去。 但是这些表还是在同一个库中     



**结果：分表能解决数据量过大造成的查询效率低下的问题     **



**问题：但是无法有效解决数据的并发访问能力。，所以库级别的数据库操作还是有IO瓶颈。不建议采用。**



#### 1.2.2、水平分库+分表

![1568187963745](D:\study\HealerJean.github.io\blogImages\1568187963745.png)

> 将数据库拆分，提高数据库的写入能力就是所谓的分库。将单张表的数据切分到多个数据库中，表的结构是一样的 。



**结果： 水平分库分表能够有效的缓解单机和单库的性能瓶颈和压力，突破IO、连接数、硬件资源等的瓶颈。**



###  1.3、水平分库分表的规则    

>路由：通过分库分表规则查找到对应的表和库的过程叫作路由。例如，分库分表的规则是user_id % 4，当用户新注册了一个账号时，假设用户的ID是123，我们就可以通过123 % 4 = 3确定此账号应该被保存在User3表中。当ID为123的用户登录时，我们可通过123 % 4 = 3计算后，确定其被记录在User3中。



#### 1.3.1 、**Hash取模**

> 对hash结果取余数 (hash() mod N)：对机器编号从0到N-1，按照自定义的hash()算法，对每个请求的hash()值按N取模，得到余数i，然后将请求分发到编号为i的机器



**使用场景**：**哈希分片常常应用于数据没有时效性的情况**      

> 有一家公司在一年内能做10亿条交易，假设每个数据库分片能够容纳5000万条数据，则至少需要20个表才能容纳10亿条交易。在路由时，我们根据交易ID进行哈希取模来找到数据属于哪个分片，因此，在设计系统时要充分考虑如何设计数据库的分库分表的路由规则。



#### 1.3.2 、**地理区域**

> 比如按照华东，华南，华北这样来区分业务       

使用场景：**比如我们购买ECS服务器数据，以及阿里云图片服务器等。**



#### 1.3.3 、**时间**

> 按照时间切分，就是将6个月前，甚至一年前的数据切出去放到另外的一张表，因为随着时间流逝，这些表的数据 被查询的概率变小，所以没必要和“热数据”放在一起，这个也是“冷热数据分离”。    

**使用场景** ：**切片方式适用于有明显时间特点的数据**，    

> 比如一个用户的订单交易数据，我们可以根据月或者季度进行切片，具体由交易数据量来决定以什么样的时间周期进行切割
> 



## 2、分库分表后的问题


### 2.1、事务

分库分表后，就成了分布式事务了。如果依赖数据库本身的分布式事务管理功能去执行事务，将付出高昂的性能代价； 如果由应用程序去协助控制，形成程序逻辑上的事务，又会造成编程方面的负担。   



### 2.2、多库结果集合并（group by，order by），跨库join



分库分表后表之间的关联操作将受到限制，我们无法join位于不同分库的表，也无法join分表粒度不同的表， 结果原本一次查询能够完成的业务，可能需要多次查询才能完成。



### 2.3、数据迁移、容量规划





## 3、借鉴的博主

+ [MySQL 分库分表方案，总结的非常好！](https://blog.csdn.net/qq_39940205/article/details/80536666)

+ [史上最牛最全分库分表方案！](https://blog.csdn.net/dreamhua927/article/details/100669317)




<font  color="red" size="5" >     
感兴趣的，欢迎添加博主微信
 </font>       

   



哈，博主很乐意和各路好友交流，如果满意，请打赏博主任意金额，感兴趣的在微信转账的时候，备注您的微信或者其他联系方式。添加博主微信哦。    

请下方留言吧。可与博主自由讨论哦

|微信 | 微信公众号|支付宝|
|:-------:|:-------:|:------:|
| ![微信](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/weixin.jpg)|![微信公众号](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/my/qrcode_for_gh_a23c07a2da9e_258.jpg)|![支付宝](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/tctip/alpay.jpg) |



<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: 'ofYkw8qAEdBF0Jlm',
    });
    gitalk.render('gitalk-container');
</script> 

