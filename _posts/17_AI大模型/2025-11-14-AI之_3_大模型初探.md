---
title: AIä¹‹_1_å¤§æ¨¡å‹åˆæ¢
date: 2025-11-14 00:00:00
tags: 
- AI
category: 
- AI
description: AIä¹‹_1_å¤§æ¨¡å‹åˆæ¢
---

**å‰è¨€**     

 Githubï¼š[https://github.com/HealerJean](https://github.com/HealerJean)         

 åšå®¢ï¼š[http://blog.healerjean.com](http://HealerJean.github.io)          



# ä¸€ã€æˆ‘ä»¬å­¦ä¼šå’ŒAIè¯´è¯

>  æç¤ºå°±åƒç»™æœºå™¨äººä¸‹æŒ‡ä»¤ï¼šâ€œå¸®æˆ‘å†™ä¸€å°é“æ­‰ä¿¡â€ã€â€œæ€»ç»“è¿™ç¯‡æ–°é—»â€ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªè¶…çº§èªæ˜çš„æœ‹å‹ï¼Œè¯»è¿‡å…¨ç½‘æ‰€æœ‰ä¹¦ã€çœ‹è¿‡æ‰€æœ‰ç”µå½±ã€å¬æ‡‚äº†æ‰€æœ‰å¯¹è¯ã€‚ä½ åªéœ€è¦è¯´ä¸€å¥è¯ï¼Œä»–å°±èƒ½å›ç­”ä½ ã€å¸®ä½ å†™æ–‡ç« ã€ç”šè‡³ç¼–ç¨‹ã€‚    

è¿™ä¸ªæœ‹å‹å°±æ˜¯ **å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰**ï¼Œæ¯”å¦‚ Qwenã€ChatGPTã€Llama ç­‰ã€‚    

ä½ å’Œå®ƒçš„äº¤æµæ–¹å¼å« **æç¤ºï¼ˆPromptï¼‰**ï¼Œä¹Ÿå°±æ˜¯ä½ è¾“å…¥çš„ä¸€æ®µæ–‡å­—ã€‚

## 1ã€**`OpenAI` `SDK`**

```python
import os
from openai import OpenAI

client = OpenAI(
    # è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapi_key="sk-xxx"
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

completion = client.chat.completions.create(
    # æ¨¡å‹åˆ—è¡¨ï¼šhttps://help.aliyun.com/zh/model-studio/getting-started/models
    model="qwen-plus",
    messages=[
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯ç ”ç©¶å‘˜"},
        {"role": "user", "content": "æˆ‘æ˜¯HealerJeanï¼Œå¸®æˆ‘æ‰¾ä¸‹ç½‘ä¸Šå…³äºä»–çš„ä¸€äº›ä¿¡æ¯"},
    ]
)
print(completion.model_dump_json())
```



```json
{
    "usage": {
        "total_tokens": 272,
        "prompt_tokens_details": {
            "cached_tokens": 0,
            "audio_tokens": null
        },
        "prompt_tokens": 31,
        "completion_tokens_details": null,
        "completion_tokens": 241
    },
    "system_fingerprint": null,
    "service_tier": null,
    "object": "chat.completion",
    "model": "qwen-plus",
    "id": "chatcmpl-137e94be-3a4e-4fd4-adf5-3404e774bbcf",
    "created": 1764310918,
    "choices": [
        {
            "message": {
                "tool_calls": null,
                "role": "assistant",
                "refusal": null,
                "function_call": null,
                "content": "ç›®å‰äº’è”ç½‘ä¸Šæ²¡æœ‰å…¬å¼€çš„ã€è¢«å¹¿æ³›è®°å½•çš„å…¬ä¼—äººç‰©åä¸ºâ€œHealerJeanâ€å…·æœ‰æ˜ç¡®çš„ã€å¯éªŒè¯çš„èº«ä»½ä¿¡æ¯ã€‚è¿™ä¸ªåå­—å¯èƒ½å±äºä¸€ä½éå…¬ä¼—é¢†åŸŸçš„ä¸ªäººï¼Œæˆ–è€…æ˜¯ä¸€ä½åœ¨ç‰¹å®šé¢†åŸŸï¼ˆå¦‚æŠ€æœ¯ã€è‰ºæœ¯ã€ç¤¾äº¤åª’ä½“ç­‰ï¼‰ä½¿ç”¨è¯¥æ˜µç§°çš„åˆ›ä½œè€…ï¼Œä½†å°šæœªå½¢æˆå¤§è§„æ¨¡å…¬å¼€èµ„æ–™ã€‚\n\nå¦‚æœä½ æŒ‡çš„æ˜¯æŸä¸ªç‰¹å®šé¢†åŸŸçš„äººç‰©ï¼ˆä¾‹å¦‚ï¼šGitHub ä¸Šçš„æŠ€æœ¯åšä¸»ã€CSDN æˆ–åšå®¢å›­ä¸­çš„å¼€å‘è€…ã€æŸä½å¼€æºè´¡çŒ®è€…ã€æˆ–æ˜¯ç¤¾äº¤åª’ä½“ä¸Šçš„å†…å®¹åˆ›ä½œè€…ï¼‰ï¼Œå»ºè®®ä½ æä¾›æ›´å¤šèƒŒæ™¯ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š\n\n- ä»–æ˜¯å¦æ´»è·ƒåœ¨æŸä¸ªå¹³å°ï¼ˆå¦‚ GitHubã€çŸ¥ä¹ã€æ˜é‡‘ã€Bç«™ã€å¾®ä¿¡å…¬ä¼—å·ç­‰ï¼‰ï¼Ÿ\n- æ˜¯å¦ä¸æŸä¸ªæŠ€æœ¯æ ˆç›¸å…³ï¼ˆå¦‚ Javaã€Spring Bootã€å‰ç«¯å¼€å‘ç­‰ï¼‰ï¼Ÿ\n- æ˜¯å¦å†™è¿‡æŸäº›çŸ¥åçš„æŠ€æœ¯æ–‡ç« æˆ–å¼€æºé¡¹ç›®ï¼Ÿ\n\nä¾‹å¦‚ï¼Œåœ¨ä¸­æ–‡æŠ€æœ¯ç¤¾åŒºä¸­ï¼Œæœ‰ä¸€äº›å¼€å‘è€…ä½¿ç”¨ç±»ä¼¼â€œHealerJeanâ€çš„åå­—å‘å¸ƒå†…å®¹ï¼Œä½†éœ€è¦ç»“åˆå…·ä½“ä¸Šä¸‹æ–‡æ¥ç¡®è®¤èº«ä»½ã€‚\n\nâš ï¸ æ³¨æ„ï¼šå¦‚æœè¿™æ˜¯ä½ æœ¬äººçš„åå­—æˆ–ç¬”åï¼Œå¹¶å¸Œæœ›äº†è§£ç½‘ç»œä¸Šçš„ä¸ªäººä¿¡æ¯æš´éœ²æƒ…å†µï¼Œæˆ‘å¯ä»¥å¸®åŠ©ä½ åˆ†ææ½œåœ¨çš„éšç§é£é™©å¹¶æä¾›å»ºè®®ã€‚\n\nè¯·è¡¥å……æ›´å¤šä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘æ›´å‡†ç¡®åœ°ååŠ©ä½ ã€‚",
                "audio": null,
                "annotations": null
            },
            "logprobs": null,
            "index": 0,
            "finish_reason": "stop"
        }
    ]
}
```







## 2ã€`requestsåŸç”Ÿ`

```python
import requests
import json
import os

# ä»ç¯å¢ƒå˜é‡è·å–APIå¯†é’¥
API_KEY = os.environ.get("DASHSCOPE_API_KEY")
if not API_KEY:
    print("è¯·å…ˆè®¾ç½®ç¯å¢ƒå˜é‡: export DASHSCOPE_API_KEY='sk-ä½ çš„å¯†é’¥'")
    exit(1)

# OpenAIå…¼å®¹æ¨¡å¼APIç«¯ç‚¹
URL = "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions"

headers = {
    "Authorization": f"Bearer {API_KEY}",
    "Content-Type": "application/json",
    "X-DashScope-SSE": "enable"  # å¿…é¡»çš„å…¼å®¹æ¨¡å¼å¤´
}

# ç®€æ´çš„è¯·æ±‚ç»“æ„
payload = {
    "model": "qwen-plus",
    "messages": [
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯ç ”ç©¶å‘˜"},
        {"role": "user", "content": "æˆ‘æ˜¯HealerJeanï¼Œå¸®æˆ‘æ‰¾ä¸‹ç½‘ä¸Šå…³äºä»–çš„ä¸€äº›ä¿¡æ¯"}
    ],
    "temperature": 0.3,  # 0.0-1.0ï¼Œå€¼è¶Šä½å›å¤è¶Šç¡®å®š
    "max_tokens": 2000   # æœ€å¤§å›å¤é•¿åº¦
}

try:
    response = requests.post(URL, headers=headers, json=payload, timeout=30)
    response.raise_for_status()  # æ£€æŸ¥HTTPé”™è¯¯
    
    result = response.json()
    print(result)

except Exception as e:
    print(f"é”™è¯¯: {str(e)}")
    if hasattr(e, 'response') and e.response is not None:
        print(f"è¯¦ç»†é”™è¯¯: {e.response.text}")
```



```
{
    "usage": {
        "total_tokens": 478,
        "prompt_tokens_details": {
            "cached_tokens": 0
        },
        "prompt_tokens": 31,
        "completion_tokens": 447
    },
    "system_fingerprint": null,
    "object": "chat.completion",
    "model": "qwen-plus",
    "id": "chatcmpl-9ad332fc-7986-450f-a326-ca60bb58f1e3",
    "created": 1764311048,
    "choices": [
        {
            "message": {
                "role": "assistant",
                "content": "æ‚¨å¥½ï¼Œç›®å‰æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œâ€œHealerJeanâ€çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªç½‘ç»œæ˜µç§°æˆ–ç¬”åï¼Œä½†åœ¨å…¬å¼€çš„æƒå¨èµ„æ–™ã€å­¦æœ¯æ•°æ®åº“ã€ä¸»æµç¤¾äº¤åª’ä½“å¹³å°ï¼ˆå¦‚LinkedInã€GitHubã€çŸ¥ä¹ã€å¾®åšç­‰ï¼‰ä»¥åŠæ–°é—»æŠ¥é“ä¸­ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å‘æŸä½å¹¿ä¸ºäººçŸ¥çš„å…¬ä¼—äººç‰©ä½¿ç”¨è¿™ä¸€åç§°ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„æƒ…å†µå’Œå»ºè®®ï¼š\n\n1. **å¯èƒ½æ˜¯ä¸ªäººåŒ–æ˜µç§°**ï¼š\n   - â€œHealerJeanâ€ å¯èƒ½æ˜¯æ‚¨æˆ–å…¶ä»–äººåœ¨ç½‘ç»œç¤¾åŒºï¼ˆå¦‚CSDNã€æ˜é‡‘ã€åšå®¢å›­ã€V2EXã€GitHub ç­‰æŠ€æœ¯å¹³å°ï¼‰ä½¿ç”¨çš„IDã€‚è¿™ç±»æ˜µç§°å¸¸è§äºç¨‹åºå‘˜ã€å¼€å‘è€…æˆ–å†…å®¹åˆ›ä½œè€…ã€‚\n   - å»ºè®®æ‚¨å¯ä»¥å°è¯•åœ¨ä»¥ä¸‹å¹³å°æœç´¢è¯¥ç”¨æˆ·åï¼š\n     - GitHubï¼ˆhttps://github.com/ï¼‰\n     - CSDNï¼ˆhttps://www.csdn.net/ï¼‰\n     - æ˜é‡‘ï¼ˆhttps://juejin.cn/ï¼‰\n     - åšå®¢å›­ï¼ˆhttps://www.cnblogs.com/ï¼‰\n     - çŸ¥ä¹ï¼ˆhttps://www.zhihu.com/ï¼‰\n\n2. **åå­—æ„æˆåˆ†æ**ï¼š\n   - â€œHealerâ€ æ„ä¸ºâ€œæ²»æ„ˆè€…â€ï¼Œå¸¸ç”¨äºè¡¨è¾¾å…³æ€€ã€å¿ƒç†ç–—æ„ˆã€å¥åº·é¢†åŸŸçš„å†…å®¹ï¼›\n   - â€œJeanâ€ æ˜¯å¸¸è§çš„è‹±æ–‡åï¼ˆä¹Ÿå¯èƒ½æ˜¯ä¸­æ–‡åâ€œJeanâ€éŸ³è¯‘ï¼Œå¦‚â€œå¨Ÿâ€ã€â€œå»ºâ€ç­‰ï¼‰ï¼›\n   - ç»„åˆèµ·æ¥å¯èƒ½æ˜¯ä¸€ä½å…³æ³¨å¿ƒç†å¥åº·ã€çµæ€§æˆé•¿ã€ç¼–ç¨‹ç–—æ„ˆï¼ˆå¦‚ç”¨ä»£ç è¡¨è¾¾æƒ…æ„Ÿï¼‰ã€æˆ–è€…æŠ€æœ¯å†™ä½œä¸­å¸¦æœ‰æ¸©æƒ…é£æ ¼çš„äººã€‚\n\n3. **éšç§ä¿æŠ¤æé†’**ï¼š\n   - å¦‚æœè¿™æ˜¯æ‚¨è‡ªå·±çš„ç½‘åï¼Œä¸”ä¸å¸Œæœ›è¢«å¹¿æ³›æ£€ç´¢åˆ°ï¼Œå»ºè®®æ£€æŸ¥å„å¹³å°çš„éšç§è®¾ç½®ã€‚\n   - è‹¥æ¶‰åŠä»–äººï¼Œè¯·æ³¨æ„å°Šé‡ä»–äººéšç§ï¼Œé¿å…è¿‡åº¦æŒ–æ˜ä¸ªäººä¿¡æ¯ã€‚\n\nå¦‚æœæ‚¨èƒ½æä¾›æ›´å¤šèƒŒæ™¯ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šæ‰€åœ¨é¢†åŸŸâ€”â€”æ˜¯ç¨‹åºå‘˜ï¼Ÿå¿ƒç†å’¨è¯¢å¸ˆï¼Ÿåšä¸»ï¼Ÿæ‰€åœ¨åœ°åŒºï¼Ÿæ›¾å‘å¸ƒçš„å†…å®¹ç±»å‹ï¼Ÿï¼‰ï¼Œæˆ‘å¯ä»¥å¸®åŠ©æ›´ç²¾å‡†åœ°æŸ¥æ‰¾æˆ–åˆ†æã€‚\n\næ˜¯å¦å¯ä»¥è¡¥å……ä¸€äº›ä¸Šä¸‹æ–‡ï¼Ÿæ¯”å¦‚ï¼š\n- è¿™ä¸ªåå­—å‡ºç°åœ¨å“ªä¸ªå¹³å°ï¼Ÿ\n- æ˜¯å¦ä¸æŸä¸ªæŠ€æœ¯æ–‡ç« ã€å¼€æºé¡¹ç›®ã€è§†é¢‘æˆ–ç¤¾äº¤è´¦å·ç›¸å…³ï¼Ÿ\n\næˆ‘ä¼šå°½åŠ›ååŠ©æ‚¨è¿›ä¸€æ­¥å®šä½ã€‚"
            },
            "logprobs": null,
            "index": 0,
            "finish_reason": "stop"
        }
    ]
}
```



## 3ã€å­—æ®µè§£é‡Š

### 1ï¼‰ æ ¸å¿ƒå›å¤å†…å®¹ï¼ˆæœ€å¸¸ç”¨ï¼‰

| å­—æ®µ                         | å€¼ç¤ºä¾‹                        | è¯´æ˜                                                         |
| ---------------------------- | ----------------------------- | ------------------------------------------------------------ |
| `choices[0].message.role`    | `"assistant"`                 | å›å¤è€…è§’è‰²ï¼ˆå›ºå®šä¸º `assistant`ï¼‰                             |
| `choices[0].message.content` | `"ç›®å‰äº’è”ç½‘ä¸Šæ²¡æœ‰å…¬å¼€çš„..."` | **å®é™…å›å¤æ–‡æœ¬ï¼ˆæ‚¨éœ€è¦çš„æ ¸å¿ƒå†…å®¹ï¼‰**                         |
| `choices[0].finish_reason`   | `"stop"`                      | ç”Ÿæˆç»“æŸåŸå› ï¼š â€¢ `"stop"`ï¼šæ¨¡å‹è‡ªç„¶ç»“æŸ â€¢ `"length"`ï¼šè¾¾åˆ° `max_tokens` é™åˆ¶ â€¢ `"tool_calls"`ï¼šéœ€è¦è°ƒç”¨å‡½æ•° |

- `choices[0].finish_reason `ç”Ÿæˆç»“æŸåŸå› ï¼š
  -  `"stop"`ï¼šæ¨¡å‹è‡ªç„¶ç»“æŸ
  -  `"length"`ï¼šè¾¾åˆ° `max_tokens` é™åˆ¶
  -  `"tool_calls"`ï¼šéœ€è¦è°ƒç”¨å‡½æ•°



### 2ï¼‰`Token` ä½¿ç”¨ç»Ÿè®¡ï¼ˆè®¡è´¹/æ€§èƒ½åˆ†æï¼‰

| å­—æ®µ                                        | å€¼    | è¯´æ˜                                                  |
| ------------------------------------------- | ----- | ----------------------------------------------------- |
| `usage.prompt_tokens`                       | `31`  | **è¾“å…¥æ¶ˆè€—çš„ token æ•°**ï¼ˆæ‚¨çš„é—®é¢˜ + `system` æç¤ºï¼‰   |
| `usage.completion_tokens`                   | `241` | **è¾“å‡ºæ¶ˆè€—çš„ `token` æ•°**ï¼ˆæ¨¡å‹ç”Ÿæˆçš„å›å¤ï¼‰           |
| `usage.total_tokens`                        | `272` | **æ€»æ¶ˆè€— = prompt + completion**ï¼ˆç”¨äºè®¡è´¹ï¼‰          |
| `usage.prompt_tokens_details.cached_tokens` | `0`   | ç¼“å­˜å‘½ä¸­ token æ•°ï¼ˆDashScope çš„ç¼“å­˜ä¼˜åŒ–ï¼Œå½“å‰æœªä½¿ç”¨ï¼‰ |



### 3ï¼‰è¯·æ±‚å…ƒæ•°æ®ï¼ˆè°ƒè¯•/è¿½è¸ªç”¨ï¼‰

| å­—æ®µ                 | å€¼ç¤ºä¾‹                    | è¯´æ˜                                            |
| -------------------- | ------------------------- | ----------------------------------------------- |
| `id`                 | `"chatcmpl-137e94be-..."` | **å”¯ä¸€è¯·æ±‚ID**ï¼ˆè”ç³»é˜¿é‡Œäº‘æŠ€æœ¯æ”¯æŒæ—¶æä¾›ï¼‰      |
| `created`            | `1764310918`              | Unix æ—¶é—´æˆ³ï¼ˆå¯¹åº” **2025-11-28 14:21:58 UTC**ï¼‰ |
| `model`              | `"qwen-plus"`             | å®é™…è°ƒç”¨çš„æ¨¡å‹åç§°                              |
| `object`             | `"chat.completion"`       | å“åº”ç±»å‹ï¼ˆå›ºå®šå€¼ï¼‰                              |
| `system_fingerprint` | `null`                    | æ¨¡å‹éƒ¨ç½²æ ‡è¯†ï¼ˆé˜¿é‡Œäº‘æš‚æœªå¯ç”¨ï¼‰                  |



### 4ï¼‰é«˜çº§åŠŸèƒ½å­—æ®µï¼ˆå½“å‰æœªä½¿ç”¨ï¼‰

| å­—æ®µ                               | å€¼     | è¯´æ˜                                           |
| ---------------------------------- | ------ | ---------------------------------------------- |
| `choices[0].message.tool_calls`    | `null` | å‡½æ•°è°ƒç”¨ç»“æœï¼ˆå½“ä½¿ç”¨ Function Calling æ—¶è¿”å›ï¼‰ |
| `choices[0].message.function_call` | `null` | æ—§ç‰ˆå‡½æ•°è°ƒç”¨ï¼ˆå·²å¼ƒç”¨ï¼‰                         |
| `choices[0].message.refusal`       | `null` | æ‹’ç»å›ç­”çš„å†…å®¹ï¼ˆå¦‚æ¶‰åŠæ•æ„Ÿè¯é¢˜ï¼‰               |
| `service_tier`                     | `null` | æœåŠ¡ç­‰çº§ï¼ˆé˜¿é‡Œäº‘æœªå¯ç”¨ï¼‰                       |
| `audio` / `annotations`            | `null` | å¤šæ¨¡æ€æ‰©å±•å­—æ®µï¼ˆçº¯æ–‡æœ¬æ¨¡å¼æ— ç”¨ï¼‰               |



## 4ã€å¼€å‘è§„èŒƒ

### 1ï¼‰è¯·æ±‚ç»“æ„

```
payload = {
    "model": "qwen-plus",
    "messages": [
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯ç ”ç©¶å‘˜"},
        {"role": "user", "content": "æˆ‘æ˜¯HealerJeanï¼Œå¸®æˆ‘æ‰¾ä¸‹ç½‘ä¸Šå…³äºä»–çš„ä¸€äº›ä¿¡æ¯"}
    ],
    "temperature": 0.3,
    "max_tokens": 2000
}
```



| å‚æ•°              | ç±»å‹                 | å¿…å¡« | é»˜è®¤å€¼      | è¯´æ˜                                                         |
| ----------------- | -------------------- | ---- | ----------- | ------------------------------------------------------------ |
| **`model`**       | `str`                | æ˜¯   | â€”           | æ¨¡å‹åç§°ï¼Œå¦‚ `"qwen-plus"`ã€`"qwen-max"`ã€`"qwen-turbo"`     |
| **`messages`**    | `List[Dict]`         | æ˜¯   | â€”           | å¯¹è¯æ¶ˆæ¯åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ å« `role` å’Œ `content` â€¢ `role`: `"system"` / `"user"` / `"assistant"` â€¢ `content`: å­—ç¬¦ä¸² |
| **`temperature`** | `float`              | å¦   | `0.7`~`0.8` | æ§åˆ¶è¾“å‡ºéšæœºæ€§ï¼š  `0.0`ï¼šç¡®å®šæ€§å¼º  `1.0`ï¼šåˆ›æ„æ€§å¼º           |
| `top_p`           | `float`              | å¦   | `1.0`       | æ ¸é‡‡æ ·é˜ˆå€¼ï¼ˆç´¯ç§¯æ¦‚ç‡ï¼‰ï¼Œé€šå¸¸ä¸ `temperature` äºŒé€‰ä¸€          |
| **`max_tokens`**  | `int`                | å¦   | æ¨¡å‹ä¸Šé™    | **æ¨¡å‹æœ€å¤šç”Ÿæˆçš„ Â·token æ•°**ï¼ˆä¸å«è¾“å…¥ï¼‰ è¶…è¿‡åˆ™æˆªæ–­          |
| `stream`          | `bool`               | å¦   | `False`     | æ˜¯å¦å¯ç”¨æµå¼å“åº”ï¼ˆ`SSE`ï¼‰ `True` æ—¶è¿”å› `text/event-stream`  |
| `stop`            | `str` æˆ– `List[str]` | å¦   | `None`      | é‡åˆ°æŒ‡å®šå­—ç¬¦ä¸²æ—¶åœæ­¢ç”Ÿæˆ ä¾‹ï¼š`["\n\n", "ç”¨æˆ·ï¼š"]`            |
| `seed`            | `int`                | å¦   | `None`      | éšæœºç§å­ï¼Œç”¨äºç»“æœå¯å¤ç°ï¼ˆè°ƒè¯•ç”¨ï¼‰                           |
| `response_format` | `Dict`               | å¦   | `None`      | å¼ºåˆ¶è¾“å‡ºæ ¼å¼ï¼š `{"type": "json_object"}` âš ï¸ éœ€åœ¨ `system` ä¸­è¯´æ˜ `JSON` ç»“æ„ |
| `tools`           | `List[Dict]`         | å¦   | `None`      | å®šä¹‰å¯è°ƒç”¨çš„å‡½æ•°                                             |
| `tool_choice`     | `str` æˆ– `Dict`      | å¦   | `"auto"`    | æ§åˆ¶æ˜¯å¦è°ƒç”¨å·¥å…·ï¼š â€¢ `"auto"`ï¼šæ¨¡å‹å†³å®š â€¢ `"none"`ï¼šä¸è°ƒç”¨ â€¢ `{"type": "function", "function": {"name": "xxx"}}`ï¼šå¼ºåˆ¶è°ƒç”¨ |
| `user`            | `str`                | å¦   | `None`      | ç”¨äºæ ‡è¯†ç»ˆç«¯ç”¨æˆ·ï¼ˆå®¡è®¡/é™æµï¼‰                                |



- **ä¸­æ–‡ä»»åŠ¡ä¼˜å…ˆé€‰ `qwen-plus` æˆ– `qwen-max`**
- **è¦ `JSON` è¾“å‡ºï¼Ÿ** å¿…é¡»åŒæ—¶ï¼š
  1. è®¾ç½® `"response_format": {"type": "json_object"}`
  2. åœ¨ `system` æ¶ˆæ¯ä¸­æ˜ç¡® `JSON` `schema`
- **æµå¼è¾“å‡ºï¼Ÿ** è®¾ç½® `"stream": True` å¹¶ç”¨ `SSE` å®¢æˆ·ç«¯è§£æ

- **å¯æ§è¾“å‡º**ï¼šåŠ  `max_tokens` é˜²æ­¢è¿‡é•¿

  - ä¸­æ–‡ 1 å­— â‰ˆ 1~2 tokensï¼ˆå–å†³äºåˆ†è¯ï¼‰

  - è‹±æ–‡ 1 å•è¯ â‰ˆ 1.3 tokens

  - æ‚¨çš„ 31 tokens è¾“å…¥ â‰ˆ 20~25 ä¸ªä¸­æ–‡å­—

- **è°ƒè¯•ä¸€è‡´æ€§**ï¼šåŠ  `seed=42`

- **é¿å…å¹»è§‰**ï¼šç”¨ä½ `temperature`ï¼ˆ0.1~0.3ï¼‰



### 2ï¼‰è§’è‰²å®šä¹‰

| Role å€¼       | è¯´æ˜         | ä½¿ç”¨åœºæ™¯                                               |
| ------------- | ------------ | ------------------------------------------------------ |
| `"system"`    | **ç³»ç»Ÿæç¤º** | å®šä¹‰ AI çš„è¡Œä¸ºå‡†åˆ™ã€èº«ä»½ã€è§„åˆ™ï¼ˆå¦‚æ‚¨ä»£ç ä¸­çš„å®¢æœè®¾å®šï¼‰ |
| `"user"`      | **ç”¨æˆ·è¾“å…¥** | çœŸå®ç”¨æˆ·æå‡ºçš„é—®é¢˜æˆ–æŒ‡ä»¤                               |
| `"assistant"` | **æ¨¡å‹å›å¤** | AI ç”Ÿæˆçš„å›ç­”ï¼ˆä¹Ÿå¯ä»¥ç”¨äºå¤šè½®å¯¹è¯çš„å†å²è®°å½•ï¼‰          |



### 2ï¼‰**`finish_reason` å¿…é¡»æ£€æŸ¥**

> å¦‚æœè¿”å› `"length"`ï¼Œè¯´æ˜å›å¤è¢«æˆªæ–­ï¼Œéœ€å¢å¤§ `max_tokens`

```
if response["choices"][0]["finish_reason"] == "length":
    print("è­¦å‘Šï¼šå›å¤è¢«æˆªæ–­ï¼")
```



## 4ã€`FQA`

### 1ï¼‰`OpenAI SDK`ã€å’Œ `requests` åŸç”Ÿ  ä½¿ç”¨å“ªç§

| ç‰¹æ€§           | **ç¬¬ä¸€ä»½ä»£ç  (OpenAI SDK)**         | **ç¬¬äºŒä»½ä»£ç  (requestsåŸç”Ÿ)**                       |
| -------------- | ----------------------------------- | --------------------------------------------------- |
| **å®ç°æ–¹å¼**   | é«˜çº§SDKå°è£…                         | åº•å±‚HTTPè¯·æ±‚                                        |
| **ä¾èµ–åŒ…**     | `openai`                            | `requests`                                          |
| **URLé…ç½®**    | `base_url=".../compatible-mode/v1"` | å®Œæ•´URL `".../compatible-mode/v1/chat/completions"` |
| **é”™è¯¯å¤„ç†**   | SDKå†…ç½®å¤„ç†                         | æ‰‹åŠ¨try-except                                      |
| **è¾“å‡ºå†…å®¹**   | å®Œæ•´JSONå“åº”                        | ä»…æå–å›å¤æ–‡æœ¬                                      |
| **ä»£ç å¤æ‚åº¦** | ç®€æ´ï¼ˆ3è¡Œæ ¸å¿ƒä»£ç ï¼‰                 | è¾ƒå¤æ‚ï¼ˆéœ€æ‰‹åŠ¨å¤„ç†ç»†èŠ‚ï¼‰                            |
| æœªæ¥ä½¿ç”¨       | æ¨è                                | ä¸æ¨è                                              |

### 2ï¼‰**`OpenAI SDK` â‰  åªèƒ½è°ƒç”¨ `OpenAI` å®˜æ–¹æœåŠ¡**

> åªè¦ DashScope ç»´æŒ OpenAI å…¼å®¹æ¨¡å¼ï¼Œå°±èƒ½ç”¨ OpenAI SDKã€‚

- `OpenAI SDK` æ˜¯ä¸€ä¸ª **é€šç”¨çš„ HTTP å®¢æˆ·ç«¯åº“**ï¼Œéµå¾ª OpenAI API è§„èŒƒ
- é˜¿é‡Œäº‘ **DashScope ä¸»åŠ¨å…¼å®¹äº† `OpenAI` `API` åè®®**ï¼Œæ‰€ä»¥ä»»ä½•æ”¯æŒ OpenAI åè®®çš„å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬å®˜æ–¹ SDKï¼‰éƒ½èƒ½è°ƒç”¨
- è¿™å°±åƒï¼š**Java çš„ JDBC æ¥å£ â‰  åªèƒ½è¿ MySQL**ï¼ŒPostgreSQLã€Oracle ä¹Ÿéƒ½å®ç°äº† JDBC

```
 è¿™è¡Œä»£ç å†³å®šäº†ä½ è°ƒè°ï¼Œä¸æ˜¯ SDK å†³å®šçš„ï¼
base_url="https://dashscope.aliyuncs.com/v1"  # â† å…³é”®åœ¨è¿™é‡Œï¼
```



# äºŒã€æ— éœ€ä»»ä½•æœºå™¨å­¦ä¹ -å¤§è¯­è¨€æ¨¡å‹åˆ†æå†…å®¹

| æŠ€å·§                      | æ•ˆæœ             |
| ------------------------- | ---------------- |
| è®¾å®šè§’è‰²ï¼ˆsystem promptï¼‰ | è®© AI è¡¨ç°æ›´ä¸“ä¸š |
| å¤šè½®å¯¹è¯                  | æ¨¡æ‹ŸçœŸå®èŠå¤©     |
| é™åˆ¶è¾“å‡ºé£æ ¼              | é¿å…å•°å—¦æˆ–è·‘é¢˜   |

## 1ã€ç›´æ¥æé—®æ³•ï¼ˆæœ€ç®€å•ï¼‰

```python
import os
from openai import OpenAI

client = OpenAI(
    # è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapi_key="sk-xxx"
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

prompt = """
è¯·åˆ†æä»¥ä¸‹å¥å­çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºè¯„åˆ†ï¼ˆ-1 åˆ° 1ï¼‰ï¼š
- å¾ˆå¼€å¿ƒèƒ½å‚åŠ è¿™æ¬¡ä¼šè®®ã€‚
- è¿™ä¸ªäº§å“å¤ªå·®äº†ï¼Œæ ¹æœ¬ä¸å¥½ç”¨ã€‚
- ä¸€èˆ¬èˆ¬å§ï¼Œè¿˜å¯ä»¥æ¥å—ã€‚

æ ¼å¼å¦‚ä¸‹ï¼š
å¥å­ï¼šxxx
æƒ…æ„Ÿï¼šç§¯æ / æ¶ˆæ / ä¸­æ€§
å¾—åˆ†ï¼šxx
"""


response = client.chat.completions.create(  # â† å…³é”®ï¼šå®Œæ•´è°ƒç”¨è·¯å¾„
    model="qwen-plus",
    messages=[{"role": "user", "content": prompt}],
    temperature=0.3
)

print(response.choices[0].message.content)
```

```
â””â”€[$] python3 qwen_first.py                                                                                                                      [14:58:55]
å¥å­ï¼šå¾ˆå¼€å¿ƒèƒ½å‚åŠ è¿™æ¬¡ä¼šè®®ã€‚  
æƒ…æ„Ÿï¼šç§¯æ  
å¾—åˆ†ï¼š0.9

å¥å­ï¼šè¿™ä¸ªäº§å“å¤ªå·®äº†ï¼Œæ ¹æœ¬ä¸å¥½ç”¨ã€‚  
æƒ…æ„Ÿï¼šæ¶ˆæ  
å¾—åˆ†ï¼š-0.9

å¥å­ï¼šä¸€èˆ¬èˆ¬å§ï¼Œè¿˜å¯ä»¥æ¥å—ã€‚  
æƒ…æ„Ÿï¼šä¸­æ€§  
å¾—åˆ†ï¼š0.1
```



## 2ã€ç»“æ„åŒ–è¾“å‡ºï¼ˆ`JSON` æ¨¡å¼ï¼‰

```python
import os
from openai import OpenAI

client = OpenAI(
    # è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapi_key="sk-xxx"
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

prompt = """
è¯·åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…æ„Ÿï¼Œå¹¶è¿”å› JSON æ ¼å¼ç»“æœï¼š
{
  "text": "åŸæ–‡",
  "sentiment": "positive/negative/neutral",
  "confidence": 0.0 ~ 1.0,
  "summary": "ä¸€å¥è¯æ€»ç»“"
}

æ–‡æœ¬ï¼šè¿™éƒ¨ç”µå½±çœŸçš„å¤ªæ£’äº†ï¼Œæ¼”å‘˜æ¼”æŠ€ç‚¸è£‚ï¼Œå‰§æƒ…ç´§å‡‘ï¼Œå¼ºçƒˆæ¨èï¼
"""


response = client.chat.completions.create(  # â† å…³é”®ï¼šå®Œæ•´è°ƒç”¨è·¯å¾„
    model="qwen-plus",
    messages=[{"role": "user", "content": prompt}],
    temperature=0.3
)

print(response.choices[0].message.content)
```



```python
â””â”€[$] python3 qwen_first.py                                                                                                                      [15:02:44]
{
  "text": "è¿™éƒ¨ç”µå½±çœŸçš„å¤ªæ£’äº†ï¼Œæ¼”å‘˜æ¼”æŠ€ç‚¸è£‚ï¼Œå‰§æƒ…ç´§å‡‘ï¼Œå¼ºçƒˆæ¨èï¼",
  "sentiment": "positive",
  "confidence": 0.99,
  "summary": "å¯¹ç”µå½±ç»™äºˆé«˜åº¦è¯„ä»·ï¼Œè¡¨è¾¾å¼ºçƒˆçš„å–œçˆ±å’Œæ¨èã€‚"
}
```



## 3ã€æ‰¹é‡åˆ†æç”¨æˆ·è¯„è®º

> å‡è®¾ä½ æœ‰ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œæ”¶åˆ° 10 æ¡ç”¨æˆ·è¯„è®ºï¼Œä½ æƒ³è‡ªåŠ¨åˆ†ç±»æƒ…æ„Ÿã€‚

```python
import os
from openai import OpenAI
import json

client = OpenAI(
    # è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapi_key="sk-xxx"
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

comments = [
    "ç‰©æµå¾ˆå¿«ï¼Œå•†å“è´¨é‡å¾ˆå¥½ï¼Œæ»¡æ„ï¼",
    "å®¢æœæ€åº¦å·®ï¼Œé€€æ¢è´§éº»çƒ¦ï¼Œä¸æ¨èã€‚",
    "ä¸€èˆ¬å§ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚",
    "æ€§ä»·æ¯”è¶…é«˜ï¼Œä¸‹æ¬¡è¿˜ä¹°ï¼"
]

for comment in comments:
    prompt = f"""
è¯·ä¸¥æ ¼æŒ‰ä»¥ä¸‹ JSON æ ¼å¼åˆ†ææƒ…æ„Ÿï¼Œä¸è¦è¾“å‡ºä»»ä½•å…¶ä»–å†…å®¹ï¼š
{{
  "text": "{comment}",
  "sentiment": "positive/negative/neutral",
  "confidence": 0.0~1.0,
  "summary": "ä¸€å¥è¯æ€»ç»“"
}}
"""

    response = client.chat.completions.create(  # ç¼©è¿›åˆ°å¾ªç¯å†…
        model="qwen-plus",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.3
    )    
    print(response.choices[0].message.content)
```



```python
â””â”€[$] python3 qwen_first.py                                                                                                                      [15:09:47]
{
  "text": "ç‰©æµå¾ˆå¿«ï¼Œå•†å“è´¨é‡å¾ˆå¥½ï¼Œæ»¡æ„ï¼",
  "sentiment": "positive",
  "confidence": 0.99,
  "summary": "ç”¨æˆ·å¯¹ç‰©æµé€Ÿåº¦å’Œå•†å“è´¨é‡è¡¨ç¤ºæ»¡æ„ï¼Œæ•´ä½“ä½“éªŒè‰¯å¥½ã€‚"
}
{
  "text": "å®¢æœæ€åº¦å·®ï¼Œé€€æ¢è´§éº»çƒ¦ï¼Œä¸æ¨èã€‚",
  "sentiment": "negative",
  "confidence": 0.98,
  "summary": "ç”¨æˆ·å¯¹å®¢æœæ€åº¦å’Œé€€æ¢è´§æµç¨‹è¡¨ç¤ºä¸æ»¡ï¼Œæ•´ä½“è¯„ä»·è´Ÿé¢ã€‚"
}
{
  "text": "ä¸€èˆ¬å§ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚",
  "sentiment": "neutral",
  "confidence": 0.95,
  "summary": "è¡¨è¾¾å¯¹äº‹ç‰©å¹³æ·¡æ— å¥‡çš„çœ‹æ³•ï¼Œæƒ…æ„Ÿå€¾å‘ä¸­æ€§ã€‚"
}
{
  "text": "æ€§ä»·æ¯”è¶…é«˜ï¼Œä¸‹æ¬¡è¿˜ä¹°ï¼",
  "sentiment": "positive",
  "confidence": 0.99,
  "summary": "ç”¨æˆ·å¯¹äº§å“æ€§ä»·æ¯”éå¸¸æ»¡æ„ï¼Œè¡¨è¾¾å¼ºçƒˆè´­ä¹°æ„æ„¿ã€‚"
}

```



## 4ã€å¤šè½®å¯¹è¯

```python
import os
from openai import OpenAI
import json

client = OpenAI(
    # è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapi_key="sk-xxx"
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)



system_prompt = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ï¼Œè´Ÿè´£å›ç­”ç”¨æˆ·çš„å’¨è¯¢é—®é¢˜ã€‚
è¯·ä¿æŒç¤¼è²Œã€ä¸“ä¸šã€ç®€æ´ã€‚
å¦‚æœä¸çŸ¥é“ç­”æ¡ˆï¼Œè¯·è¯´ï¼šâ€œè¿™ä¸ªé—®é¢˜æˆ‘æš‚æ—¶æ— æ³•å›ç­”ï¼Œè¯·è”ç³»äººå·¥å®¢æœã€‚â€
"""
messages = [
    {"role": "system", "content": system_prompt},
    {"role": "user", "content": "ä½ ä»¬å‡ ç‚¹ä¸Šç­ï¼Ÿ"},
    {"role": "assistant", "content": "æˆ‘ä»¬å·¥ä½œæ—¶é—´ä¸ºæ¯å¤© 9:00 - 18:00ã€‚"},
    {"role": "user", "content": "æ€ä¹ˆé€€æ¬¾ï¼Ÿ"}
]


response = client.chat.completions.create(  # ç¼©è¿›åˆ°å¾ªç¯å†…
    model="qwen-plus",
    messages=messages,
    temperature=0.3
)    
print(response.choices[0].message.content)
```

```
æ‚¨å¥½ï¼Œå…³äºé€€æ¬¾æµç¨‹ï¼Œé€šå¸¸éœ€è¦æ‚¨æä¾›è®¢å•å·å’Œç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¼šä¸ºæ‚¨æäº¤ç”³è¯·ã€‚è¯·æ‚¨åœ¨è®¢å•é¡µé¢ç‚¹å‡»â€œç”³è¯·é€€æ¬¾â€ï¼ŒæŒ‰ç…§æç¤ºæ“ä½œå³å¯ã€‚å¦‚æœ‰é—®é¢˜ï¼Œä¹Ÿå¯è”ç³»äººå·¥å®¢æœååŠ©å¤„ç†ã€‚
```



# ä¸‰ã€ä¼šè¯èƒ½åŠ›

## 1ã€è¾“å…¥ä¸»é¢˜ï¼Œ`AI` è‡ªåŠ¨ç”Ÿæˆæ–‡ç« 

### 1ï¼‰å®‰è£… `python` åº“

#### aã€`streamlit` â€”â€” **å¿«é€Ÿæ­å»º `Web` åº”ç”¨çš„ç¥å™¨**

- **ä½œç”¨**ï¼šè®©ä½ ç”¨çº¯ `Python` ä»£ç  **å‡ è¡Œå°±åšå‡ºä¸€ä¸ªç½‘é¡µåº”ç”¨**ï¼ˆæ¯”å¦‚èŠå¤©æœºå™¨äººã€æ•°æ®çœ‹æ¿ã€AI å·¥å…·ç­‰ï¼‰ï¼Œæ— éœ€å†™ `HTML/CSS/JavaScript`ã€‚
- **ç±»æ¯”**ï¼šå°±åƒâ€œ`Python` ç‰ˆçš„ç®€æ˜“ç½‘é¡µæ¡†æ¶â€ï¼Œä¸“ä¸ºæ•°æ®ç§‘å­¦å®¶å’Œ `AI` å¼€å‘è€…è®¾è®¡ã€‚



#### bã€`openai` â€”â€” **è°ƒç”¨å¤§æ¨¡å‹çš„æ ‡å‡†å®¢æˆ·ç«¯**

- **ä½œç”¨**ï¼š`OpenAI `å®˜æ–¹æä¾›çš„ `Python SDK`ï¼Œç”¨äºè°ƒç”¨ `GPT` ç­‰æ¨¡å‹ã€‚
- **ä½†æ›´é‡è¦çš„æ˜¯**ï¼šå®ƒå·²æˆä¸º**è¡Œä¸šæ ‡å‡†åè®®**ï¼Œé˜¿é‡Œäº‘ DashScopeã€Moonshotã€DeepSeek ç­‰éƒ½å…¼å®¹è¿™ä¸ªæ¥å£ï¼

#### cã€`python-dotenv` â€”â€” **å®‰å…¨è¯»å–é…ç½®æ–‡ä»¶**

- **ä½œç”¨**ï¼šä» `.env` æ–‡ä»¶ä¸­åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆæ¯”å¦‚ `API` å¯†é’¥ï¼‰ï¼Œé¿å…æŠŠæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ `sk-xxx`ï¼‰å†™æ­»åœ¨ä»£ç é‡Œã€‚
- **ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ**å¦‚æœç›´æ¥å†™ `api_key = "sk-xxx"` åœ¨ä»£ç ä¸­ï¼š
  - ä¸€ä¸å°å¿ƒæäº¤åˆ° `GitHub` â†’ **å¯†é’¥æ³„éœ² â†’ è¢«ç›—åˆ·è´¹ç”¨ï¼**
  - å›¢é˜Ÿåä½œæ—¶æ¯ä¸ªäººå¯†é’¥ä¸åŒ â†’ éœ€è¦é¢‘ç¹æ”¹ä»£ç 



### 2ï¼‰ä»£ç ç¼–å†™

```python
# app.py
import os
import streamlit as st
from openai import OpenAI
from dotenv import load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()
api_key = os.getenv("DASHSCOPE_API_KEY")  # æ³¨æ„ï¼šè¿™é‡Œå»ºè®®æ”¹åä¸º DASHSCOPE_API_KEYï¼Œä½†ä¿ç•™ä¹Ÿå¯
if not api_key:
    st.error("è¯·åœ¨ç¯å¢ƒå˜é‡ä¸­ä¸­è®¾ç½® DASHSCOPE_API_KEY")
    st.stop()

# ä½¿ç”¨ OpenAI SDK åˆå§‹åŒ–å®¢æˆ·ç«¯ï¼ŒæŒ‡å‘ DashScope
client = OpenAI(
    api_key = api_key,
    base_url= "https://dashscope.aliyuncs.com/compatible-mode/v1",
)

# è®¾ç½®é¡µé¢æ ‡é¢˜
st.set_page_config(page_title="ğŸ“ æ™ºèƒ½å†™ä½œåŠ©æ‰‹", layout="centered")
st.title("ğŸ“ æ™ºèƒ½å†™ä½œåŠ©æ‰‹")
st.markdown("åŸºäºé€šä¹‰åƒé—®ï¼ˆQwenï¼‰çš„ AI å†™ä½œå·¥å…·ï¼Œè¾“å…¥ä¸»é¢˜ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–‡ç« ã€‚")

# ç”¨æˆ·è¾“å…¥
topic = st.text_input("è¯·è¾“å…¥å†™ä½œä¸»é¢˜ï¼ˆä¾‹å¦‚ï¼šäººå·¥æ™ºèƒ½çš„æœªæ¥ï¼‰", placeholder="äººå·¥æ™ºèƒ½çš„æœªæ¥")

# ç”ŸæˆæŒ‰é’®
if st.button("ğŸš€ ç”Ÿæˆæ–‡ç« "):
    if not topic.strip():
        st.warning("è¯·è¾“å…¥ä¸€ä¸ªä¸»é¢˜ï¼")
    else:
        with st.spinner("æ­£åœ¨ç”Ÿæˆå†…å®¹ï¼Œè¯·ç¨å€™..."):
            try:
                prompt = f"""
                            ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å†…å®¹åˆ›ä½œè€…ï¼Œè¯·å›´ç»•ä»¥ä¸‹ä¸»é¢˜å†™ä¸€ç¯‡ 300 å­—å·¦å³çš„çŸ­æ–‡ï¼š
                            ä¸»é¢˜ï¼š{topic}

                            è¦æ±‚ï¼š
                            - è¯­è¨€æµç•…ï¼Œé€»è¾‘æ¸…æ™°
                            - åŒ…å«å¼€å¤´ã€ä¸»ä½“ã€ç»“å°¾
                            - ä¸è¦ä½¿ç”¨ markdown æ ¼å¼
                            - ç›´æ¥è¾“å‡ºæ­£æ–‡
                            """
                # è°ƒç”¨ DashScope çš„ Qwen æ¨¡å‹ï¼ˆé€šè¿‡ OpenAI SDKï¼‰
                response = client.chat.completions.create(
                    model="qwen-max",  # æ”¯æŒ qwen-plus / qwen-max / qwen-turbo
                    messages=[{"role": "user", "content": prompt}],
                    temperature= 0.7,
                    max_tokens= 500,
                )
                content = response.choices[0].message.content
                st.subheader("ğŸ“– ç”Ÿæˆç»“æœ")
                st.write(content)
                
                # æä¾›ä¸‹è½½æŒ‰é’®
                st.download_button(
                    label="ğŸ’¾ ä¸‹è½½ä¸º .txt",
                    data=content,
                    file_name=f"{topic}.txt",
                    mime="text/plain"
                )
            except Exception as e:
                st.error(f"å‡ºé”™äº†ï¼š{str(e)}")
```



### 3ï¼‰è¿è¡Œ `http://localhost:8501/`

```python
â””â”€[$] streamlit run qwen_first.py                                                                                                                [16:38:42]


      ğŸ‘‹ Welcome to Streamlit!

      If you'd like to receive helpful onboarding emails, news, offers, promotions,
      and the occasional swag, please enter your email address below. Otherwise,
      leave this field blank.

      Email: healerjean@163.com
â””â”€[$] streamlit run qwen_first.py                                                                                                                [16:57:29]


  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:8504
  Network URL: http://10.254.65.167:8504

  For better performance, install the Watchdog module:

  $ xcode-select --install
  $ pip install watchdog
            
    
```

```http

```



![image-20251128164113639](/Users/zhangyujin1/Desktop/HealerJean/HCode/HealerJean.github.io/blogImages/image-20251128164113639.png)

### 4ï¼‰æ‰“åŒ…éƒ¨ç½²ï¼ˆå†…ç½‘ç©¿é€ï¼‰

- `mac` å®‰è£… `ngrok`

  - ```
    brew install ngrok/ngrok/ngrok
    ```

- é…ç½® `ngrok` `Authtoken`

  - ```
    â””â”€[$] ngrok config add-authtoken xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx                                                               [17:12:28]
    
    Authtoken saved to configuration file: /Users/zhangyujin1/Library/Application Support/ngrok/ngrok.yml
    ```

- è¿è¡Œ web æœåŠ¡

  - ```
    streamlit run qwen_first.py
    ```

- å¯åŠ¨ `ngrok` å†…ç½‘ç©¿é€

  - ```
    ngrok http 8506
    
    ```

  - ```
    ngrok                                                                                                                                       (Ctrl+C to quit)
                                                                                                                                                                
    ğŸ§  Call internal services from your gateway: https://ngrok.com/r/http-request                                                                               
                                                                                                                                                                
    Session Status                online                                                                                                                        
    Account                       healerjean@gmail.com (Plan: Free)                                                                                             
    Version                       3.33.1                                                                                                                        
    Region                        Japan (jp)                                                                                                                    
    Latency                       64ms                                                                                                                          
    Web Interface                 http://127.0.0.1:4040                                                                                                         
    Forwarding                    https://pseudoamatorial-mee-flashingly.ngrok-free.dev -> http://localhost:8507                                                
                                                                                                                                                                
    Connections                   ttl     opn     rt1     rt5     p50     p90                                                                                   
                                  3       0       0.00    0.00    0.02    0.29                                                                                  
                                                                                                                                                                
    HTTP Requests                                                                                                                                               
    -------------                                                                                                                                               
                                                                                                                                                                
    17:17:35.037 CST GET /                          502 Bad Gateway                                                                                             
    17:17:30.101 CST GET /                          502 Bad Gateway                                                                                             
    17:16:21.210 CST GET /                          502 Bad Gateway  
    ```



## 2ã€å–„ç”¨ `Embedding`ï¼Œæˆ‘ä»¬æ¥ç»™æ–‡æœ¬åˆ†ç±»

### 1ï¼‰ä»€ä¹ˆæ˜¯ `Embedding`ï¼Ÿ

> `Embedding` æ˜¯å°†ä¸€æ®µæ–‡å­—å˜æˆä¸€ä¸ªâ€œæ•°å­—å‘é‡â€ï¼Œæ¯”å¦‚ï¼š

```
"æˆ‘å–œæ¬¢åƒè‹¹æœ" â†’ [0.1, -0.3, 0.8, ...]
"æˆ‘ä¸å–œæ¬¢é¦™è•‰" â†’ [0.2, -0.4, 0.7, ...]
```

ä¸¤ä¸ªç›¸ä¼¼çš„å¥å­ï¼Œå‘é‡ä¹Ÿç›¸è¿‘ã€‚



### 2ï¼‰æ¡ˆä¾‹-åˆ†æˆ 2ç±»

| æŠ€æœ¯        | ä½œç”¨         |
| ----------- | ------------ |
| `Embedding` | æŠŠæ–‡å­—å˜æ•°å­— |
| å‘é‡ç›¸ä¼¼åº¦  | æ‰¾å‡ºç›¸ä¼¼å†…å®¹ |
| èšç±»ç®—æ³•    | è‡ªåŠ¨åˆ†ç»„     |

```python
# sentiment_clustering.py
import os
import numpy as np
from openai import OpenAI
from sklearn.cluster import KMeans

# åˆå§‹åŒ– OpenAI å…¼å®¹å®¢æˆ·ç«¯ï¼ˆæŒ‡å‘é˜¿é‡Œäº‘ DashScopeï¼‰
client = OpenAI(
    # è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapi_key="sk-xxx"
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)


# === æ–‡æœ¬æ•°æ® ===
texts = [
    "ä»Šå¤©å¤©æ°”çœŸå¥½",
    "é˜³å…‰æ˜åªšï¼Œå¿ƒæƒ…æ„‰å¿«",
    "ä¸‹é›¨äº†ï¼Œæœ‰ç‚¹çƒ¦",
    "å¤–é¢åˆ®é£äº†ï¼Œå¾ˆå†·",
    "æˆ‘å¾ˆå¼€å¿ƒï¼Œå› ä¸ºæ”¾å‡äº†"
]

# === æ­¥éª¤1ï¼šè·å– Embedding å‘é‡ ===
print("æ­£åœ¨è·å–æ–‡æœ¬å‘é‡...")
embeddings = []
for text in texts:
    response = client.embeddings.create(
        model="text-embedding-v2",  # DashScope å®˜æ–¹ embedding æ¨¡å‹
        input=text
    )
    embeddings.append(response.data[0].embedding)

# è½¬ä¸º NumPy æ•°ç»„ï¼ˆKMeans éœ€è¦ï¼‰
X = np.array(embeddings)

# === æ­¥éª¤2ï¼šKMeans èšç±»ï¼ˆåˆ† 2 ç±»ï¼‰ 42ã€Šé“¶æ²³ç³»æ¼«æ¸¸æŒ‡å—ã€‹ç»ˆæç­”æ¡ˆ===
kmeans = KMeans(n_clusters=2, random_state=42)
labels = kmeans.fit_predict(X)

# === æ­¥éª¤3ï¼šè¾“å‡ºç»“æœ ===
print("\nèšç±»ç»“æœï¼š")
for i, label in enumerate(labels):
    print(f"æ–‡æœ¬{i}: {texts[i]} -> ç±»åˆ«{label}")
```

```
â””â”€[$] python3 qwen_first.py                                                                                                                      [17:41:36]
æ­£åœ¨è·å–æ–‡æœ¬å‘é‡...

èšç±»ç»“æœï¼š
æ–‡æœ¬0: ä»Šå¤©å¤©æ°”çœŸå¥½ -> ç±»åˆ«0
æ–‡æœ¬1: é˜³å…‰æ˜åªšï¼Œå¿ƒæƒ…æ„‰å¿« -> ç±»åˆ«0
æ–‡æœ¬2: ä¸‹é›¨äº†ï¼Œæœ‰ç‚¹çƒ¦ -> ç±»åˆ«1
æ–‡æœ¬3: å¤–é¢åˆ®é£äº†ï¼Œå¾ˆå†· -> ç±»åˆ«1
æ–‡æœ¬4: æˆ‘å¾ˆå¼€å¿ƒï¼Œå› ä¸ºæ”¾å‡äº† -> ç±»åˆ«0
```



## 2ã€æ–‡æœ¬èšç±»ï¼Œè®© `AI` å¸®ä½ åšæ€»ç»“

> ä¸ç”¨è®­ç»ƒæ¨¡å‹ï¼Œä»…ç”¨ Qwen + å¼€æºå·¥å…·ï¼Œå®ç°è‡ªåŠ¨ä¼šè®®çºªè¦ã€æ–°é—»åˆ†ç±»ã€é•¿æ–‡æ‘˜è¦ä¸‰å¤§å®ç”¨åŠŸèƒ½ï¼

æ ¸å¿ƒæ€è·¯ï¼šä¸¤æ­¥èµ°ï¼š

- å°†ç»“åˆ **`Embedding` + `Prompt Engineering`**ï¼Œæ‰“é€ å…¨è‡ªåŠ¨æ–‡æœ¬å¤„ç†æµæ°´çº¿ã€‚

| æ­¥éª¤                 | æ–¹æ³•                              |
| -------------------- | --------------------------------- |
| **1. ç†è§£å†…å®¹**      | ç”¨ Qwen çš„ Embedding è·å–è¯­ä¹‰å‘é‡ |
| **2. ç”Ÿæˆæ‘˜è¦/èšç±»** | ç”¨ Qwen çš„ Chat æ¨¡å‹åšæ™ºèƒ½æ€»ç»“    |



ä½ çˆ¬å–äº† `50` æ¡æ–°é—»æ ‡é¢˜ï¼Œæƒ³è‡ªåŠ¨åˆ†ç»„ï¼ˆå¦‚â€œç§‘æŠ€â€ã€â€œä½“è‚²â€ã€â€œè´¢ç»â€ï¼‰ã€‚

```python
# sentiment_clustering.py
import os
import numpy as np
from openai import OpenAI
from sklearn.cluster import KMeans

# åˆå§‹åŒ– OpenAI å…¼å®¹å®¢æˆ·ç«¯ï¼ˆæŒ‡å‘é˜¿é‡Œäº‘ DashScopeï¼‰
client = OpenAI(
    # è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapi_key="sk-xxx"
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)



# === æ­¥éª¤ 1ï¼šå‡†å¤‡æ–°é—»æ ‡é¢˜ ===
news_titles = [
    "åä¸ºå‘å¸ƒæ–°æ¬¾ Mate60 æ‰‹æœº",
    "è‹¹æœè‚¡ä»·åˆ›å†å²æ–°é«˜",
    "NBA æ€»å†³èµ›æ¹–äººå¤ºå† ",
    "å¤®è¡Œå®£å¸ƒé™å‡† 0.5 ä¸ªç™¾åˆ†ç‚¹",
    "ç‰¹æ–¯æ‹‰ä¸Šæµ·å·¥å‚æ‰©äº§",
    "Cç½—åŠ ç›Ÿæ²™ç‰¹è”èµ›",
    "è‹±ä¼Ÿè¾¾å¸‚å€¼çªç ´ä¸‡äº¿ç¾å…ƒ",
    "ç¾è”å‚¨åŠ æ¯ 25 ä¸ªåŸºç‚¹",
    "æ¢…è¥¿ç‡é˜Ÿèµ¢å¾—ä¸–ç•Œæ¯",
    "å°ç±³æ±½è½¦æ˜å¹´é‡äº§",
    "Aè‚¡ä¸‰å¤§æŒ‡æ•°é›†ä½“ä¸Šæ¶¨",
    "å‹‡å£«é˜Ÿç­¾ä¸‹æ–°ç§€åˆåŒ"
]

# === æ­¥éª¤ 2ï¼šè·å– Embedding å‘é‡ ===
def get_embeddings(texts):
    embeddings = []
    for text in texts:
        response = client.embeddings.create(
            model="text-embedding-v2",  # DashScope å®˜æ–¹ embedding æ¨¡å‹
            input=text
        )
        embeddings.append(response.data[0].embedding)
    return np.array(embeddings)

print("æ­£åœ¨è·å–æ–‡æœ¬å‘é‡...")
vectors = get_embeddings(news_titles)


# === æ­¥éª¤ 3ï¼šKMeans èšç±»ï¼ˆåˆ† 3 ç±»ï¼‰===
n_clusters = 3
kmeans = KMeans(n_clusters=n_clusters, random_state=42)
labels = kmeans.fit_predict(vectors)

# æŒ‰æ ‡ç­¾åˆ†ç»„
clusters = {}
for i, label in enumerate(labels):
    if label not in clusters:
        clusters[label] = []
    clusters[label].append(news_titles[i])


# === æ­¥éª¤ 4ï¼šç”¨ Qwen ä¸ºæ¯ä¸ªç±»åˆ«å‘½å ===
print("\næ­£åœ¨ä¸ºæ¯ä¸ªç±»åˆ«ç”Ÿæˆåç§°...\n")

for label, titles in clusters.items():
    # å–æœ€å¤š 3 æ¡ä½œä¸ºæ ·æœ¬
    sample_titles = "\n".join(titles[:3])
    naming_prompt = f"""ä»¥ä¸‹æ˜¯ä¸€ç»„æ–°é—»æ ‡é¢˜ï¼Œè¯·ä¸ºè¿™ä¸ªç±»åˆ«èµ·ä¸€ä¸ªç®€æ´çš„ä¸­æ–‡åç§°ï¼ˆ2~4 ä¸ªå­—ï¼‰ï¼š
{sample_titles}

åªè¾“å‡ºç±»åˆ«åç§°ï¼Œä¸è¦ä»»ä½•è§£é‡Šã€æ ‡ç‚¹æˆ–é¢å¤–å†…å®¹ã€‚"""

    response = client.chat.completions.create(
        model="qwen-plus",
        messages=[{"role": "user", "content": naming_prompt}],
        temperature=0.3,
        max_tokens=10
    )
    category_name = response.choices[0].message.content.strip().replace(" ", "").replace("â€", "").replace("â€œ", "")

    print(f"ã€{category_name}ã€‘")
    for t in titles:
        print(f" - {t}")
    print()


```





```
â””â”€[$] python3 qwen_first.py                                                                                                                      [17:42:33]
æ­£åœ¨è·å–æ–‡æœ¬å‘é‡...

æ­£åœ¨ä¸ºæ¯ä¸ªç±»åˆ«ç”Ÿæˆåç§°...

ã€æ–°é—»ã€‘
 - åä¸ºå‘å¸ƒæ–°æ¬¾ Mate60 æ‰‹æœº
 - NBA æ€»å†³èµ›æ¹–äººå¤ºå† 
 - Cç½—åŠ ç›Ÿæ²™ç‰¹è”èµ›
 - æ¢…è¥¿ç‡é˜Ÿèµ¢å¾—ä¸–ç•Œæ¯
 - å‹‡å£«é˜Ÿç­¾ä¸‹æ–°ç§€åˆåŒ

ã€è´¢ç»ã€‘
 - è‹¹æœè‚¡ä»·åˆ›å†å²æ–°é«˜
 - å¤®è¡Œå®£å¸ƒé™å‡† 0.5 ä¸ªç™¾åˆ†ç‚¹
 - è‹±ä¼Ÿè¾¾å¸‚å€¼çªç ´ä¸‡äº¿ç¾å…ƒ
 - ç¾è”å‚¨åŠ æ¯ 25 ä¸ªåŸºç‚¹
 - Aè‚¡ä¸‰å¤§æŒ‡æ•°é›†ä½“ä¸Šæ¶¨

ã€æ–°èƒ½æºè½¦ã€‘
 - ç‰¹æ–¯æ‹‰ä¸Šæµ·å·¥å‚æ‰©äº§
 - å°ç±³æ±½è½¦æ˜å¹´é‡äº§

```



## 3ã€æ–‡æœ¬æ”¹å†™å’Œå†…å®¹å®¡æ ¸

> ç”¨ `Qwen` å®ç°å››å¤§å®ç”¨åŠŸèƒ½â€”â€”æ•æ„Ÿå†…å®¹è¿‡æ»¤ã€é£æ ¼æ”¹å†™ã€SEO ä¼˜åŒ–ã€é˜²æŠ„è¢­æ£€æµ‹ï¼Œå…¨éƒ¨æ— éœ€è®­ç»ƒæ¨¡å‹ï¼



### 1ï¼‰æç¤ºæŠ€å·§

åœ¨çœŸå®ä¸šåŠ¡ä¸­ï¼Œä½ å¯èƒ½é‡åˆ°ï¼š

- ğŸš« ç”¨æˆ·å‘å¸–å«è¾±éª‚ã€å¹¿å‘Šã€æ”¿æ²»æ•æ„Ÿè¯ï¼Ÿ
- âœï¸ å…¬å¸æ–‡æ¡ˆå¤ªç”Ÿç¡¬ï¼Œæƒ³æ”¹æˆâ€œå°çº¢ä¹¦é£æ ¼â€ï¼Ÿ
- ğŸ” å†™çš„å…¬ä¼—å·æ–‡ç« æ²¡äººçœ‹ï¼Œéœ€è¦ SEO ä¼˜åŒ–ï¼Ÿ
- ğŸ“„ å­¦ç”Ÿäº¤çš„è®ºæ–‡æ˜¯ä¸æ˜¯æŠ„çš„ï¼Ÿ

ä¼ ç»Ÿæ–¹æ¡ˆï¼š

- æ•æ„Ÿè¯åº“ï¼ˆç»´æŠ¤éš¾ã€æ¼æ£€å¤šï¼‰
- äººå·¥ç¼–è¾‘ï¼ˆæˆæœ¬é«˜ï¼‰
- æŸ¥é‡ç³»ç»Ÿï¼ˆè´µä¸”ä¸å‡†ï¼‰

| åŠŸèƒ½     | æ ¸å¿ƒ `Prompt` æŠ€å·§                      |
| -------- | --------------------------------------- |
| å†…å®¹å®¡æ ¸ | â€œä½ æ˜¯ä¸€ä¸ªå®¡æ ¸å‘˜ï¼Œè¯·æ£€æŸ¥...â€ + JSON è¾“å‡º |
| é£æ ¼æ”¹å†™ | â€œæ”¹å†™æˆã€XXã€‘é£æ ¼ï¼Œè¦æ±‚...â€             |
| SEO ä¼˜åŒ– | â€œä½ æ˜¯ä¸€ä½ SEO ä¸“å®¶ï¼Œè¯·ä¼˜åŒ–...â€          |
| æŠ„è¢­æ£€æµ‹ | â€œåˆ¤æ–­ä¸¤æ®µæ–‡å­—æ˜¯å¦æŠ„è¢­ï¼Œä»...è§’åº¦åˆ†æâ€   |



### 2ï¼‰æ™ºèƒ½å†…å®¹å®¡æ ¸ï¼ˆæ•æ„Ÿè¯ + é£é™©è¯†åˆ«

- **ä¸è¦ä¿¡ä»» AI å®¡æ ¸ 100%**â†’ å»ºè®®ç”¨äºåˆç­›ï¼Œé«˜é£é™©å†…å®¹ä»éœ€äººå·¥å¤æ ¸ã€‚
- **è®°å½•å®¡æ ¸æ—¥å¿—**â†’ ä¾¿äºäº‹åå®¡è®¡å’Œæ¨¡å‹ä¼˜åŒ–ã€‚

åœºæ™¯ï¼šç”¨æˆ·åœ¨è¯„è®ºåŒºè¾“å…¥ä¸€æ®µæ–‡å­—ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è¿è§„ã€‚



```json
# sentiment_clustering.py
import os
from openai import OpenAI
import json  # âœ… å…³é”®ï¼šå¿…é¡»æ”¾åœ¨é¡¶éƒ¨ï¼

# ==============================
# ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ– OpenAI å…¼å®¹å®¢æˆ·ç«¯ï¼ˆæŒ‡å‘é˜¿é‡Œäº‘ DashScopeï¼‰
# ==============================
# ä»ç¯å¢ƒå˜é‡ä¸­è¯»å– API å¯†é’¥ï¼ˆå»ºè®®åœ¨ .env ä¸­è®¾ç½® DASHSCOPE_API_KEYï¼‰
client = OpenAI(
    # è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapi_key="sk-xxx"
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)



# ==============================
# ç¬¬äºŒæ­¥ï¼šå®šä¹‰å†…å®¹å®‰å…¨å®¡æ ¸å‡½æ•°
# ==============================
def check_content(text: str) -> dict:
    """
    ä½¿ç”¨ Qwen å¤§æ¨¡å‹å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œå®‰å…¨å®¡æ ¸ã€‚
    
    å®¡æ ¸ç»´åº¦ï¼š
      - æ”¿æ²»æ•æ„Ÿ
      - è¾±éª‚/äººèº«æ”»å‡»
      - å¹¿å‘Š/è¥é”€
      - è‰²æƒ…ä½ä¿—
      - è™šå‡ä¿¡æ¯
    
    è¿”å›æ ‡å‡† JSON æ ¼å¼ç»“æœï¼Œä¾¿äºç¨‹åºè§£æã€‚
    """
    
    # æ„é€ æç¤ºè¯ï¼ˆPromptï¼‰
    # æ³¨æ„ï¼šè¿™é‡Œç”¨ä¸‰é‡å¼•å·ä¿ç•™æ ¼å¼ï¼Œf-string æ’å…¥å¾…å®¡æ ¸æ–‡æœ¬
    prompt = f"""
ä½ æ˜¯ä¸€ä¸ªå†…å®¹å®‰å…¨å®¡æ ¸å‘˜ï¼Œè¯·ä¸¥æ ¼æ£€æŸ¥ä»¥ä¸‹æ–‡æœ¬æ˜¯å¦å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. æ”¿æ²»æ•æ„Ÿå†…å®¹
2. è¾±éª‚ã€äººèº«æ”»å‡»
3. å¹¿å‘Š/è¥é”€ä¿¡æ¯
4. è‰²æƒ…ä½ä¿—
5. è™šå‡ä¿¡æ¯

å¦‚æœå­˜åœ¨ä»»ä½•é—®é¢˜ï¼Œè¯·æŒ‰ JSON æ ¼å¼è¾“å‡ºï¼ˆä¸è¦ä»»ä½•é¢å¤–æ–‡å­—ï¼‰ï¼š
{{
  "is_safe": false,
  "risk_type": "å¹¿å‘Š",
  "reason": "åŒ…å«å¾®ä¿¡å·æ¨å¹¿"
}}
å¦‚æœå®Œå…¨å®‰å…¨ï¼Œè¯·è¾“å‡ºï¼ˆåŒæ ·åªè¾“å‡º JSONï¼‰ï¼š
{{
  "is_safe": true,
  "risk_type": null,
  "reason": null
}}

å¾…å®¡æ ¸æ–‡æœ¬ï¼š
{text}
"""

    try:
        # è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆå®¡æ ¸ç»“æœ
        response = client.chat.completions.create(
            model="qwen-max",          # ä½¿ç”¨ Qwen-Maxï¼ˆå¼ºæ¨ç†èƒ½åŠ›ï¼Œé€‚åˆå®¡æ ¸ï¼‰
            messages=[
                {"role": "user", "content": prompt}
            ],
            temperature=0.1,           # é™ä½éšæœºæ€§ï¼Œç¡®ä¿ç»“æœç¨³å®š
            max_tokens=200,            # è¶³å¤Ÿè¿”å›ä¸€ä¸ª JSON å³å¯
            response_format={"type": "json_object"}  # â­ å…³é”®ï¼å¼ºåˆ¶æ¨¡å‹è¾“å‡ºåˆæ³• JSON
        )

        # æå–æ¨¡å‹è¿”å›çš„æ–‡æœ¬å†…å®¹
        raw_content = response.choices[0].message.content.strip()

        # å°è¯•è§£æä¸º JSON
        result = json.loads(raw_content)
        
        # ç¡®ä¿å­—æ®µå®Œæ•´ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼‰
        required_keys = {"is_safe", "risk_type", "reason"}
        if not required_keys.issubset(result.keys()):
            raise ValueError("ç¼ºå°‘å¿…è¦å­—æ®µ")
            
        return result

    except Exception as e:
        # å¦‚æœæ¨¡å‹è¿”å›é JSONã€è§£æå¤±è´¥æˆ–ç½‘ç»œé”™è¯¯ï¼Œè¿”å›å®‰å…¨å¤±è´¥
        return {
            "is_safe": False,
            "risk_type": "ç³»ç»Ÿé”™è¯¯",
            "reason": f"å®¡æ ¸å¼‚å¸¸: {str(e)}"
        }

test_texts = [
    "è¿™ä¸ªäº§å“çœŸåƒåœ¾ï¼Œå–å®¶æ˜¯éª—å­ï¼",           # é¢„æœŸï¼šè¾±éª‚
    "åŠ æˆ‘å¾®ä¿¡ï¼šxiaoming123ï¼Œä¼˜æƒ åˆ¸å…è´¹é¢†",   # é¢„æœŸï¼šå¹¿å‘Š
    "ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œé€‚åˆæ•£æ­¥ã€‚"               # é¢„æœŸï¼šå®‰å…¨
]

for text in test_texts:
    print(f"åŸæ–‡: {text}")
    result = check_content(text)
    print(f"å®¡æ ¸ç»“æœ: {result}\n")







```



```
â””â”€[$] python3 qwen_first.py                                                                                                                      [18:33:41]
åŸæ–‡: è¿™ä¸ªäº§å“çœŸåƒåœ¾ï¼Œå–å®¶æ˜¯éª—å­ï¼
å®¡æ ¸ç»“æœ: {'is_safe': False, 'risk_type': 'è¾±éª‚ã€äººèº«æ”»å‡»', 'reason': 'åŒ…å«å¯¹å–å®¶çš„è´Ÿé¢è¯„ä»·å’Œä¾®è¾±æ€§è¯­è¨€'}

åŸæ–‡: åŠ æˆ‘å¾®ä¿¡ï¼šxiaoming123ï¼Œä¼˜æƒ åˆ¸å…è´¹é¢†
å®¡æ ¸ç»“æœ: {'is_safe': False, 'risk_type': 'å¹¿å‘Š', 'reason': 'åŒ…å«å¾®ä¿¡å·æ¨å¹¿'}

åŸæ–‡: ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œé€‚åˆæ•£æ­¥ã€‚
å®¡æ ¸ç»“æœ: {'is_safe': True, 'risk_type': None, 'reason': None}
```













![ContactAuthor](https://raw.githubusercontent.com/HealerJean/HealerJean.github.io/master/assets/img/artical_bottom.jpg)



<!-- Gitalk è¯„è®º start  -->

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>Â 
<div id="gitalk-container"></div>Â    
 <script type="text/javascript">
    var gitalk = new Gitalk({
		clientID: `1d164cd85549874d0e3a`,
		clientSecret: `527c3d223d1e6608953e835b547061037d140355`,
		repo: `HealerJean.github.io`,
		owner: 'HealerJean',
		admin: ['HealerJean'],
		id: '6We7UZFRuPViyOGx9Hgq',
    });
    gitalk.render('gitalk-container');
</script>Â 





<!-- Gitalk end -->



